jQuery.extend(jQuery.gui.opt,{GUI_VERSION_OPT:"7.5.7.1"});$.mobile=$.extend($.mobile||{},{documentUrl:location.href.replace(/\/gui\/.*$/,"/gui/")});jQuery(function(e){var b=e.gui,d=e(document),g="/"+b.opt.GUI_VERSION_OPT+"/gui/tpl/src/",h="home/home.html",j;b.alert=function(n,k){var m=b.displayMode==2?"320px":"500px";n=n.replace(/\n/g,"<br/>");k=(typeof k==="undefined")?null:k;options={mode:"blank",width:m,themeDialog:"d",showModal:false,blankContent:"<br/><p align='center'>"+n+"</p><br/><p align='center'><a rel='close' data-role='button' href='#' data-inline='true' data-mini='true' data-theme='b' data-icon='check'>"+b.i18n.msg("HOME_OK")+"</a></p>"};if(k!==null){for(var l in k){options[l]=k[l]}}e("<div>").simpledialog2(options)};b.refreshPage=function(){e(".ui-page").not(e.mobile.activePage).each(function(){e.mobile.loadPage(e(this).attr("data-url"),{reloadPage:true,synchronious:true}).done(function(m,l,n,k){if(k){k.remove()}}).fail(function(l,k){})});e.mobile.changePage(e.mobile.activePage.attr("data-url"),{allowSamePageTransition:true,changeHash:false,reloadPage:true,transition:"none"})};e.extend(b,{GUI_DESKTOP_MODE:0,GUI_TABLET_MODE:1,GUI_SMARTPHONE_MODE:2});b.getDisplayMode=function(){return b.GUI_DESKTOP_MODE};b.getDeviceType=function(){var k=e(window).width();if(k<=666){return b.GUI_SMARTPHONE_MODE}else{return b.GUI_DESKTOP_MODE}};b.displayMode=b.getDisplayMode();b.deviceType=b.getDeviceType();var c=e.cookie("lang",{path:"/"})||"en";b.init(c,"gtw");b.i18n.add("/"+b.opt.GUI_VERSION_OPT+"/gui/msg/%L/gui-gen-msg.json");b.i18n.load(c);b.setLanguage(c);function f(m,o){var l=o.toPage,n="/"+b.opt.GUI_VERSION_OPT+"/gui/";if(typeof l==="string"){}else{d.unbind("pagebeforechange",f);if(l[0].id!=="HomePage"){if(l[0].id!=="IndexPage"){if(o.options.dataUrl){j=o.options.dataUrl}else{var k=e.mobile.path.getLocation();j=e.mobile.path.convertUrlToDataUrl(k)}}e.mobile.loadPage(g+h,{showLoadMsg:false,synchronious:true}).done(function(r,q,s,p){o.toPage=s;e.mobile.firstPage=s});o.options.dataUrl=e.mobile.getDocumentUrl();o.options.changeHash=true;l.remove()}}}function a(k,n,m,l){$applybtn=e("#ApplyButton",n);warningMsg=k.attr("data-control-warning");idWarning=k.attr("id")+"Warning";if(!k.val().match(m)){if(warningMsg==undefined||warningMsg==""){if(l=="PIN"){warningMsg=b.i18n.msg("HOME_CTL_PIN")}else{if(l=="IP"||l=="IP_DIGIT"){warningMsg=b.i18n.msg("HOME_CTL_IP")}else{if(l=="MAC"){warningMsg=b.i18n.msg("HOME_CTL_MAC_ADDR")}else{if(l=="MACADDR"){warningMsg=b.i18n.msg("HOME_CTL_MAC_ADDR_BRIDGED")}else{if(l=="PASSPHRASE"){warningMsg=b.i18n.msg("HOME_CTL_PASSPHRASE")}else{if(l=="PORT"){warningMsg=b.i18n.msg("HOME_CTL_PORT")}else{if(l=="URL"){warningMsg=b.i18n.msg("HOME_CTL_URL")}else{if(l=="BASIC_PASSWORD"){warningMsg=b.i18n.msg("HOME_CTL_PASSWORD")}else{if(l=="SSID"){warningMsg=b.i18n.msg("HOME_CTL_SSID")}else{if(l=="NUMBER"){warningMsg=b.i18n.msg("HOME_CTL_NUMBER_IN_SEC")}else{if(l=="REQUIRED"){warningMsg=b.i18n.msg("HOME_CTL_REQUIRED")}else{warningMsg=""}}}}}}}}}}}}if(warningMsg!==""&&warningMsg!==undefined){if(e("#"+idWarning,n).attr("id")!==idWarning){if(k.parent().get(0).tagName=="P"){_top=k.parent().parent()}else{_top=k.parent()}_top.append('<p id="'+idWarning+'" class="gui-status-warning text-danger"><br/>'+warningMsg+"</p>")}}if($applybtn!==undefined){$applybtn.data("disabled",true)}}else{if(e("#"+idWarning,n).attr("id")==idWarning){e("#"+idWarning,n).remove()}if($applybtn!==undefined){$applybtn.data("disabled",false)}}}d.bind("pagebeforechange",f).bind("pagechange",function(k,m){var o=m.toPage,l="/"+b.opt.GUI_VERSION_OPT+"/gui/tpl/src/";if(o[0].id==="HomePage"){e.mobile.pageContainer.children(".gui-settings").remove()}if(b.client.isConnected()){if(j){var n=j;if(j.indexOf("login")>-1){n=l+h}j=undefined;setTimeout(function(){e.mobile.changePage(n,{})},100)}}else{setTimeout(function(){b.openLoginForm({code:b.XMO_NO_ERR,description:"no error"})},100)}}).bind("pageload",function(k,l){}).delegate(":jqmData(role='page'), :jqmData(role='dialog'), .ui-simpledialog-container","pagecreate",function(n){var m=e(this),k=e(":jqmData(role='footer')",m),l=m.hasClass("gui-settings");if(b.displayMode===b.GUI_DESKTOP_MODE){if(l){m.children().wrapAll('<div class="gui-settings-dialog">')}}m.objset({client:b.client});e(":jqmData(xmo-role='item')",m).item({objset:m});e(":jqmData(xmo-role='status')",m).status({objset:m,autoSubscribe:true});e(":jqmData(xmo-role='statusStatic')",m).status({objset:m,autoSubscribe:false});e(":jqmData(xmo-role='statistic')",m).status({objset:m,notify:false,autoSubscribe:false});e(":jqmData(xmo-role='timestatus')",m).timestatus({objset:m});e(":jqmData(xmo-role='input')",m).input({objset:m});e(":jqmData(xmo-role='select')",m).select({objset:m});e(":jqmData(xmo-role='radio')",m).radio({objset:m}).find("input").change(function(){e(this).checkboxradio("refresh")});e(":jqmData(xmo-role='array')",m).array({objset:m,autoSubscribe:true});e(":jqmData(xmo-role='submit')",m).click(function(o){b.submitAction(m,false,o)});e(":jqmData(role='selecthost')",m).selecthost();e(":jqmData(control-type='PIN')",m).keyup(function(){a(e(this),m,"^[0-9]{4}$","PIN")});e(":jqmData(control-type='IP')",m).keyup(function(){a(e(this),m,"^(([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])$","IP")});e(":jqmData(control-type='IP_DIGIT')",m).keyup(function(){a(e(this),m,"^(([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5]))$","IP_DIGIT")});e(":jqmData(control-type='MAC')",m).keyup(function(){a(e(this),m,"^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$","MAC")});e(":jqmData(control-type='MACADDR')",m).keyup(function(){a(e(this),m,"^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$","MACADDR")});e(":jqmData(control-type='PASSPHRASE')",m).keyup(function(){a(e(this),m,"^[^$`']{8,63}$","PASSPHRASE")});e(":jqmData(control-type='PORT')",m).keyup(function(){a(e(this),m,"^(?:6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{1,3}|[1-9])$","PORT")});e(":jqmData(control-type='URL')",m).keyup(function(){a(e(this),m,"^[a-zA-Z-_/.0-9#:?=&;,%]*$","URL")});e(":jqmData(control-type='BASIC_PASSWORD')",m).keyup(function(){a(e(this),m,"^[0-9A-Za-z]*$","BASIC_PASSWORD")});e(":jqmData(control-type='SSID')",m).keyup(function(){a(e(this),m,"^[a-zA-Z0-9' {}[\\]\\':\"./?!@#^<>%*()_+=-]{1,32}$","SSID")});e(":jqmData(control-type='NUMBER')",m).keyup(function(){a(e(this),m,"^[0-9]+$","NUMBER")});e(":jqmData(control-type='REQUIRED')",m).keyup(function(){a(e(this),m,"^(?![s ]*$)","REQUIRED")});m.guiTranslate();e("#CancelButton",m).click(function(o){o.preventDefault();o.stopImmediatePropagation();e.mobile.changePage(e(this).attr("href"),{reverse:true})})}).delegate(":jqmData(role='page'), :jqmData(role='dialog')","pagebeforeshow",function(m,n){var k=e(this);if(b.client.isConnected()){k.objset("load")}e("#FONTab",k).hide();if(e("#FONTab",k).length){e("#FONTab",k).hide();var l=b.client.newRequest();currentLogin=b.client.user.charAt(0).toUpperCase()+b.client.user.substr(1);l.getValue("Device/Services/BGCHotspotService/GUI/"+currentLogin+"/ShowHotspotPage",function(p,o){if(p||p=="true"){e("#FONTab",k).show()}});l.send()}if(d[0]!=undefined){d[0].title=b.i18n.msg("LOGIN_WELCOME")}});e.fn.enable=function(){this.filter(".ui-input-text").textinput("enable").end();this.filter(":button").button("enable").button("refresh").end();this.filter("a.ui-btn").removeClass("ui-disabled").end();this.filter(".ui-slider-switch").slider("enable").slider("refresh").end();this.filter("select:not(.ui-slider-switch)").selectmenu();this.filter("select:not(.ui-slider-switch)").selectmenu("enable").selectmenu("refresh",true);return this};e.fn.disable=function(){this.filter(".ui-input-text").textinput("disable").end();this.filter(":button").button("disable").button("refresh").end();this.filter("a.ui-btn").addClass("ui-disabled").end();this.filter(".ui-slider-switch").slider("disable").slider("refresh").end();this.filter("select:not(.ui-slider-switch)").selectmenu();this.filter("select:not(.ui-slider-switch)").selectmenu("refresh",true);return this};e.fn.refresh=function(){this.filter(":button").button("refresh").end();this.filter(".ui-slider-switch").slider("refresh").end();this.filter("select:not(.ui-slider-switch)").selectmenu();this.filter("select:not(.ui-slider-switch)").selectmenu("refresh",true);return this};e(window).bind("beforeunload",function(){var k=b.client.newRequest();k.resetNotifications();k.send()});b.submitAction=function(r,k,q){var o=r;var p=e(":jqmData(xmo-role='submit')",o),m=e(":jqmData(role='footer')",o),l=m.find("a"),n=o.hasClass("gui-settings");if(p.is(".ui-disabled")){q.preventDefault()}else{if((o.context.id=="WiFiPage"&&p.triggerHandler("wifipagetrigger")==true)||(o.context.id=="NatPage"&&p.triggerHandler("natpagetrigger")==true)||(o.context.id=="DHCPDNSPage"&&p.triggerHandler("dhcpagetrigger")==true)||(o.context.id=="UserPage"&&p.triggerHandler("userpagetrigger")==true)||(o.context.id=="FirewallPage"&&p.triggerHandler("firewallpagetrigger")==true)||(o.context.id=="DectSettingsPage"&&p.triggerHandler("dectpagetrigger")==true)||(o.context.id=="MPTCPPage"&&p.triggerHandler("mptcppagetrigger")==true)||(o.context.id=="PhonebookPage"&&p.triggerHandler("phonebookpagetrigger")==true)||(o.context.id=="CallSettingsPage"&&p.triggerHandler("callsettingspagetrigger")==true)||(o.context.id=="Phone1Page"&&p.triggerHandler("fxssettingspagetrigger")==true)||(o.context.id=="Phone2Page"&&p.triggerHandler("fxssettingspagetrigger")==true)||(o.context.id=="MaintenancePage"&&p.triggerHandler("maintenancepagetrigger")==true)||(o.context.id=="RemoteAccessPage"&&p.triggerHandler("remoteaccesspagetrigger")==true)){return}else{e.mobile.loading("show",{text:b.i18n.msg("HOME_SUBMIT_MODIF"),textVisible:true});o.objset("submit",function(s){e("#ApplyButton",o).data("force-enabled",false);if(n&&!k){e.mobile.changePage(g+h,{reverse:true})}else{e.mobile.changePage(l.attr("href"),{reverse:true})}},function(s){e.mobile.loading("hide");if(!(o.context.id=="DHCPDNSPage"&&s.code==b.XMO_REQUEST_ID_ERR)){b.alert(b.i18n.msg("HOME_SUBMIT_ERROR"))}});if(!o.objset("modified")){l.not(p).enable();e.mobile.loading("hide")}if(o.context.id=="DHCPDNSPage"&&o.context.gatewayIpModified===true){delete o.context.gatewayIpModified;setTimeout(function(){e.mobile.changePage(g+h,{reverse:true})},5000)}}}};b.isAdmin=function(l){var k=b.client.newRequest();k.getValue("Device/DHCPv4/Clients",function(m){l(true)},function(m){l(false)});k.send()}});jQuery(function(d){var a=d.gui,b={},c;d(document).delegate(".gui-settings","pagebeforecreate",function(){var e=d(this);d(".gui-advanced-btn",e).attr({});d(".gui-gear-btn",e).attr({"data-role":"button","data-inline":true,"data-mini":true,"data-icon":"forward","data-iconpos":"right"});$refreshBtn=d("#FooterRefreshBtn",e);if($refreshBtn.length){var f=$refreshBtn.attr("href");$refreshBtn.attr("href",f+"&puid="+(new Date().getTime()))}}).delegate(".gui-settings","pagecreate",function(){var e=d(this);d("#Menu",e).append('<li class="navbar-menu gui-tab-active pull-right gui-user-settings"><a class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a></li>');d("#Menu li a.navbar-toggle",e).click(function(){console.log("start toggle");d("#Menu li",e).toggleClass("menu-open")});if(a.displayMode===a.GUI_SMARTPHONE_MODE){d("#Menu",e).wrap("<div>").parent().attr({"data-theme":"c","data-role":"navbar"});d("ul.gui-info",e).attr({"data-role":"listview","data-inset":true})}else{d(function(){d("#selectable").bind("mousedown",function(f){f.metaKey=true}).selectable()});d(".cp-allow-all").click(function(){d("#selectable li").removeClass("ui-selected")});d(".cp-deny-all").click(function(){d("#selectable li").addClass("ui-selected")});d("#Menu",e).wrap('<div class="gui-tabs" >').find("a").attr({"data-theme":"b","data-role":"none","data-transition":"none"}).end().find(".ui-btn-active").parent().addClass("gui-tab-active")}d(":jqmData(role='header')",e).append('<a href="../home/home.html" class="ui-btn-right" data-theme="c" data-icon="delete" data-direction="reverse" data-iconpos="notext"></a>');d("#Menu",e).find("a:not(.navbar-toggle):not(.ui-btn-active)").click(function(g,h){if((e.objset("modified")||d("#ApplyButton",e).data("force-enabled"))&&b[e.attr("id")]){g.preventDefault();g.stopImmediatePropagation();var j=this.pathname.substring(this.pathname.lastIndexOf("/")+1)+this.search;var f=d(this);d("<div>").simpledialog2({mode:"blank",width:"300px",themeDialog:"d",showModal:false,blankContent:"<br/><p align='center'>"+a.i18n.msg("HOME_CONFIRM_CHANGE_PAGE")+"</p><br/><p align='right' data-role='footer'><a rel='close' data-xmo-role='submit' id='ApplyButtonDialog' data-role='button' href='#' data-inline='true' data-mini='true' data-theme='b' data-icon='check'>"+a.i18n.msg("HOME_YES")+"</a><a id='CancelButtonDialog' rel='close' data-role='button' href='#' data-inline='true' data-theme='d' data-mini='true' data-icon='delete'>"+a.i18n.msg("HOME_NO")+"</a></p>"});d("#CancelButtonDialog").click(function(){d.mobile.changePage(f.attr("href"),{transition:"none",changeHash:true});d.mobile.loadPage(e.attr("data-url"),{reloadPage:true,synchronious:true}).done(function(m,l,n,k){if(k){k.remove()}}).fail(function(l,k){})});d("#ApplyButtonDialog").click(function(k){a.submitAction(e,true,k);setTimeout(function(){d.mobile.changePage(f.attr("href"),{transition:"none",changeHash:false})},100)})}})}).delegate(".gui-settings","pageinit",function(){var e=d(this);d(".ui-header a[title=Close]").hide();d(".gui-advanced-btn",e).click(function(){$btn=d(this);$btn.toggleClass("ui-icon-top").parent().find(".gui-advanced-info").slideToggle("slow");if($btn.text()==a.i18n.msg("HOME_ADVANCED")){$btn.text(a.i18n.msg("HOME_HIDE_ADVANCED"))}else{$btn.text(a.i18n.msg("HOME_ADVANCED"))}return false});d(".gui-advanced-info",e).hide();b[e.attr("id")]=false;e.find("#Menu li:not(.gui-tab-active) a").addClass("ui-disabled");e.bind("objsetload",function(f,g){b[e.attr("id")]=true;e.find("#Menu li:not(.gui-tab-active) a").removeClass("ui-disabled");d.mobile.loading("hide");d(".ui-loader",e).hide();d(".ui-content",e).removeClass("ui-disabled")})}).delegate(".gui-settings","pageshow",function(){var e=d(this);if(d.firstSettingsPageLoad){d.firstSettingsPageLoad=false;a.refreshPage()}if(e.data("url").indexOf("/access/")===-1){d(window).off("throttledresize")}else{d(window).off("throttledresize");d(window).on("throttledresize",function(){var g=a.getDeviceType();if(g!==a.deviceType){a.deviceType=g;a.refreshPage()}})}function f(){var h=d(window).height();var g=d(window).width();if(g>768){h=h-300}else{h=h-200}d(".gui-settings-dialog > .ui-content").height(h)}f();d(window).resize(function(){f()});d(".gui-info label",e).on("click",function(g){g.preventDefault()});d("label.ui-submit").on("hover",function(g){g.preventDefault()});if(!b[e.attr("id")]){d.mobile.loading("show",{text:"Loading page",textVisible:true});d(".ui-loader",e).show();d(".ui-content",e).addClass("ui-disabled");c=setTimeout(function(){b[e.attr("id")]=true;d.mobile.loading("hide");d(".ui-loader",e).hide();e.find("#Menu li:not(.gui-tab-active) a").removeClass("ui-disabled");d(".ui-loader",e).hide();d(".ui-content",e).removeClass("ui-disabled")},5000)}if(e.attr("id")==="DectSettingsPage"){b.DectSettingsPage=true;e.find("#Menu li:not(.gui-tab-active) a").removeClass("ui-disabled");d.mobile.loading("hide");d(".ui-loader",e).hide();d(".ui-content",e).removeClass("ui-disabled")}}).delegate(".gui-settings","pagehide",function(){clearTimeout(c)})});jQuery(function(b){var a=b.gui;b(document).delegate(".gui-settings","pagebeforecreate",function(){var d=b(this),c=a.client.user;d.find(":jqmData(role='footer')").find("a").attr("data-role","button")}).delegate(".gui-settings","pageinit",function(){var c=b(this),e=b("#ApplyButton",c);e.disable();var d=function(){var f=false;if(e.data("disabled")!==undefined&&e.data("disabled")){f=true}if((c.objset("modified")&&!f)||(e.data("force-enabled"))){e.enable()}else{e.disable()}};c.change(function(){d()});b(":input",c).keyup(function(){d()});c.delegate(":checkbox:not(#DeviceEjectForceCheck)","change",function(){e.data("force-enabled",true);d()})}).delegate(".gui-settings","pagebeforeshow",function(){var e=b(this),d=e.children(":jqmData(role='header')"),c=b("#Menu li",d),f=c.has('a[href="#"]');c.not(f).children("a").removeClass("ui-btn-active");f.children("a").addClass("ui-btn-active")})});jQuery(function(b){var a=b.gui;b(document).delegate(".gui-device-settings","pagebeforecreate",function(){var g=b(this),k=b.QueryString(g.data("url")),e=g.children(":jqmData(role='header')"),c=b("#Menu li",e),f=b("h1",e);if(k.host!==undefined){var j=".gui-device-"+k.interf,h={TV_DECODER:".gui-device-decoder",PRINTER:".gui-device-printer",STORAGE:".gui-device-storage",DONGLE_3G:".gui-device-3g"},d;j+=h[k.type]||".gui-device-other";f.not(j).remove();d=c.filter(j);c.not(d).remove();d.children("a").each(function(m){var n=b(this),l=n.attr("href");l=l.replace("host=uid","host="+k.host).replace("interf=if","interf="+k.interf).replace("type=type","type="+k.type).replace("&radio=freq",(k.radio===undefined)?"":"&radio="+k.radio);n.attr("href",l)});b(":jqmData(xpath)",g).each(function(){var m=b(this),l=m.attr("data-xpath");l=l.replace("'uid'","'"+k.host+"'");m.attr("data-xpath",l)})}else{f.add(c).filter(".gui-device").remove()}if(k.radio==="5G"){b(".gui-wifi-radio",g).text("5")}}).delegate(".gui-device-settings","pagecreate",function(){var c=b(this),d=b.QueryString(c.data("url"));if(d.host!==undefined){b("#DeviceDeleteBtn",c).click(function(){var e=a.client.newRequest();e.deleteElement("Device/Hosts/Hosts/Host[@uid='"+d.host+"']",function(){b.mobile.changePage(c.parent().children("#HomePage"))});e.send()})}})});jQuery(function(f){var b=f.gui,g,k,e,d,j,h,m,a,n=false,l;var c=function(o){var p=o.description;if(o.description.indexOf("Ajax error")!=-1){p=b.i18n.msg("LOGIN_ERR_COMM_GTW")}else{switch(o.code){case b.XMO_AUTHENTICATION_ERR:p=b.i18n.msg("LOGIN_AUTH_FAILURE");break;case b.XMO_SESSION_LOGOUT_ERR:p=b.i18n.msg("LOGIN_USER_SESSION_LOGOUT");break;case b.XMO_SESSION_TIMEOUT_ERR:p=b.i18n.msg("LOGIN_USER_SESSION_TIMEOUT");break;case b.XMO_INVALID_SESSION_ERR:p=b.i18n.msg("LOGIN_INVALID_USER_SESSION");break;case b.XMO_MAX_SESSION_COUNT_ERR:p=b.i18n.msg("LOGIN_MAX_SESSION_COUNT");break;case b.XMO_REQUEST_ID_ERR:p=b.i18n.msg("LOGIN_XMO_REQUEST_ID_ERR");break;case b.XMO_REMOTE_ADDRESS_ERR:p=b.i18n.msg("LOGIN_XMO_REMOTE_ADDRESS_ERR");break;default:p=o.description}}return p};b.openLoginForm=function(o){if(!n){n=true;l=o;f.mobile.changePage("/"+b.opt.GUI_VERSION_OPT+"/gui/tpl/src/home/login.html",{transition:"pop",role:"page",changeHash:true,reloadPage:true})}};f.gui.api.Client.defaults.requestErrorFunc=function(p,q){var o=f.gui,r=f(".gui-msg-login");if(q.actions[0]!=undefined){if(q.actions[0].error.code==o.XMO_MAX_SESSION_COUNT_ERR){o.openLoginForm(q.actions[0].error);r.removeClass("hide").find("span").text(c(q.actions[0].error));f("#LoginSubmit").enable(true);return false}}if(p.code==o.XMO_REQUEST_ID_ERR){this.client._clean();o.openLoginForm(p);f("#LoginSubmit").enable(true);return false}else{if((p.code===o.XMO_INVALID_SESSION_ERR)||(p.code===o.XMO_SESSION_LOGOUT_ERR)||(p.code===o.XMO_SESSION_TIMEOUT_ERR)){if(this.client.isConnected()){this.client._clean();o.openLoginForm(p)}}else{if(p.code===o.XMO_REQUEST_ACTION_ERR){return true}else{this.client._clean();o.openLoginForm(p)}}}return false};b.client=new b.api.Client({cookie:"bbox3_session",session:{nss:[{name:"gtw",uri:"http://sagemcom.com/gateway-data"}],"context-flags":{"no-default":false},"capability-flags":{flags:true,"default-value":true,type:true},depth:2,"capability-depth":1,"max-add-events":5,"write-only-string":"_XMO_WRITE_ONLY_","undefined-write-only-string":"_XMO_UNDEFINED_WRITE_ONLY_"}});f(document).delegate("#LoginPage","pagecreate",function(){var o,p;g=f(this);k=f("#LoginSubmitBtn",this);e=f("#UserName",this);d=f("#UserPwd",this);m=f(".gui-msg-login",this);f('input:radio[name="LanguageRadio"]').filter('[value="'+b.language.lang+'"]').attr("checked",true);e.keypress(function(q){if(q.keyCode==f.ui.keyCode.ENTER){d.focus()}});d.keypress(function(q){if(q.keyCode==f.ui.keyCode.ENTER){k.click()}});k.blur(function(q){e.focus()});k.click(function(r,t){var s="/"+b.opt.GUI_VERSION_OPT+"/gui/tpl/src/";var u="home/home.html";var q=b.opt.XMO_SESSION_TIMEOUT_OPT;m.addClass("hide");b.client.openSession(e.val(),d.val(),function(){n=false;f.mobile.changePage(s+u,{transition:"pop",role:"page",changeHash:true,reloadPage:true});f.firstBGCConnection=true;f.firstSettingsPageLoad=true},function(v){b.client.openSession(e.val().toLowerCase(),d.val(),function(){n=false;f.mobile.changePage(s+u,{transition:"pop",role:"page",changeHash:true,reloadPage:true});f.firstBGCConnection=true},function(w){l=w;m.removeClass("hide").find("span").text(c(w))},{sessionTimeout:q})},{sessionTimeout:q})})}).delegate("#LoginPage","pageinit",function(){f(".ui-header a.ui-btn",this).remove();f(this).removeClass("hide")}).delegate("#LoginPage","pagebeforeshow",function(){f(window).off("throttledresize")}).delegate("#LoginPage","pageshow",function(){d.val("");if(l.code===b.XMO_NO_ERR){m.addClass("hide")}else{m.removeClass("hide").find("span").text(c(l))}if(e.val()===""){e.focus()}else{d.focus()}if(f.mobile.sdCurrentDialog!=undefined){f.mobile.sdCurrentDialog.destroy()}f("#HomePage").remove();f("#LoginPage").addClass("ui-page-active")})});jQuery(window).one("pagechange",function(){var a=$.gui;if(a.client.isConnected()){a.refreshPage()}});jQuery(function(d){var a=d.gui,e=[],h=0,g=0,k=[],j=[],f=[],b=[],c=["Fast5336v"];d.ipTVMinBlock=-1;d.ipTVMaxBlock=-1;if(!Array.prototype.indexOf){Array.prototype.indexOf=function(m){var l=this.length;var n=Number(arguments[1])||0;n=(n<0)?Math.ceil(n):Math.floor(n);if(n<0){n+=l}for(;n<l;n++){if(n in this&&this[n]===m){return n}}return -1}}a.isSetTopBox=function(l){if(l.VendorClassID.indexOf("SAIPP430MC")==0||l.VendorClassID.indexOf("IPTV")==0||l.VendorClassID.indexOf("i3 micro STB Mood 300")==0){return true}return false};a.createDevice=function(l){var p,n="";switch(l._gui_type){case"wifi":n="&radio="+l._gui_radio;case"ethernet":var q=l.IPAddress.split(".");lastIPBlock=parseInt(q[3]);if(a.isSetTopBox(l)==true){l.UserDeviceType="TV_DECODER"}p=d("#IPDeviceTmpl").tmpl({type:l.UserDeviceType,friendlyName:l.UserFriendlyName,hostName:l.HostName,uid:l.uid,mac:l.PhysAddress,ip:l.IPAddress,page:"../ethernet/device.html?host="+l.uid+"&interf="+l._gui_type+n+"&type="+l.UserDeviceType});break;case"fxs":p=d("#PhoneLineTmpl").tmpl({uid:l.uid,number:l.DirectoryNumber,page:"../fxs/phone.html?host="+l.uid+"&line="+l.LineId});break;case"dect":case"usb":portNumber="";portSide=a.i18n.msg("HOME_NONE");if(l.UserFriendlyName!=""){usbName=l.UserFriendlyName}else{usbName=a.i18n.msg("DEVUSB_REMOVABLE_DISC")}if(l.SysfsId.split(".").shift().split("-").pop()==="1"){portSide=a.i18n.msg("HOME_BACK")}else{if(l.SysfsId.split(".").shift().split("-").pop()==="2"){portSide=a.i18n.msg("HOME_FRONT")}}if(l.SysfsId.indexOf(".")!==-1){var m=l.SysfsId.split(".");m.shift();for(var o=0;o<m.length;o++){portNumber+="-"+m[o]}}p=d("#USBDeviceTmpl").tmpl({type:l.UserDeviceType,uid:l.uid,usb_name:usbName,port:portSide+portNumber,page:"../usb/device.html?host="+l.uid+"&interf="+l._gui_type+"&type="+l.UserDeviceType});break;default:p=d();break}return p};a.getSettingsDeviceHeaderInfos=function(n,l){if(n.host!==undefined){switch(n.type){case"PHONE":d(".gui-settings-icon img",l).attr("src","../../../img/icon-telephone-c.png");break;case"NETWORKACCESSPOINT":d(".gui-settings-icon img",l).attr("src","../../../img/icon-net-access-point-c.png");break;case"AUDIOVIDEO":d(".gui-settings-icon img",l).attr("src","../../../img/icon-audio-video-c.png");break;case"GAMECONSOLE":d(".gui-settings-icon img",l).attr("src","../../../img/icon-gamming-c.png");break;case"STORAGE":d(".gui-settings-icon img",l).attr("src","../../../img/icon-usb-c.png");break;case"PRINTER":d(".gui-settings-icon img",l).attr("src","../../../img/icon-printer-c.png");break;case"TABLET":d(".gui-settings-icon img",l).attr("src","../../../img/icon-tablet-c.png");break;case"MOBILE_PHONE":d(".gui-settings-icon img",l).attr("src","../../../img/icon-gsm-c.png");break;case"TV_DECODER":d(".gui-settings-icon img",l).attr("src","../../../img/icon-tv-c.png");break;case"WIFI_BRIDGE":d(".gui-settings-icon img",l).attr("src","../../../img/icon-wifi-bridge-c.png");break;case"WIFI_REPEATER":d(".gui-settings-icon img",l).attr("src","../../../img/icon-wifi-bridge-repeater-c.png");break;case"PLC":d(".gui-settings-icon img",l).attr("src","../../../img/icon-wifi-bridge-plc-c.png");break;default:d(".gui-settings-icon img",l).attr("src","../../../img/icon-laptop-c.png")}var m=a.client.newRequest();m.getValue("Device/Hosts/Hosts/Host[@uid='"+n.host+"']",function(o){if(o.UserFriendlyName.trim()!=""){d("#DeviceName",l).html(o.UserFriendlyName.trim())}else{if(o.HostName.trim()!=""){d("#DeviceName",l).html(o.HostName);d("#DeviceHostName",l).html(o.HostName)}else{d("#DeviceName",l).html(a.i18n.msg("HOME_DEVICE"));d("#DeviceHostName",l).html(a.i18n.msg("HOME_DEVICE"))}}});m.send()}};a.updateDeviceType=function(p,m,n,r){var q=d("a",n);var o=d(".dev-icon",n);var l=d.QueryString(q.attr("href"));l.type=p;q.attr("href","../ethernet/device.html?"+d.param(l));o.attr("class",p+" dev-icon");if(r._gui_type==="usb"){if(p==="PRINTER"){d("h4",n).text(a.i18n.msg("HOME_PRINTER"))}else{if(p==="STORAGE"){d("h4",n).text(a.i18n.msg("HOME_USB_DEVICE"))}else{if(p==="DONGLE_3G"){d("h4",n).text(a.i18n.msg("HOME_3G_DONGLE"))}else{d("h4",n).text(a.i18n.msg("HOME_USB_DEVICE"))}}}}else{if(m.friendlyName===""){if(p==="TV_DECODER"){d("h4",n).text(a.i18n.msg("HOME_TVDECODER"))}else{if(m.hostName===""){d("h4",n).text(a.i18n.msg("HOME_DEVICE"))}}}}};d(document).delegate("#HomePage","pagebeforecreate",function(){var l=d(this),m=a.client.newRequest();m.getValue("Device/DeviceInfo/ProductClass",function(n){d.ProductClass=n});m.send({synchronous:true});if(d.inArray(d.ProductClass,c)>-1){m.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/SIP/Clients",function(n){j=n});m.getValue("Device/Services/VoiceServices/VoiceService[@uid='1']/CallControl/Lines",function(n){k=n});m.getValue("Device/Services/VoiceServices/VoiceService[@uid='1']/CallControl/IncomingMaps",function(n){b=n});m.getValue("Device/Services/VoiceServices/VoiceService[@uid='1']/DECT/Portables",function(n){f=n});m.send({synchronous:true})}else{d("#fxsCard",l).remove();d("#phonebookCard",l).remove()}d(".bgc-network-map").not(this).empty();d.mobile.firstPage=l;d("#Internet",l).wrapAll('<div id="InternetBlock" class="bgc-network" >');d("#Access",l).wrapAll('<div id="AccessBlock" class="bgc-network" >');d("#Device",l).wrapAll('<div class="bgc-gateway" >');d("a",l).attr({"data-role":"button","data-transition":"slidedown","data-theme":"x"});d(".ui-li-count").remove()}).delegate("#HomePage","pagecreate",function(){var v=d(this),o=[],w=[],p=[],s=0,z=0,y;e={wifi2G4:d("#WiFi2G4Devices",v),wifi5G:d("#WiFi5GDevices",v),ethernet:d("#Ethernet_devices",v),extensions:d("#Phone_lines",v),usb:d("#USB_devices",v)};d.firstSettingsPageLoad=false;d("#bgc-help-btn",v).click(function(){if(d(".helpDiv").is(":visible")){d(".helpDiv").hide()}else{d(".helpDiv").show()}});d(".link-hide-help-info").click(function(D){d(".helpDiv").hide()});d('input:radio[name="LanguageRadio"]').filter('[value="'+a.language.lang+'"]').attr("checked",true);d("#bgc-logout-btn",v).click(function(){a.client.closeSession();a.openLoginForm({code:a.XMO_SESSION_LOGOUT_ERR,description:"user session logout"})});d("#HardwareVersion",v).bind("itemvalue",function(D,E){d("body").addClass("gui-hardware-"+E.value.toLowerCase())});var r=d("#FonStatusValue",v);var u=d("#FonLogoWifi",v);var q=d("#wiFiUnifiedFonStatusValue",v);var n=d("#wiFiUnifiedFonLogoWifi",v);r.hide();u.hide();q.hide();n.hide();var A=function(E,F,D){var G=a.client.newRequest();currentLogin=a.client.user.charAt(0).toUpperCase()+a.client.user.substr(1);G.onValueChange("Device/Services/BGCHotspotService/GUI/"+currentLogin+"/ShowHotspotPage",function(J,I){var K=""+J;var H=E.text();if(K=="true"){F.show();if(H=="Enabled"){F.addClass("gui-fon-on");F.removeClass("gui-fon-status");d(".fon-status-icon span#"+D,v).text("ON")}else{if(H=="Disabled"){F.addClass("gui-fon-on");F.removeClass("gui-fon-status");d(".fon-status-icon span#"+D,v).text("OFF")}else{if(H=="Error"){F.removeClass("gui-fon-on");F.addClass("gui-fon-status");d(".fon-status-icon span#"+D,v).text("")}}}}else{F.hide()}},function(H){},{notifyCurrentValue:true});G.send()};r.bind("statusvalue",function(D,E){A(r,u,"HotspotStatus");A(q,n,"wiFiUnifiedHotspotStatus")});r.change(function(D,E){A(r,u,"HotspotStatus");A(q,n,"wiFiUnifiedHotspotStatus")});a.eWiFiStatusEnabled=false;d("#3GStatus",v).hide();d("#PPPStatus",v).hide();d("#NetworkStatus",v).hide();d("#PPPLogin",v).hide();d("#DSLStatus",v).hide();d("#WANStatus",v).hide();a.checkConnectChange=function(){var D=d("#InternetStatus select"),I=d("#DSLStatus",v).status("value"),F=d("#WANStatus",v).status("value"),E,H="",K="",J=a.client.newRequest(),G=d("#PPPStatus",v),L=d("#NetworkStatus",v);d("#Internet",v).attr("href","../internet/network.html");y=d("#NetworkTopologyValue",v).text();if(!!y&&y.toLowerCase()==="titan"){E=L.status("value");if(E=="ENABLED"){D.val("UPTITAN").change();d("#Internet .gearIm img",v).attr("src","../../../img/icon-gear-c.png")}else{if(d("#3GStatus",v).status("value")=="UP"){D.val("BACKUP").change();d("#Internet .gearIm img",v).attr("src","../../../img/icon-gear-c.png")}else{if(I!="UP"){if(F!="UP"){D.val("NETWORK_DOWN").change();d("#Internet",v).attr("href","../internet/intercepte.html")}else{D.val("INTERNET_DOWN").change();d("#Internet",v).attr("href","../internet/intercepte.html")}}else{D.val("INTERNET_DOWN").change();d("#Internet",v).attr("href","../internet/intercepte.html")}d("#Internet .gearIm img",v).attr("src","../../../img/icon-gear-b.png")}}}else{E=G.status("value");if(E=="UP"){D.val("UP").change();d("#Internet .gearIm img",v).attr("src","../../../img/icon-gear-c.png")}else{if(d("#3GStatus",v).status("value")=="UP"){D.val("BACKUP").change();d("#Internet .gearIm img",v).attr("src","../../../img/icon-gear-c.png")}else{if(I!="UP"){if(F!="UP"){D.val("NETWORK_DOWN").change();d("#Internet",v).attr("href","../internet/intercepte.html")}else{var J=a.client.newRequest();J.getValue("Device/PPP/Interfaces/Interface[Alias='PPP_DATA']",function(N,M){H=N.Username;K=N.Password},{"session-options":{depth:2}});J.send({synchronous:true});if((H.length==0)||(K.length==0)){D.val("UNCONFIGURED").change();d("#Internet",v).attr("href","../internet/network.html?section=Internet")}else{D.val("INTERNET_DOWN").change();d("#Internet",v).attr("href","../internet/intercepte.html")}}}else{var J=a.client.newRequest();J.getValue("Device/PPP/Interfaces/Interface[Alias='PPP_DATA']",function(N,M){H=N.Username;K=N.Password},{"session-options":{depth:2}});J.send({synchronous:true});if((H.length==0)||(K.length==0)){D.val("UNCONFIGURED").change();d("#Internet",v).attr("href","../internet/network.html?section=Internet")}else{D.val("INTERNET_DOWN").change();d("#Internet",v).attr("href","../internet/intercepte.html")}}d("#Internet .gearIm img",v).attr("src","../../../img/icon-gear-b.png")}}}};d("#PPPStatus, #DSLStatus, #PPPLogin, #WANStatus",v).bind("statusvalue",function(D,E){a.checkConnectChange()});d("#3GStatus",v).bind("statusvalue",function(D,E){a.checkConnectChange()});d("#MinAddressTV",v).bind("itemvalue",function(D,E){minIpTvAddr=E.value.split(".");if(minIpTvAddr.length==4){d.ipTVMinBlock=parseInt(minIpTvAddr[3]);d.ipTVMin=E.value}});d("#MaxAddressTV",v).bind("itemvalue",function(D,E){maxIpTvAddr=E.value.split(".");if(maxIpTvAddr.length==4){d.ipTVMaxBlock=parseInt(maxIpTvAddr[3]);d.ipTVMax=E.value}});if(d.inArray(d.ProductClass,c)>-1){d("#CallExtensions",v).bind("arraybeforeinsert",function(D,E){}).bind("arrayinsert",function(E,M){var I=M.value,F,J,D,Q,O=[],N=[],R=[],L=[],T=[],H={},G=[];if(w[I.uid]==undefined){R=searchRecursive(b,"Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/Extensions/Extension[Alias='"+I.Alias+"']","Extension");N=searchRecursive(R,true,"Enable");O=searchRecursive(R,false,"Enable");if(N.length===0){L=[];T=[]}else{if(N.length===1){L.push(searchFirstOccurence(k,getAliasFromXPath(N[0].Line),"Alias"));T.push(searchFirstOccurence(j,getAliasFromXPath(L[0].Provider),"Alias"))}else{if(N.length>1){for(var K=0;K<N.length;K++){var S=searchFirstOccurence(k,getAliasFromXPath(N[K].Line),"Alias");L.push(S);var P=searchFirstOccurence(j,getAliasFromXPath(S.Provider),"Alias");T.push(P)}}}}if(I.Provider.indexOf("FXSs")!==-1){if(L.length===0){F=d("#PhoneLineTmpl").tmpl({uid:I.uid,number:a.i18n.msg("HOME_NONE"),page:"#"})}else{if(L.length===1){F=d("#PhoneLineTmpl").tmpl({uid:I.uid,number:(L[0].Status!=="UP")?a.i18n.msg("HOME_NOT_REGISTERED"):T[0].RegisterURI.split("@")[0].replace("sip:",""),page:"../fxs/phone.html?line="+L[0].Alias+"&client="+T[0].Alias+"&index="+I.uid+"&lineid="+L[0].uid})}else{if(L.length>1){F=d("#PhoneLineTmpl").tmpl({uid:I.uid,number:((L[0].Status!=="UP")?"• "+a.i18n.msg("HOME_NOT_REGISTERED"):"• "+T[0].RegisterURI.split("@")[0].replace("sip:",""))+"\n\n <br>\n\n"+((L[1].Status!=="UP")?"• "+a.i18n.msg("HOME_NOT_REGISTERED"):"• "+T[1].RegisterURI.split("@")[0].replace("sip:","")),page:"../fxs/phone.html?line="+L[0].Alias+","+L[1].Alias+"&client="+T[0].Alias+","+T[1].Alias+"&index="+I.uid+"&lineid="+L[0].uid+","+L[1].uid});d("p.gui-device-fxs-number",F).addClass("dual-line")}}}}else{H=searchFirstOccurence(f,getAliasFromXPath(I.Provider),"Alias");for(var K=0;K<k.length;K++){if(k[K].Status==="UP"){G[K]=k[K];G[K].Client={};G[K].Client=searchFirstOccurence(j,getAliasFromXPath(k[K].Provider),"Alias");G[K].Client.Number=G[K].Client.RegisterURI.split("@")[0].replace("sip:","")}else{G[K]=k[K];G[K].Client={};G[K].Client=searchFirstOccurence(j,getAliasFromXPath(k[K].Provider),"Alias");G[K].Client.Number=a.i18n.msg("HOME_NOT_REGISTERED")}}if(L.length===0){F=d("#DectTmpl").tmpl({uid:I.uid,name:I.Name,dectUid:H.uid,lines:G,asscociations:[],enabledMapUid:R[0].uid,disabledMapUid:R[1].uid,page:"../dect/handset.html?handset="+I.Alias+"&dect="+getAliasFromXPath(I.Provider)})}else{if(L.length===1){F=d("#DectTmpl").tmpl({uid:I.uid,name:I.Name,dectUid:H.uid,lines:G,asscociations:T[0],enabledMapUid:R[0].uid,disabledMapUid:R[1].uid,page:"../dect/handset.html?handset="+I.Alias+"&dect="+getAliasFromXPath(I.Provider)+"&line="+L[0].uid})}else{if(L.length>1){F=d("#DectTmpl").tmpl({uid:I.uid,name:I.Name,dectUid:H.uid,lines:G,asscociations:T,enabledMapUid:R[0].uid,disabledMapUid:R[1].uid,page:"../dect/handset.html?handset="+I.Alias+"&dect="+getAliasFromXPath(I.Provider)+"&line="+L[0].uid+","+L[1].uid})}}}}F.guiTranslate();w[""+I.uid]=F;if(I.Provider.indexOf("DECT")!==-1){if(H.RegistrationStatus==="IN_REACH"){F.removeClass("hidden");w[""+I.uid].active=true}else{F.addClass("hidden")}}d("#DectStatus_"+I.uid,F).status({objset:v,autoSubscribe:false,classTarget:F});d("#DectCallStatus_"+I.uid,F).status({objset:v,autoSubscribe:false,classTarget:F});d("#DectCallStatus_"+I.uid,F).status({objset:v,autoSubscribe:false,classTarget:F});d("#DectName_"+I.uid,F).status({objset:v,autoSubscribe:false,classTarget:F});v.objset("load");e.extensions.append(F).listview("refresh");d(".handset-line-select",F).on("change",function(Y){var X=a.client.newRequest(),Z=d(this).val(),V=d(this).data("enabled-map-id"),W=d(this).data("disabled-map-id"),U=d(this);if(Z!==""){if(Z==="NONE"){X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/IncomingMaps/IncomingMap[@uid='"+V+"']/Enable",false);X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/IncomingMaps/IncomingMap[@uid='"+W+"']/Enable",false);X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/OutgoingMaps/OutgoingMap[@uid='"+V+"']/Enable",false);X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/OutgoingMaps/OutgoingMap[@uid='"+W+"']/Enable",false)}else{if(Z==="BOTH"){X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/IncomingMaps/IncomingMap[@uid='"+V+"']/Enable",true);X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/IncomingMaps/IncomingMap[@uid='"+W+"']/Enable",true);X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/OutgoingMaps/OutgoingMap[@uid='"+V+"']/Enable",true);X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/OutgoingMaps/OutgoingMap[@uid='"+W+"']/Enable",true)}else{if(Z==="LINE1"){X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/IncomingMaps/IncomingMap[@uid='"+V+"']/Enable",true);X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/IncomingMaps/IncomingMap[@uid='"+W+"']/Enable",false);X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/OutgoingMaps/OutgoingMap[@uid='"+V+"']/Enable",true);X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/OutgoingMaps/OutgoingMap[@uid='"+W+"']/Enable",false)}else{if(Z==="LINE2"){X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/IncomingMaps/IncomingMap[@uid='"+V+"']/Enable",false);X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/IncomingMaps/IncomingMap[@uid='"+W+"']/Enable",true);X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/OutgoingMaps/OutgoingMap[@uid='"+V+"']/Enable",false);X.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/OutgoingMaps/OutgoingMap[@uid='"+W+"']/Enable",true)}}}}X.send(function(){U.closest("li").effect("highlight",{color:"#00bbed"},500)},function(){U.closest("li").effect("highlight",{color:"#cc0000"},500)})}});if(I.Provider.indexOf("DECT")!==-1){F.click(function(){d.mobile.changePage(d(this).find("div.phone-device-infos").attr("data-url"),{transition:"slidedown"})});d("select.handset-line-select, #Phone_lines li select.handset-line-select option",F).click(function(U){U.preventDefault();U.stopPropagation()})}}}).bind("arraybeforeremove",function(E,F){var D=F.item,G=D.value();w[""+G.uid].active=false;w[""+G.uid].remove();e.extensions.listview("refresh")})}var C="";var t="";paramRadio="",newDeviceType="";a.hostListData=[];var x={wifi2G4:{idElem:"WiFi2G4Devices",hosts:[]},wifi5G:{idElem:"WiFi5GDevices",hosts:[]},wifiUnified:{idElem:"WiFiUnifiedDevices",hosts:[]},ethernet:{idElem:"Ethernet_devices",hosts:[]},usb:{idElem:"USB_devices",hosts:[]}},B=true;var v=d(this);d("#WiFi2G4Devices",v).addClass("devicesList ui-listview-inset");d("#WiFi5GDevices",v).addClass("devicesList ui-listview-inset");d("#WiFiUnifiedDevices",v).addClass("devicesList ui-listview-inset");d("#Ethernet_devices",v).addClass("devicesList ui-listview-inset");d("#WiFi2G4Devices",v).html("");d("#WiFi5GDevices",v).html("");d("#WiFiUnifiedDevices",v).html("");d("#Ethernet_devices",v).html("");d("#nbConnectedDevices",v).text("0");var l=[];a.calculateHosts=function(D){var E=0;z=0;d.each(D,function(G,H){if(D[G]!=undefined){if(D[G].Active){if(D[G].isSetTopBox){z+=1}else{if(D[G].Layer1Interface!="usb"&&D[G].IPAddress.trim()!=""){E+=1}}}}});var F="";if(E>1){F=E+" "+a.i18n.msg("HOME_CONNECTED_DEVICES")}else{F=E+" "+a.i18n.msg("HOME_CONNECTED_DEVICE")}if(z>1){F+=" "+a.i18n.msg("HOME_AND")+"<br/>"+z+" "+a.i18n.msg("HOME_SETTOPBOXCONNECTEDS")}else{if(z==1){F+=" "+a.i18n.msg("HOME_AND")+"<br/>"+z+" "+a.i18n.msg("HOME_SETTOPBOXCONNECTED")}}d("#nbConnectedDevices",v).html(F)};setInterval(function(){if(d(document.getElementById("HomePage")).is(":hidden")&&d(".gui-settings").size()==0&&d(".gui-login-dialog").size()==0){d.gui.refreshPage()}},5000);a.pollingEnhancedWiFi=function(){a.checkConnectChange();var D=a.client.newRequest();D.getValue("Device/Services/EnhancedWiFi/GUI/ShowEnhancedWiFi",function(G){if(G){d("#wiFiUnifiedButton",v).removeClass("hide");var E=a.client.newRequest();E.getValue("Device/Services/EnhancedWiFi/Name",function(H){d("#eWifiName",v).text(H)});E.getValue("Device/Services/EnhancedWiFi/Status",function(H){if(H==="ENABLED_CONDUCTOR_ON"||H==="ENABLED_CONDUCTOR_OFF"){d("#eWiFiStatusSelect",v).text(a.i18n.E_WIFI_ENABLED);d("#wiFiUnifiedSection",v).removeClass("hide");d("#wiFi2G4Section",v).addClass("hide");d("#wiFi5GSection",v).addClass("hide");a.eWiFiStatusEnabled=true}else{d("#wiFiUnifiedSection",v).addClass("hide");d("#wiFi2G4Section",v).removeClass("hide");d("#wiFi5GSection",v).removeClass("hide");a.eWiFiStatusEnabled=false;d("#eWiFiStatusSelect",v).text(a.i18n.E_WIFI_DISABLED);if(H==="ERROR"){d("#eWiFiStatusSelect",v).text(a.i18n.ERROR)}}});E.send()}else{var F=a.client.newRequest();F.getValue("Device/Services/EnhancedWiFi/Enable",function(H){if(H){d("#eWiFiStatusSelect",v).text(a.i18n.E_WIFI_ENABLED);d("#wiFiUnifiedSection",v).removeClass("hide");d("#wiFi2G4Section",v).addClass("hide");d("#wiFi5GSection",v).addClass("hide");a.eWiFiStatusEnabled=true}});d("#wiFiUnifiedButton",v).addClass("hide");F.send()}});D.send()};a.pollingEnhancedWiFi();d.pollingAlreadyStarted=false;a.pollingHostList=function(){a.pollingEnhancedWiFi();d.pollingAlreadyStarted=true;var E=a.client.newRequest();E.getValue("Device/WiFi/SSIDs/SSID",function(F){if(F.Alias=="WL_PRIV"){d("#WiFi2G4Lib",v).text(F.SSID);d("#WiFiUnifiedLib",v).text(F.SSID)}if(F.Alias=="WL_VIDEO_5G"){d("#WiFi5GLib",v).text(F.SSID)}});var D=[];E.getValue("Device/Hosts/Hosts/Host",function(F){a.updateDeviceInfo(F);D.push(F);var G=a.compareObjHostDevice(F,a.hostListData);if(G=="newItem"){a.drawTemplateHostDevice(F)}else{if(G=="updateItem"){a.updateTemplateHostDevice(F)}else{if(G=="updateTypeItem"){a.clearOldHostType(F);a.drawTemplateHostDevice(F)}}}},function(F){console.log(F)});E.send(function(G){var F=a.purgeHostList(D,a.hostListData);d.each(F,function(H,J){a.clearOldHostType(J);for(var I=0;I<a.hostListData.length;I++){if(J.PhysAddress==a.hostListData[I].PhysAddress){a.hostListData.splice(I,1);return}}});a.calculateHosts(D);setTimeout(a.pollingHostList,5000);setTimeout(a.checkConnectChange,5000)},function(F){console.log("err")});a.recycleSip()};var m=a.client.newRequest();m.getValue("Device/Hosts/Hosts/Host",function(D){a.updateDeviceInfo(D);a.drawTemplateHostDevice(D);a.hostListData.push(D)},function(D){console.log(D)});m.send(function(D){a.checkConnectChange();if(!d.pollingAlreadyStarted){a.pollingHostList()}},function(D){console.log(D)});a.updateDeviceInfo=function(D){switch(D.InterfaceType){case"WiFi":if(D.Layer1Interface.search("PHY5")!==-1||D.Layer1Interface.indexOf("5G")!==-1){D.Layer1Interface=(a.eWiFiStatusEnabled)?"wifiUnified":"wifi5G";paramRadio="&radio=5G"}else{D.Layer1Interface=(a.eWiFiStatusEnabled)?"wifiUnified":"wifi2G4";paramRadio="&radio=2G4"}break;case"Ethernet":if(D.Layer1Interface.search("PHY5")!==-1){D.InterfaceType="WiFi";D.Layer1Interface="wifi5G";paramRadio="&radio=5G"}else{D.Layer1Interface="ethernet";paramRadio=""}break;case"USB":D.Layer1Interface="usb";paramRadio="";break;default:D.Layer1Interface="ethernet"}if(a.isSetTopBox(D)==true){D.UserDeviceType="TV_DECODER";D.isSetTopBox=true}else{D.isSetTopBox=false}if(D.Layer1Interface==="usb"){portNumber="";portSide=a.i18n.msg("HOME_NONE");if(D.UserFriendlyName.trim()==""){D.UserFriendlyName=a.i18n.msg("DEVUSB_REMOVABLE_DISC")}if(D.SysfsId.split(".").shift().split("-").pop()==="1"){portSide=a.i18n.msg("HOME_BACK")}else{if(D.SysfsId.split(".").shift().split("-").pop()==="2"){portSide=a.i18n.msg("HOME_FRONT")}}if(D.SysfsId.indexOf(".")!==-1){var E=D.SysfsId.split(".");E.shift();for(var F=0;F<E.length;F++){portNumber+="-"+E[F]}}D.port=portSide+portNumber}if(D.UserFriendlyName.trim()==""){if(D.HostName.trim()!=""){D.UserFriendlyName=D.HostName.trim()}else{D.UserFriendlyName=a.i18n.msg("HOME_DEVICE")}}};a.drawTemplateHostDevice=function(H){if(H.IPAddress==""&&H.Layer1Interface!="usb"){classHideHostWithEmptyIPAddr="hide"}else{classHideHostWithEmptyIPAddr=""}if(!H.Active){C="gui-status-disconnected-host"}else{C=""}if((classHideHostWithEmptyIPAddr==""||H.Layer1Interface=="usb")&&!!H.Hidden){t="hide"}else{t=""}var E=document.getElementById(x[H.Layer1Interface].idElem);var G=H.PhysAddress.replace(/:/g,"_").toLowerCase();if(d(E).find("#"+G).length>0){return}if(H.Layer1Interface!="usb"){d(E).append("<li id='"+G+"' class='"+classHideHostWithEmptyIPAddr+" "+C+" "+t+" ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-corner-top ui-corner-bottom ui-btn-up-c'><div class='ui-li'><div class='ui-btn-text'>  <a class='ui-link-inherit' href='../ethernet/device.html?host="+H.uid+"&interf="+H.InterfaceType.toLowerCase()+paramRadio+"&type="+H.UserDeviceType+"'><div class='"+H.UserDeviceType+" dev-icon'></div>    <h4 class='ui-li-heading'>"+H.UserFriendlyName+"</h4>    <div><p class='gui-device-mac-addr ui-li-desc'>"+H.PhysAddress+"</p><p style='height:15px;' class='gui-device-ip-addr ui-li-desc'>"+H.IPAddress+"</p></div>  </a></div></div></li>")}else{var F="HOME_USB_DEVICE",D="SC-USB";if(H.UserDeviceType=="PRINTER"){F="HOME_PRINTER";D="PRINTER"}else{if(H.UserDeviceType=="SC-Dect"){F="HOME_3G_DONGLE";D="SC-Dect"}}d(E).append("<li id='"+G+"' class='"+t+" ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-corner-top ui-corner-bottom ui-li-last ui-btn-up-c'><div class='ui-li'><div class='ui-btn-text'>  <a class='ui-link-inherit' href='../usb/device.html?host="+H.uid+"&interf="+H.InterfaceType.toLowerCase()+"&type="+H.UserDeviceType+"'>    <div class='"+D+' dev-icon\'></div>    <h4  class="ui-li-heading" xmsg="'+F+'" >USB device</h4>    <p class="usb-name ui-li-desc">'+H.UserFriendlyName+'</p>    <p class="ui-li-desc"><span xmsg="HOME_PORT">Port</span>:&nbsp;<span class="gui-device-usb-port" >&nbsp;'+H.port+"</span></p>  </a></div></div></li>")}};a.updateTemplateHostDevice=function(E){var D="li#"+E.PhysAddress.replace(/:/g,"_").toLowerCase();if(E.IPAddress!=""){d(D).removeClass("hide")}d(D).find("h4.ui-li-heading").text(E.UserFriendlyName);d(D).find("a.ui-link-inherit").attr("href","../ethernet/device.html?host="+E.uid+"&interf="+E.InterfaceType.toLowerCase()+paramRadio+"&type="+E.UserDeviceType+"");d(D).find("p.gui-device-ip-addr").text(E.IPAddress);d(D).find("div.dev-icon").removeClass().addClass(""+E.UserDeviceType+" dev-icon");if(E.Active===false){d(D).addClass("gui-status-disconnected-host")}else{d(D).removeClass("gui-status-disconnected-host")}if(E.Hidden===true){d(D).addClass("hidden")}else{d(D).removeClass("hidden")}};a.clearOldHostType=function(E){var D="li#"+E.PhysAddress.replace(/:/g,"_").toLowerCase();d(D,v).remove()};a.compareObjHostDevice=function(G,F){var D=d.grep(F,function(I){return I.PhysAddress==G.PhysAddress}),H=false,E=false;if(D.length==0){F.push(G);return"newItem"}else{if((D[0].UserDeviceType!==G.UserDeviceType)||(D[0].UserFriendlyName!==G.UserFriendlyName)||(D[0].HostName!==G.HostName)||(D[0].IPAddress!==G.IPAddress)||(D[0].Active!==G.Active)||(D[0].Hidden!==G.Hidden)){H=true}if((D[0].InterfaceType!==G.InterfaceType)||(D[0].Layer1Interface!==G.Layer1Interface)){E=true}if(H||E){d.each(F,function(I,J){if(J.PhysAddress==G.PhysAddress){F[I].UserDeviceType=G.UserDeviceType;F[I].UserFriendlyName=G.UserFriendlyName;F[I].HostName=G.HostName;F[I].IPAddress=G.IPAddress;F[I].Active=G.Active;F[I].Layer1Interface=G.Layer1Interface;F[I].InterfaceType=G.InterfaceType;F[I].Hidden=G.Hidden}return})}return(E)?"updateTypeItem":((H)?"updateItem":"nochange")}return"nochange"};a.purgeHostList=function(D,E){var F=[];d.grep(E,function(H){var G=d.grep(D,function(I){return I.PhysAddress==H.PhysAddress});if(G.length==0){F.push(H)}});return F};a.render=function(G,E,D){for(var F=0;F<G.length/2;F++){if(G[F].Enable&&G[F+6].Enable){d(d("#Phone_lines li .gui-device-fxs-number",v).get(F)).html("• "+(E.status?E.number:a.i18n.msg("HOME_NOT_REGISTERED"))+" <br/> • "+(D.status?D.number:a.i18n.msg("HOME_NOT_REGISTERED")));d(d("#Phone_lines li .gui-device-fxs-number",v).get(F)).addClass("dual-line");d("#HandsetLineSelect_"+(F+1),v).val("BOTH");d(d("#Phone_lines li a",v).get(F)).attr("href","../fxs/phone.html?line=LINE1,LINE2&client=CLIENT1,CLIENT2&index=1&lineid=1,2");if(d(d("#Phone_lines .phone-device-infos",v).get(F)).attr("data-url")!==undefined){d(d("#Phone_lines .phone-device-infos",v).get(F)).attr("data-url","../dect/handset.html?handset=EXT"+(F+1)+"&dect=DECT_PP"+(F-1)+"&line=1,2")}}else{if(G[F].Enable&&!G[F+6].Enable){d(d("#Phone_lines li .gui-device-fxs-number",v).get(F)).html((E.status?E.number:a.i18n.msg("HOME_NOT_REGISTERED")));d(d("#Phone_lines li .gui-device-fxs-number",v).get(F)).removeClass("dual-line");d("#HandsetLineSelect_"+(F+1),v).val("LINE1");d(d("#Phone_lines li a",v).get(F)).attr("href","../fxs/phone.html?line=LINE1&client=CLIENT1&index=1&lineid=1");if(d(d("#Phone_lines .phone-device-infos",v).get(F)).attr("data-url")!==undefined){d(d("#Phone_lines .phone-device-infos",v).get(F)).attr("data-url","../dect/handset.html?handset=EXT"+(F+1)+"&dect=DECT_PP"+(F-1)+"&line=1")}}else{if(!G[F].Enable&&G[F+6].Enable){d(d("#Phone_lines li .gui-device-fxs-number",v).get(F)).html((D.status?D.number:a.i18n.msg("HOME_NOT_REGISTERED")));d(d("#Phone_lines li .gui-device-fxs-number",v).get(F)).removeClass("dual-line");d("#HandsetLineSelect_"+(F+1),v).val("LINE2");d(d("#Phone_lines li a",v).get(F)).attr("href","../fxs/phone.html?line=LINE2&client=CLIENT2&index=2&lineid=2");if(d(d("#Phone_lines .phone-device-infos",v).get(F)).attr("data-url")!==undefined){d(d("#Phone_lines .phone-device-infos",v).get(F)).attr("data-url","../dect/handset.html?handset=EXT"+(F+1)+"&dect=DECT_PP"+(F-1)+"&line=2")}}else{if(!G[F].Enable&&!G[F+6].Enable){d(d("#Phone_lines li .gui-device-fxs-number",v).get(F)).html(a.i18n.msg("HOME_NONE"));d(d("#Phone_lines li .gui-device-fxs-number",v).get(F)).removeClass("dual-line");d("#HandsetLineSelect_"+(F+1),v).val("NONE");d(d("#Phone_lines li a").get(F),v).attr("href","#");if(d(d("#Phone_lines .phone-device-infos",v).get(F)).attr("data-url")!==undefined){d(d("#Phone_lines .phone-device-infos",v).get(F)).attr("data-url","../dect/handset.html?handset=EXT"+(F+1)+"&dect=DECT_PP"+(F-1))}}}}}}d("#Phone_lines li .handset-line-select option[value='LINE1']",v).text(E.status?E.number:a.i18n.msg("HOME_NOT_REGISTERED"));d("#Phone_lines li .handset-line-select option[value='LINE2']",v).text(D.status?D.number:a.i18n.msg("HOME_NOT_REGISTERED"));if(!E.status&&!D.status){d(".handset-line-select").hide();if(!d(".gui-device-dect-number span",v).length){d(".gui-device-dect-number",v).append("<span>"+a.i18n.msg("HOME_NOREGISTERED_LINE")+"</span>")}}else{d(".handset-line-select",v).show();d(".gui-device-dect-number span",v).remove()}};a.pollingDECTStatus=function(D,F){var E=d("#DectId_"+D);if(F=="IN_REACH"){if(w[""+D]!==undefined){w[""+D].active=true;E.removeClass("gui-status-disconnected-host");E.removeClass("hidden")}}else{E.addClass("hidden")}};a.pollingDECTCallStatus=function(D,F){var E=d("#DectId_"+D);if(F=="ALERTING"){(ringDect=function(){d(".dev-icon",E).delay(2000).effect("bounce",{times:5,direction:"left"},ringDect)})();E.removeClass("gui-status-offhook-dect")}else{if(F=="CONNECTED"){d(".dev-icon",E).clearQueue();d(".dev-icon",E).css("left",0);E.addClass("gui-status-offhook-dect")}else{d(".dev-icon",E).clearQueue();d(".dev-icon",E);E.removeClass("gui-status-offhook-dect")}}};a.recycleSip=function(){var D=d.gui.client.newRequest();D.getValue("Device/Services/VoiceServices/VoiceService[@uid='1']/CallControl/IncomingMaps");D.getValue("Device/Services/VoiceServices/VoiceService[@uid='1']/SIP/Clients/Client[@uid='1']");D.getValue("Device/Services/VoiceServices/VoiceService[@uid='1']/SIP/Clients/Client[@uid='2']");d(".dectDevices",v).each(function(){var G=d(this).attr("data-uid"),F=d("#DectStatus_"+G).attr("data-xpath"),E=d("#DectCallStatus_"+G).attr("data-xpath");xpathDectName=d("#DectName_"+G).attr("data-xpath");D.getValue(F,function(H){a.pollingDECTStatus(G,H)});D.getValue(E,function(H){a.pollingDECTCallStatus(G,H)});D.getValue(xpathDectName,function(H){d("#DectName_"+G).text(H)})});D.send(function(G){var H=(G.actions[0]&&G.actions[0].callbacks[0])?G.actions[0].callbacks[0].parameters.value:[],F={status:(G.actions[1]&&G.actions[1].callbacks[0])?G.actions[1].callbacks[0].parameters.value.Client.Status==="UP":null,number:(G.actions[1]&&G.actions[1].callbacks[0])?G.actions[1].callbacks[0].parameters.value.Client.RegisterURI.split("@")[0].replace("sip:",""):null},E={status:(G.actions[2]&&G.actions[2].callbacks[0])?G.actions[2].callbacks[0].parameters.value.Client.Status==="UP":null,number:(G.actions[2]&&G.actions[2].callbacks[0])?G.actions[2].callbacks[0].parameters.value.Client.RegisterURI.split("@")[0].replace("sip:",""):null};a.render(H,F,E)})}}).delegate("#HomePage","pagebeforeshow",function(){d(window).off("throttledresize");var n=d(this),m=n.children(".ui-header"),p=d(".gui-login-name",m),o=d(".gui-logged-in",m),q=d(".gui-logged-out",m),l=a.client.user;a.checkConnectChange();if(l===""){o.hide();q.show()}else{q.hide();p.text(l);o.show()}}).delegate("#HomePage","pageshow",function(){var m=d(this);d.firstSettingsPageLoad=false;a.checkConnectChange();if(a.client.isConnected()){var n=setInterval(function(){if(d("#WiFi2G4Lib",m).text()!=""){clearInterval(n);d(".loading-custom",m).remove();window.scrollTo(0,0)}},2000)}d("#popupArrow-popup").hide();d("#open-popupArrow").unbind("click").bind("click",function(o){d("#popupArrow-screen").toggleClass("ui-screen-hidden");d("#popupArrow-popup").toggleClass("ui-selectmenu-hidden");d("#popupArrow-popup").toggle(100)});d("#popupArrow-screen").click(function(o){if(!d("#popupArrow-screen").hasClass("ui-screen-hidden")){d("#popupArrow-screen").addClass("ui-screen-hidden");d("#popupArrow-popup").addClass("ui-selectmenu-hidden");d("#popupArrow-popup").hide()}});function l(){try{var r=d("#open-popupArrow").offset();var o=r.top;var p=r.left;d("#popupArrow-popup").css({left:p,top:o})}catch(q){console.log(q)}}l();d(window).resize(function(){l()})})});function changeNL(){$.gui.setLanguage("nl");$.xmo.timestatus.prototype.options.longFormat="%j dag(en) %H:%M:%S"}function changeFR(){$.gui.setLanguage("fr");$.xmo.timestatus.prototype.options.longFormat="%j jour(s) %H:%M:%S"}function changeEN(){$.gui.setLanguage("en");$.xmo.timestatus.prototype.options.longFormat="%j day(s) %H:%M:%S"}jQuery(function(b){var a=b.gui;b(document).delegate("#DevicesPage","pagebeforecreate",function(){var f=b(this),g=b.QueryString(f.data("url")),e=b("h1",f),c=b(":jqmData(role=list-divider) span",f),d=b("#DeviceList",f);g.radio=(g.radio===undefined)?"":g.radio;e.not(".gui-devices-"+g.type+g.radio).hide();if(g.type==="fxs"){c.not(".gui-devices-fxs").hide()}else{c.filter(".gui-devices-fxs").hide()}devices=b("#ConnectedDevices").item("value");if(b.isArray(devices)){b.each(devices,function(h,j){if(j._gui_type!=g.type){return}if((j._gui_type==="wifi")&&(j._gui_radio!==g.radio)){return}$dev=a.createDevice(j);$dev.attr("data-role","fieldcontain");d.append($dev)})}}).delegate("#DevicesPage","pagecreate",function(){var d=b(this),e=b.QueryString(d.data("url")),c=b("#DeviceList",d);b("#ConnectedDevices").bind("arrayinsert",function(g,h){var j=h.value,f;if(j._gui_type!=e.type){return}if((j._gui_type==="wifi")&&(j._gui_radio!==e.radio)){return}f=a.createDevice(j);f.attr("data-role","fieldcontain");b(":jqmData(xmo-role='status')",f).status({objset:d,autoSubscribe:true,classTarget:f});b(":jqmData(xmo-role='statistic')",f).statistic({objset:d,autoSubscribe:true,classTarget:f,notifTimer:5});c.append(f).listview("refresh");d.objset("load")})})});jQuery(function(b){var a=b.gui;b("#InterceptPage").live("pagecreate",function(d){var c=b(this);b("#ontConnection",c).hide();b("#wanConnectivity",c).hide()}).live("pageload",function(d){var c=b(this);b("#ontConnection",c).hide();b("#wanConnectivity",c).hide()}).live("pagebeforeshow",function(){$page=b(this),req=a.client.newRequest();b("#ontConnection").hide();b("#VLAN4081",$page).remove();req.getValue("Device/Services/BGCNetworkProperties/NetworkTopology",function(c){if(c.toLowerCase()==="titan"&&a.client.user.toLowerCase()!=="user"){b("#VLAN10",$page).remove();b("#VLAN30",$page).remove()}});req.onValueChange("Device/DSL/Lines/Line[Alias='DSL0']/Status",function(d,c){if(d=="UP"){b("#phoneConnection").show();b("#ontConnection").hide();b("#wanConnectivity",$page).hide();b("#dslConnectivity",$page).show()}},function(c){},{notifyCurrentValue:true});req.onValueChange("Device/Ethernet/Interfaces/Interface[Alias='PHY6_WAN_MPTCP']/Status",function(d,c){if(d=="UP"){b("#connectionWay1").hide();b("#connectionWay2").show();b("#phoneConnection").hide();b("#ontConnection").show();b("#wanConnectivity",$page).show();b("#dslConnectivity",$page).hide()}else{b("#connectionWay1").show();b("#connectionWay2").hide();b("#phoneConnection").show();b("#ontConnection").hide();b("#wanConnectivity",$page).hide();b("#dslConnectivity",$page).show()}},function(c){},{notifyCurrentValue:true});req.send()})});jQuery(function(c){var b=c.gui,a=b.client.user;c(document).delegate("#NetworkPage","pagecreate",function(){var g=c(this),e,j=b.client.newRequest(),f=b.client.newRequest();if(b.client.user.toLowerCase()!=="user"){b.isAdmin(function(k){if(k==true){c("#Menu li",g).not(".gui-user-settings").show();c("#VLAN4081",g).remove();c("#bw1",g).append("<h3>"+b.i18n.msg("NETWORK_BANDWIDTH_DW_UP")+"</h3>");c("#bw1",g).append("<p>");c("#bw1 p",g).append('<span class="gui-downstream" data-xmo-role="statistic" data-xpath="Device/DSL/Channels/Channel[Alias=\'DSL0\']/DownstreamCurrRate" >&nbsp;</span>');c("#bw1 p",g).append('<span>/</span><span class="gui-upstream" data-xmo-role="statistic" data-xpath="Device/DSL/Channels/Channel[Alias=\'DSL0\']/UpstreamCurrRate" >&nbsp;</span>');c("#bw1 p",g).append("<span>&nbsp;Kbps</span>");c("#bw2",g).append("<h3>"+b.i18n.msg("NETWORK_DATA_TRANSFER")+"</h3>");c("#bw2",g).append("<p>");c("#bw2 p",g).append('<span class="gui-sent" data-xmo-role="statistic" data-xpath="Device/DSL/Lines/Line[Alias=\'DSL0\']/Stats/BytesSent" >&nbsp;</span>');c("#bw2 p",g).append('<span>/</span><span class="gui-received" data-xmo-role="statistic" data-xpath="Device/DSL/Lines/Line[Alias=\'DSL0\']/Stats/BytesReceived" >&nbsp;</span>');c("#bw3",g).append("<h3>"+b.i18n.msg("NETWORK_BANDWIDTH")+"</h3>");c("#bw3",g).append("<p>");c("#bw3 p",g).append('<span data-xmo-role="statistic" data-xpath="Device/Ethernet/Interfaces/Interface[Alias=\'PHY6_WAN_MPTCP\']/MaxBitRate" >&nbsp;</span><span>&nbsp;Mbps</span>');c("#bw4",g).append("<h3>"+b.i18n.msg("NETWORK_DATA_TRANSFER")+"</h3>");c("#bw4",g).append("<p>");c("#bw4 p",g).append('<span class="gui-sent" data-xmo-role="statistic" data-xpath="Device/Ethernet/Interfaces/Interface[Alias=\'PHY6_WAN_MPTCP\']/Stats/BytesSent" >&nbsp;</span>');c("#bw4 p",g).append('<span>/</span><span class="gui-received" data-xmo-role="statistic" data-xpath="Device/Ethernet/Interfaces/Interface[Alias=\'PHY6_WAN_MPTCP\']/Stats/BytesReceived" >&nbsp;</span>')}else{c("#Menu li",g).not(".gui-user-settings").remove()}})}else{c("#Menu li",g).not(".gui-user-settings").remove();c("#VLAN4081",g).remove()}j.getValue("Device/Services/BusinessContinuity/GUI/"+b.client.user+"/ShowWANBackupPage",function(k){if(k){c("#WANBACKUP",g).show()}else{c("#WANBACKUP",g).remove()}});j.getValue("Device/Services/Mptcp_GUI/GUI/"+b.client.user+"/ShowMPTCPPage",function(k){if(k){c("#MPTCP",g).show()}else{c("#MPTCP",g).remove()}});j.send();c("#PPPEmptyWarning").hide();var j=b.client.newRequest(),d=b.client.newRequest();d.getValue("Device/Services/BGCNetworkProperties/NetworkTopology",function(k){e=k});d.send({synchronous:true});if(e.toLowerCase()==="titan"&&b.client.user.toLowerCase()!=="user"){c("#VLAN10",g).remove();c("#VLAN30",g).remove()}if(e.toLowerCase()==="titan"){c(".PPPUsername",g).remove();c(".PPPPassword",g).remove();c("#PPPEnable",g).remove();c("#InternetLegacy",g).text("Network Connection");f.getValue("Device/Ethernet/VLANTerminations/VLANTermination[Alias='VLAN_VOIP']/VLANID",function(k){c(".vlanidtitan",g).text(k)});f.send();c("#PPPProtocol",g).text("IPoE");c("#Video",g).remove();c("#VoIP",g).remove();var h=b.client.newRequest();c("#networkLiIPv6Addr",g).after('<li data-role="fieldcontain" id="networkLiIPv6Prefix"><h3>'+b.i18n.msg("VLAN_IPV6_PREFIX")+'</h3><p class="gui-status-text" id="networkIPv6Prefix" >&nbsp;</p></li>');h.getValue("Device/IP/Interfaces/Interface[Alias='IP_DATA']/IPv6Prefixes",function(k,m){var l="";c.each(k,function(n,o){if(o.PrefixStatus=="PREFERRED"&&(o.Origin=="PREFIXDELEGATION")){l=o.Prefix}});c("#networkIPv6Prefix",g).text(l);if(l==""){c("#networkLiIPv6Addr > p",g).remove();c("#networkLiIPv6Addr",g).append("<p>")}});h.send()}else{c("#InternetLegacy",g).text("Internet");c(".PPPUsername",g).show();c(".PPPPassword",g).show();c("#PPPEnable",g).show();f.getValue("Device/Ethernet/VLANTerminations/VLANTermination[Alias='VLAN_DATA']/VLANID",function(k){c(".vlanidtitan",g).text(k)});f.getValue("Device/IP/Interfaces/Interface[Alias='IP_DATA']/IPv4Addresses/IPv4Address[1]/AddressingType",function(k){if(k=="DHCP"||k=="AUTOIP"||k=="STATIC"){c("#PPPProtocol",g).text("IPoE")}else{if(k=="IPCP"){c("#PPPProtocol",g).text("PPPoE")}}});f.send();c("#Video",g).show();c("#VoIP",g).show()}j.getValue("Device/Ethernet/Links",function(n,k){var o=0;var m=0;for(var l=0;l<n.length;l++){if((n[l].Alias.indexOf("ETHOA")!=-1)||(n[l].Alias.indexOf("VDSL")!=-1)){o+=parseInt(n[l].Stats.PacketsReceived);m+=parseInt(n[l].Stats.PacketsSent)}}c("#DataSent",g).html(m);c("#DataReceived",g).html(o)},{"session-options":{depth:-1}});c("#PPPPasswdInput",g).data("isEmpty","false");j.getValue("Device/PPP/Interfaces/Interface[Alias='PPP_DATA']",function(l,k){if(l.Password!=undefined){if(l.Password=="_XMO_WRITE_ONLY_"){c("#PPPPasswdInput",g).data("isEmpty","false");c("#PPPPasswdInput",g).attr("placeholder","********");c("#PPPPasswdInput",g).ezpz_hint()}else{c("#PPPPasswdInput",g).data("isEmpty","true")}}if(l.Status!=undefined&&l.Status=="UP"){c(".gui-internet-disconnected",g).remove()}else{c(".gui-internet-disconnected",g).show()}},{"session-options":{depth:2}});j.getValue("Device/PPP/Interfaces/Interface[Alias='PPP_DATA_BACKUP']/Status",function(k){if(k=="UP"){c(".gui-internet-disconnected",g).remove()}else{c(".gui-internet-disconnected",g).show()}});if(e==="TITAN"){j.getValue("Device/IP/Interfaces/Interface[Alias='IP_DATA']/IPv4Addresses/IPv4Address[Alias='IP_DATA_ADDRESS']/Status",function(k){if(k=="ENABLED"){c(".gui-internet-disconnected",g).remove()}else{c(".gui-internet-disconnected",g).show()}})}c("#networkLiIPv6Prefix",g).remove();if(b.client.user.toLowerCase()==="user"){c("#networkLiIPv6Addr",g).after('<li data-role="fieldcontain" id="networkLiIPv6Prefix"><h3>'+b.i18n.msg("VLAN_IPV6_PREFIX")+'</h3><p class="gui-status-text" id="networkIPv6Prefix" >&nbsp;</p></li>');j.getValue("Device/IP/Interfaces/Interface[Alias='IP_BR_LAN']/IPv6Prefixes",function(k,m){var l="";c.each(k,function(n,o){if(o.PrefixStatus=="PREFERRED"&&(o.Origin=="PREFIXDELEGATION"||o.Origin=="AUTOCONFIGURED"||o.Origin=="CHILD")){l=o.Prefix}});c("#networkIPv6Prefix",g).text(l);if(l==""){c("#networkLiIPv6Addr > p",g).remove();c("#networkLiIPv6Addr",g).append("<p>")}})}j.send()});c(document).delegate("#NetworkPage","pagebeforeshow",function(){var d=c(this),e=["Fast5336v"];if(c.inArray(c.ProductClass,e)===-1){c("#VoIP",d).remove()}}).delegate("#NetworkPage","pageshow",function(){var e=c(this);c("#ApplyButton",e).disable();c("#3GBackup",e).change(function(){if(c("#3GBackup select").val()=="UP"){c("#3GBackup",e).show()}else{c("#3GBackup",e).hide()}});function d(){if(c("#xDSL select").val()=="UP"&&c("#WANEthernet select").val()=="DOWN"){c("#WANEthernet",e).hide()}if(c("#WANEthernet select").val()=="UP"&&c("#xDSL select").val()=="DOWN"){c("#xDSL",e).hide()}}c("#xDSL",e).change(function(){d()});c("#WANEthernet",e).change(function(){d()});d();function h(){if(c("#PPPPasswdInput",e).data("isEmpty")=="false"||c("#PPPPasswdInput",e).val()!=""){return false}else{return true}}function j(){if((c("#PPPLoginInput").val()==""||h())&&c("#PPPEnableCheck").val()=="true"){if(c("#PPPPasswdInput").parent().is(":visible")){c("#PPPEmptyWarning").show();c("#PPPEnableCheck option[value='false']").attr("selected",true);c("#PPPEnableCheck").slider("refresh")}}else{c("#PPPEmptyWarning").hide()}}var f=b.client.newRequest();f.getValue("Device/Services/BGCTV/Mode",function(k){if(k=="BRIDGED"){c("#DeviceConnectionModeStatusLi").hide()}});f.send();c("#PPPPasswdInput").blur(function(){j()});c("#PPPLoginInput").blur(function(){j()});c("#PPPEnableCheck").change(function(){j()});c(".gui-advanced-btn",e).click(function(){c("#PPPEmptyWarning",e).hide()});var g=c(location).attr("href");params=g.split("?");if(params[1]){param=params[1].split("=");paramSection=param[1];c(".ui-content").animate({scrollTop:250},1000);c("#"+paramSection+" .gui-advanced-btn",e).click()}})});jQuery(function(c){var b=c.gui,a=b.client.user;c(document).delegate("#InterceptPage","pagecreate",function(){var d=c(this),e=b.client.newRequest();if(b.client.user.toLowerCase()!=="user"){b.isAdmin(function(f){if(f==true){c("#Menu li",d).not(".gui-user-settings").show();c("#VLAN4081",d).remove()}else{c("#Menu li",d).not(".gui-user-settings").remove()}})}else{c("#Menu li",d).not(".gui-user-settings").remove();c("#VLAN2",d).remove();c("#VLAN4080",d).remove();c("#VLAN4081",d).remove()}e.getValue("Device/Services/BusinessContinuity/GUI/"+b.client.user+"/ShowWANBackupPage",function(f){if(f){c("#WANBACKUP",d).show()}else{c("#WANBACKUP",d).remove()}});e.getValue("Device/Services/Mptcp_GUI/GUI/"+b.client.user+"/ShowMPTCPPage",function(f){if(f){c("#MPTCP",d).show()}else{c("#MPTCP",d).remove()}});e.getValue("Device/Services/BGCNetworkProperties/NetworkTopology",function(f){if(f.toLowerCase()==="titan"&&b.client.user.toLowerCase()!=="user"){c("#VLAN10",d).remove();c("#VLAN30",d).remove()}});e.send()});c(".gui-internet-page").live("pageshow",function(){var h=c(this);var k=40;var l=function(){var n=0;c(".gui-tabs > ul#Menu li",h).each(function(){var o=c(this).outerWidth();n+=o});return n};var d=function(){var o=c(".gui-tabs",h).outerWidth();var n=((o)-l()-j())-k;if(-n>o){n=-c(".gui-tabs",h).outerWidth()-k}return n};var j=function(){return c(".gui-tabs > ul#Menu",h).position().left};var f=(c(".gui-tabs > ul#Menu .gui-tab-active",h).position().left-j()-k)/c(".gui-tabs",h).outerWidth();if(f>=1){for(var g=0;g<Math.floor(f);g++){c(".gui-tabs > ul#Menu",h).animate({left:"+="+d()+"px"},"slow",function(){if(-d()<=0){c(".scroller-right",h).fadeOut("slow")}c(".scroller-left",h).fadeIn("slow")})}}var e=function(){if((c(".gui-tabs",h).outerWidth())<l()){c(".scroller-right",h).show()}else{c(".scroller-right",h).hide()}if(j()<0){c(".scroller-left",h).show()}else{c(".item",h).animate({left:"-="+j()+"px"},"slow");c(".scroller-left",h).hide()}};e();c(window).off("resize").off("resize").on("resize",function(n){e()});var m=0;c(".scroller-right",h).unbind("click");c(".scroller-right",h).click(function(){m++;if(m===1){c(".gui-tabs > ul#Menu",h).animate({left:"+="+d()+"px"},"slow",function(){if(-d()<=0){c(".scroller-right",h).fadeOut("slow",function(){m=0})}c(".scroller-left",h).fadeIn("slow")})}});c(".scroller-left",h).unbind("click");c(".scroller-left",h).click(function(){m++;if(m===1){c(".scroller-right",h).fadeIn("slow");c(".scroller-left",h).fadeOut("slow");c(".gui-tabs > ul#Menu",h).animate({left:"-="+j()+"px"},"slow",function(){m=0})}})})});jQuery(function(b){var a=b.gui;b(document).delegate("#WANPage","pagecreate",function(){var g=b(this),e=new Array(),j=new Array(),d;if(a.client.user.toLowerCase()!=="user"){a.isAdmin(function(k){if(k==true){b("#Menu li",g).not(".gui-user-settings").show();b("#VLAN4081",g).remove()}else{b("#Menu li",g).not(".gui-user-settings").remove();b(":jqmData(role='header')",g).remove();b(":jqmData(role='content')",g).remove();b(":jqmData(role='footer')",g).remove();b.mobile.changePage("network.html")}})}else{b("#Menu li",g).not(".gui-user-settings").remove();b(":jqmData(role='header')",g).remove();b(":jqmData(role='content')",g).remove();b(":jqmData(role='footer')",g).remove();b.mobile.changePage("network.html")}var h=a.client.newRequest(),f=a.client.newRequest();f.getValue("Device/Services/BGCNetworkProperties/NetworkTopology",function(k){d=k});f.send({synchronous:true});h.getValue("Device/PPP/Interfaces/Interface[Alias='PPP_DATA']",function(k){if(k.Status=="UP"){b(".gui-internet-disconnected",g).remove()}else{b(".gui-internet-disconnected",g).show()}});h.getValue("Device/PPP/Interfaces/Interface[Alias='PPP_DATA_BACKUP']/Status",function(k){if(k=="UP"){b(".gui-internet-disconnected",g).remove()}else{b(".gui-internet-disconnected",g).show()}});if(d==="TITAN"){h.getValue("Device/IP/Interfaces/Interface[Alias='IP_DATA']/IPv4Addresses/IPv4Address[Alias='IP_DATA_ADDRESS']/Status",function(k){if(k=="ENABLED"){b(".gui-internet-disconnected",g).remove()}else{b(".gui-internet-disconnected",g).show()}})}h.send();var h=a.client.newRequest();h.getValue("Device/DSL/Lines/Line[Alias='DSL0']/SNRMpbus",function(l,k){if(l.indexOf(",")!=-1){e=l.split(",");b("#MarginU0",g).html((e[0]!=undefined&&e[0]!="")?e[0]+" dB":"-");b("#MarginU1",g).html((e[1]!=undefined&&e[1]!="")?e[1]+" dB":"-");b("#MarginU2",g).html((e[2]!=undefined&&e[2]!="")?e[2]+" dB":"-")}});h.getValue("Device/DSL/Lines/Line[Alias='DSL0']/SNRMpbds",function(l,k){if(l.indexOf(",")!=-1){j=l.split(",");b("#MarginD1",g).html((j[0]!=undefined&&j[0]!="")?j[0]+" dB":"-");b("#MarginD2",g).html((j[1]!=undefined&&j[1]!="")?j[1]+" dB":"-");b("#MarginD3",g).html((j[2]!=undefined&&j[2]!="")?j[2]+" dB":"-")}});h.getValue("Device/DSL/Lines/Line[Alias='DSL0']/StandardUsed",function(n,l){var m;if(n=="G_992_3_ANNEX_L"){m="(ReADSL)"}else{if(n.indexOf("G_992_1")!=-1){if(n.indexOf("ANNEX_A")!=-1){m=" (ADSL over PSTN)"}else{m=" (ADSL)"}}else{if(n.indexOf("G_992_3")!=-1){if(n.indexOf("ANNEX_A")!=-1){m=" (ADSL2 over PSTN)"}else{m=" (ADSL2)"}}else{if(n.indexOf("G_992_5")!=-1){if(n.indexOf("ANNEX_A")!=-1){m=" (ADSL2+ over PSTN)"}else{m=" (ADSL2+)"}}else{if(n.indexOf("G_993_2")!=-1){m=" (VDSL2)";var k=a.client.newRequest();k.getValue("Device/DSL/Lines/Line[Alias='DSL0']/VectoringState",function(q,p){if(q==="RUNNING"){var o=b("#StdUsed",g).text();o=o.replace("(","G.993.5 (");o=o.replace(")"," vectoring )");b("#StdUsed",g).text(o)}});k.send()}else{m=""}}}}}b("#StdUsed",g).html(n+m)});h.getValue("Device/DSL/Lines/Line[Alias='DSL0']/UpstreamAttenuation",function(l,k){b("#AttnUp",g).html(l/10)});h.getValue("Device/DSL/Lines/Line[Alias='DSL0']/DownstreamAttenuation",function(l,k){b("#AttnDown",g).html(l/10)});h.getValue("Device/DSL/Lines/Line[Alias='DSL0']/UPBOKLE",function(l,k){b("#Upbokle",g).html(l/100)});h.getValue("Device/DSL/Lines/Line[Alias='DSL0']/UpstreamPower",function(l,k){b("#PowerUp",g).html(l/10)});h.getValue("Device/DSL/Lines/Line[Alias='DSL0']/DownstreamPower",function(l,k){b("#PowerDown",g).html(l/10)});h.getValue("Device/DSL/Channels/Channel[Alias='DSL0']/GINPEnabledds",function(l,k){if(l>0){b("#GinpDown",g).text(a.i18n.msg("WAN_ENABLED"))}else{b("#GinpDown",g).text(a.i18n.msg("WAN_DISABLED"))}});h.getValue("Device/DSL/Channels/Channel[Alias='DSL0']/GINPEnabledus",function(l,k){if(l>0){b("#GinpUp",g).text(a.i18n.msg("WAN_ENABLED"))}else{b("#GinpUp",g).text(a.i18n.msg("WAN_DISABLED"))}});h.send();var c=a.client.newRequest();c.getValue("Device/Ethernet/Links",function(x,k){var A=0,v=0,w=0,r=0,q=0,l=0,z=0,s=0,u=0,o=0,m=0,y=0,t=0,n=0;for(var p=0;p<x.length;p++){if((x[p].Alias.indexOf("ETHOA")!=-1)||(x[p].Alias.indexOf("VDSL")!=-1)||(x[p].Alias.indexOf("FTTH")!=-1)){A+=parseInt(x[p].Stats.BytesSent);v+=parseInt(x[p].Stats.BytesReceived);w+=parseInt(x[p].Stats.PacketsSent);r+=parseInt(x[p].Stats.PacketsReceived);q+=parseInt(x[p].Stats.ErrorsSent);l+=parseInt(x[p].Stats.ErrorsReceived);z+=parseInt(x[p].Stats.DiscardPacketsSent);s+=parseInt(x[p].Stats.DiscardPacketsReceived);u+=parseInt(x[p].Stats.UnicastPacketsSent);o+=parseInt(x[p].Stats.UnicastPacketsReceived);m+=parseInt(x[p].Stats.MulticastPacketsSent);y+=parseInt(x[p].Stats.MulticastPacketsReceived);t+=parseInt(x[p].Stats.BroadcastPacketsSent);n+=parseInt(x[p].Stats.BroadcastPacketsReceived)}}b("#TotalBytesTX",g).html(A);b("#TotalBytesRX",g).html(v);b("#TotalPktTX",g).html(w);b("#TotalPktRX",g).html(r);b("#TotalErrTX",g).html(q);b("#TotalErrRX",g).html(l);b("#TotalDiscPktTX",g).html(z);b("#TotalDiscPktRX",g).html(s);b("#TotalUcastPktTX",g).html(u);b("#TotalUcastPktRX",g).html(o);b("#TotalMcastPktTX",g).html(m);b("#TotalMcastPktRX",g).html(y);b("#TotalBcastPktTX",g).html(t);b("#TotalBcastPktRX",g).html(n)},{"session-options":{depth:-1}});c.send()}).delegate("#WANPage","pageinit",function(){var c=b(this);b(".gui-noise-info",c).hide();b(".gui-noise-btn",c).click(function(){noiseBtnText=b(".gui-noise-btn").html();b(".gui-noise-btn").text(noiseBtnText=="(+)"?"(-)":"(+)");b(".gui-noise-info").slideToggle("slow");return false})}).delegate("#WANPage","pagebeforeshow",function(){$page=b(this);b("#ApplyButton",$page).disable();var c=a.client.newRequest();c.getValue("Device/Services/BusinessContinuity/GUI/"+a.client.user+"/ShowWANBackupPage",function(d){if(d){b("#WANBACKUP",$page).show()}else{b("#WANBACKUP",$page).remove()}});c.getValue("Device/Services/Mptcp_GUI/GUI/"+a.client.user+"/ShowMPTCPPage",function(d){if(d){b("#MPTCP",$page).show()}else{b("#MPTCP",$page).remove()}});c.getValue("Device/Services/BGCNetworkProperties/NetworkTopology",function(d){if(d.toLowerCase()==="titan"&&a.client.user.toLowerCase()!=="user"){b("#VLAN10",$page).remove();b("#VLAN30",$page).remove()}});c.send()})});jQuery(function(b){var a=b.gui;b(".gui-vlan-page").live("pagebeforecreate",function(c){var j=b(this),e=b.QueryString(j.data("url")),p=b("#VLAN"+e.vlanid+" a",j),f,d;var n=a.client.newRequest(),g=a.client.newRequest(),o=a.client.newRequest();o.getValue("Device/Services/BGCNetworkProperties/NetworkTopology",function(q){d=q});o.send({synchronous:true});n.getValue("Device/PPP/Interfaces/Interface[Alias='PPP_DATA']",function(q){if(q.Status=="UP"){b(".gui-internet-disconnected",j).remove()}else{b(".gui-internet-disconnected",j).show()}});n.getValue("Device/PPP/Interfaces/Interface[Alias='PPP_DATA_BACKUP']/Status",function(q){if(q=="UP"){b(".gui-internet-disconnected",j).remove()}else{b(".gui-internet-disconnected",j).show()}});if(d==="TITAN"){n.getValue("Device/IP/Interfaces/Interface[Alias='IP_DATA']/IPv4Addresses/IPv4Address[Alias='IP_DATA_ADDRESS']/Status",function(q){if(q=="ENABLED"){b(".gui-internet-disconnected",j).remove()}else{b(".gui-internet-disconnected",j).show()}})}n.send();if(a.client.user.toLowerCase()!=="user"){a.isAdmin(function(q){if(q==true){b("#Menu li",j).not(".gui-user-settings").show();b("#VLAN4081",j).remove()}else{b("#Menu li",j).not(".gui-user-settings").remove();b(":jqmData(role='header')",j).remove();b(":jqmData(role='content')",j).remove();b(":jqmData(role='footer')",j).remove();b.mobile.changePage("network.html")}})}else{b("#Menu li",j).not(".gui-user-settings").remove();b("#VLAN2",j).remove();b("#VLAN4080",j).remove();b("#VLAN4081",j).remove();b(":jqmData(role='header')",j).remove();b(":jqmData(role='content')",j).remove();b(":jqmData(role='footer')",j).remove();b.mobile.changePage("network.html")}g.getValue("Device/Services/BGCNetworkProperties/NetworkTopology",function(q){if(q.toLowerCase()==="titan"&&a.client.user.toLowerCase()!=="user"){b("#VLAN10",j).remove();b("#VLAN30",j).remove()}});g.send();j.attr("id","VLAN"+e.vlanid+"Page");p.attr("href","#").addClass("ui-btn-active").removeAttr("data-prefetch").removeAttr("data-transition");if(a.client.user.toLowerCase()!=="admin"){b("#VLANConfiguration",j).remove()}var m=a.client.newRequest();m.getValue("Device/Managers/NetworkData/InterfaceType",function(q){f=q});m.send({synchronous:true});if(f==="FTTH"||f==="VDSL"){b(":jqmData(xpath)",j).each(function(){var r=b(this),q=r.attr("data-xpath");if(e.vlanid!=="10"){q=q.replace("and Alias='VLAN_DATA'","")}if(e.vlanid==="20"){q=q.replace("'10'","'"+e.vlanid+"'");if(d!=="TITAN"){q=q.replace("IP_DATA","IP_VOIP").replace("IP_BR_LAN","IP_VOIP").replace("DHCLIENT_DATA","DHCLIENT_VOIP")}r.attr("data-xpath",q)}else{if(e.vlanid==="30"){q=q.replace("'10'","'"+e.vlanid+"'").replace("IP_DATA","IP_IPTV").replace("IP_BR_LAN","IP_IPTV").replace("DHCLIENT_DATA","DHCLIENT_IPTV");r.attr("data-xpath",q)}else{if(e.vlanid==="2"){q=q.replace("'10'","'"+e.vlanid+"'").replace("IP_DATA","IP_MNGT_LTE");r.attr("data-xpath",q)}else{if(e.vlanid==="4080"){q=q.replace("'10'","'"+e.vlanid+"'").replace("IP_DATA","IP_BUSINESS_CONTINUITY");r.attr("data-xpath",q)}else{if(e.vlanid==="4081"){q=q.replace("'10'","'"+e.vlanid+"'").replace("IP_DATA","IP_DATA_MPTCP");r.attr("data-xpath",q)}}}}}})}else{var h={"10":"Device/ATM/Links/Link[Alias='ATM_DATA']/","20":"Device/ATM/Links/Link[Alias='ATM_VOIP']/","30":"Device/ATM/Links/Link[Alias='ATM_IPTV1']/","2":"Device/Ethernet/VLANTerminations/VLANTermination[VLANID='2']/","4080":"Device/Ethernet/VLANTerminations/VLANTermination[VLANID='4080']/","4081":"Device/Ethernet/VLANTerminations/VLANTermination[VLANID='4081']/"},k="";if(a.client.user.toLowerCase()!=="expert"){k=b("#VLANEnableCheck",j).attr("data-xpath");k=h[e.vlanid]+k.substr(k.lastIndexOf("/")+1);b("#VLANEnableCheck",j).attr("data-xpath",k)}b(":jqmData(xpath)",j).each(function(){var r=b(this),q=r.attr("data-xpath");if(r.hasClass("gui-sent")||r.hasClass("gui-received")){q=h[e.vlanid]+"Stats/"+q.substr(q.lastIndexOf("/")+1);r.attr("data-xpath",q)}else{if(e.vlanid!=="10"){q=q.replace("and Alias='VLAN_DATA'","")}if(e.vlanid==="20"){q=q.replace("'10'","'"+e.vlanid+"'");if(d!=="TITAN"){q=q.replace("IP_DATA","IP_VOIP").replace("IP_BR_LAN","IP_VOIP").replace("DHCLIENT_DATA","DHCLIENT_VOIP")}r.attr("data-xpath",q)}else{if(e.vlanid==="30"){q=q.replace("'10'","'"+e.vlanid+"'").replace("IP_DATA","IP_IPTV").replace("IP_BR_LAN","IP_IPTV").replace("DHCLIENT_DATA","DHCLIENT_IPTV");r.attr("data-xpath",q)}else{if(e.vlanid==="2"){q=q.replace("'10'","'"+e.vlanid+"'").replace("IP_DATA","IP_MNGT_LTE");r.attr("data-xpath",q)}else{if(e.vlanid==="4080"){q=q.replace("'10'","'"+e.vlanid+"'").replace("IP_DATA","IP_BUSINESS_CONTINUITY");r.attr("data-xpath",q)}else{if(e.vlanid==="4081"){q=q.replace("'10'","'"+e.vlanid+"'").replace("IP_DATA","IP_DATA_MPTCP");r.attr("data-xpath",q)}}}}}}});if(f==="ALL"){b(".gui-sent, .gui-received",j).each(function(){var q=b(this);q.text("0")})}}var l=b("#FooterRefreshBtn",j).attr("href");if(l!=undefined&&l.search("XXX")!==-1){b("#FooterRefreshBtn",j).attr("href",l.replace("XXX",e.vlanid))}}).live("pagebeforeshow",function(){$page=b(this);var e=b.QueryString($page.data("url"));var d=a.client.newRequest();d.getValue("Device/Services/BusinessContinuity/GUI/"+a.client.user+"/ShowWANBackupPage",function(f){if(f){b("#WANBACKUP",$page).show()}else{b("#WANBACKUP",$page).remove()}});d.getValue("Device/Services/Mptcp_GUI/GUI/"+a.client.user+"/ShowMPTCPPage",function(f){if(f){b("#MPTCP",$page).show()}else{b("#MPTCP",$page).remove()}});if(window.location.href.indexOf("vlanid=4081")!=-1){location.href="/"}d.getValue("Device/Services/BGCNetworkProperties/NetworkTopology",function(f){if(f.toLowerCase()==="titan"&&a.client.user.toLowerCase()!=="user"){if(window.location.search.indexOf("vlanid=10")!=-1||window.location.search.indexOf("vlanid=30")!=-1){location.href="/"}var g=a.client.newRequest();b("#networkLiIPv6Addr",$page).after('<li data-role="fieldcontain" id="networkLiIPv6Prefix"><h3>'+a.i18n.msg("VLAN_IPV6_PREFIX")+'</h3><p class="gui-status-text" id="networkIPv6Prefix" >&nbsp;</p></li>');g.getValue("Device/IP/Interfaces/Interface[Alias='IP_DATA']/IPv6Prefixes",function(h,k){var j="";b.each(h,function(l,m){if(m.PrefixStatus=="PREFERRED"&&(m.Origin=="PREFIXDELEGATION")){j=m.Prefix}});b("#networkIPv6Prefix",$page).text(j);if(j==""){b("#networkLiIPv6Addr > p",$page).remove();b("#networkLiIPv6Addr",$page).append("<p>")}});g.send()}});d.send();b("#liIPv6Prefix",$page).remove();if(e.vlanid!="undefined"&&e.vlanid=="10"){b("#liIPv6Addr",$page).after('<li data-role="fieldcontain" id="liIPv6Prefix"><h3>'+a.i18n.msg("VLAN_IPV6_PREFIX")+'</h3><p class="gui-status-text" id="IPv6Prefix" >&nbsp;</p></li>');var c=a.client.newRequest();c.getValue("Device/IP/Interfaces/Interface[Alias='IP_BR_LAN']/IPv6Prefixes",function(f,h){var g="";b.each(f,function(j,k){if(k.PrefixStatus=="PREFERRED"&&(k.Origin=="PREFIXDELEGATION"||k.Origin=="AUTOCONFIGURED"||k.Origin=="CHILD")){g=k.Prefix}});b("#IPv6Prefix",$page).text(g);if(g==""){b("#liIPv6Addr > p",$page).remove();b("#liIPv6Addr",$page).append("<p>")}});c.send()}if(e.vlanid!=="10"){b("#dns_ipv6_servers",$page).hide()}b("#ApplyButton",$page).disable()})});jQuery(function(f){var a=f.gui,d="",c=false,b=false,g=true,e="/"+a.opt.GUI_VERSION_OPT+"/gui/tpl/src/",h="home/home.html";f(document).delegate("#MPTCPPage","pagebeforecreate",function(){var l=f(this),m=a.client.newRequest(),j=a.client.user,k=false;g=false;if(a.client.user.toLowerCase()!=="user"){a.isAdmin(function(n){if(n==true){f("#Menu li",l).not(".gui-user-settings").show()}else{f("#Menu li",l).not(".gui-user-settings").remove()}})}else{b=true;f("#Menu li",l).not(".gui-user-settings").remove();f("#MPTCPKpiInformation",l).remove();if(a.client.user.toLowerCase()==="expert"){f("#secondPPPSession",l).remove()}f("#VLAN2",l).remove();f("#VLAN4080",l).remove();f("#VLAN4081",l).remove()}m.getValue("Device/Services/BusinessContinuity/GUI/"+a.client.user+"/ShowWANBackupPage",function(n){if(n){f("#WANBACKUP",l).show()}else{f("#WANBACKUP",l).remove()}});m.getValue("Device/Services/Mptcp_GUI/GUI/"+a.client.user+"/ShowMPTCPPage",function(n){if(n){f("#MPTCP",l).show()}else{g=false;f("#MPTCP",l).remove()}});f("#MPTCPPassword",l).data("isEmpty","false");m.getValue("Device/PPP/Interfaces/Interface[Alias='PPP_DATA']/Username",function(o,n){d=o});m.getValue("Device/PPP/Interfaces/Interface[@uid='18']",function(o,n){if(o.Password!=undefined){if(o.Password=="_XMO_WRITE_ONLY_"){f("#MPTCPPassword",l).data("isEmpty","false");f("#MPTCPPassword",l).attr("placeholder","********");f("#MPTCPPassword",l).ezpz_hint()}else{f("#MPTCPPassword",l).data("isEmpty","true")}}},{"session-options":{depth:2}});m.getValue("Device/Services/Mptcp/Profile",function(n){if(n==="DSL_LTE"){k=true;f("#secondPPPSession",l).remove()}});m.send({synchronous:true})}).delegate("#MPTCPPage","pagebeforeshow",function(){if(!g){location.href="/"}var k=f(this),l=a.client.newRequest(),j=a.client.user;l.getValue("Device/Services/Mptcp_GUI/GUI/"+j+"/ShowMPTCPButton ",function(m){if(m==="Grayed_out"){f("#MPTCPEnable",k).disable()}else{if(m==="Visible"){f("#MPTCPEnable",k).enable()}else{if(m==="Hide"){f("#MPTCPEnable",k).parent("li").hide()}}}});l.send()}).delegate("#MPTCPPage","pageshow",function(){var j=f(this);if(window.location.pathname.indexOf("mptcp.html")!=-1){location.href="/"}f("#ApplyButton",j).on("mptcppagetrigger",function(k){if(!c&&b){if(f("#MPTCPUsername",j).val()===""||(f("#MPTCPPassword",j).data("isEmpty")==="true"&&f("#MPTCPPassword",j).val()==="")){a.alert(a.i18n.msg("MPTCP_REQUIRED_FIELDS"));return true}else{if(d===f("#MPTCPUsername",j).val()){a.alert(a.i18n.msg("MPTCP_SAME_PPP_USERNAME"));return true}}}else{if(f("#MPTCPUsername",j).val()!==""&&d===f("#MPTCPUsername",j).val()){a.alert(a.i18n.msg("MPTCP_SAME_PPP_USERNAME"));return true}}return false})})});jQuery(function(d){var a=d.gui,b=true,c="/"+a.opt.GUI_VERSION_OPT+"/gui/tpl/src/",e="home/home.html";d(document).delegate("#WANBackupPage","pagebeforecreate",function(){var g=d(this),h=a.client.newRequest(),f=a.client.user;b=true;if(a.client.user.toLowerCase()!=="user"){a.isAdmin(function(j){if(j==true){d("#Menu li",g).not(".gui-user-settings").show()}else{d("#Menu li",g).not(".gui-user-settings").remove()}})}else{d("#Menu li",g).not(".gui-user-settings").remove();d("#StatusPerConnectionSection",g).remove();d("#VLAN2",g).remove();d("#VLAN4080",g).remove();d("#VLAN4081",g).remove()}h.getValue("Device/Services/BusinessContinuity/GUI/"+a.client.user+"/ShowWANBackupPage",function(j){if(j){d("#WANBACKUP",g).show()}else{b=false;d("#WANBACKUP",g).remove()}});h.getValue("Device/Services/Mptcp_GUI/GUI/"+a.client.user+"/ShowMPTCPPage",function(j){if(j){d("#MPTCP",g).show()}else{d("#MPTCP",g).remove()}});h.send({synchronous:true})}).delegate("#WANBackupPage","pagebeforeshow",function(){var g=d(this),h=a.client.newRequest(),f=a.client.user;if(!b){location.href="/"}h.getValue("Device/Services/BusinessContinuity/GUI/"+f+"/ShowWANBackupButton",function(j){if(j==="Grayed_out"){d("#WANBACKUPEnable",g).disable()}else{if(j==="Visible"){d("#WANBACKUPEnable",g).enable()}else{if(j==="Hide"){d("#WANBACKUPEnable",g).parent("li").hide()}}}});h.send()})});jQuery(function(e){var b=e.gui,m=0,l="192.168.1.0",o="255.255.255.0",p=[],h="",f="/"+b.opt.GUI_VERSION_OPT+"/gui/tpl/src/",j="home/home.html";e(document).delegate("#FirewallPage","pagebeforecreate",function(){var s=e(this),u=e.QueryString(s.data("url")),t=e("#CustomDMZHostInput",s),r=e("#DMZHostSelect",s);req=b.client.newRequest();req.getValue("Device/Firewall/Chains/Chain[Name='High']/Rules",function(v){if(v.length>0){m=v.length}});req.getValue("Device/IP/Interfaces/Interface[Alias='IP_BR_LAN']/IPv4Addresses/IPv4Address[1]/IPAddress",function(v){l=v});req.getValue("Device/IP/Interfaces/Interface[Alias='IP_BR_LAN']/IPv4Addresses/IPv4Address[1]/SubnetMask",function(v){o=v});req.getValue("Device/NAT/PortMappings",function(y,v){var x=t.data("xmo-item");x.current(h);for(var w=0;w<y.length;w++){if(y[w].InternalClient!==""&&y[w].Service==="DMZ"){h=y[w].InternalClient;x.current(h,undefined,"Device/NAT/PortMappings/PortMapping[Alias='"+y[w].Alias+"']/InternalClient")}}});req.getValue("Device/Services/BGCNetworkProperties/NetworkTopology",function(v){if(v.toLowerCase()==="titan"){e("#BridgedLANHost",s).show()}else{e("#BridgedLANHost",s).hide()}});req.send();e("#DMZHostInput",s).width("30%");r.bind("selecthostbeforeoption",function(x,y){var v="",w=y.host;if(e.ipTVMinBlock!==-1&&e.ipTVMaxBlock!==-1){var A=w.IPAddress.split(".");var z=-1;if(A.length==4){z=parseInt(A[3]);if(z>=e.ipTVMinBlock&&z<=e.ipTVMaxBlock){w.UserDeviceType="TV_DECODER"}}}if((w.InterfaceType!=="Ethernet"&&w.InterfaceType!=="WiFi")||!w.IPAddress.length||(u.host!==undefined&&""+w.uid!==u.host)||w.UserDeviceType=="TV_DECODER"){x.preventDefault();x.stopImmediatePropagation();return}if(w.UserFriendlyName!=""&&w.UserFriendlyName!=undefined&&w.PhysAddress!=undefined&&w.UserFriendlyName.toLowerCase()!=w.PhysAddress.toLowerCase()){v=w.UserFriendlyName}else{if(w.UserHostName){v=w.UserHostName}else{if(w.HostName){v=w.HostName}else{v=b.i18n.msg("HOME_DEVICE")}}}if(w.PhysAddress!=""){v+=" ("+w.PhysAddress+")"}y.value=w.IPAddress;y.text=v;p.push(w.IPAddress)}).change(function(){if(e("#DMZHostSelect option:selected",s).val()==""){e("#DMZEnableCheckIpv4",s).val("false");e("#DMZEnableCheckIpv6",s).val("false");e("#DMZEnableCheckIpv4",s).slider("refresh");e("#DMZEnableCheckIpv6",s).slider("refresh");e(".CustomDMZHostInput").hide();e("#DMZHostInput").input("modified",true);e("#CustomDMZHostInput").input("modified",false)}else{if(e("#DMZHostSelect option:selected",s).val()=="CUSTOMDMZ"){var v=e("#CustomDMZHostInput").data("xmo-item");v.current("");v.modified(false);e("#DMZHostInput").input("modified",false);e("#ApplyButton",s).enable();e("#ApplyButton",s).data("disabled",false);e("#ApplyButton",s).removeClass(".ui-disabled");e("#ApplyButton",s).data("force-enabled",true);e(".CustomDMZHostInput").show()}else{e("#DMZEnableCheckIpv4",s).val("true");e("#DMZEnableCheckIpv6",s).val("false");e("#DMZEnableCheckIpv4",s).slider("refresh");e("#DMZEnableCheckIpv6",s).slider("refresh");e(".CustomDMZHostInput").hide();e("#DMZHostInput").input("modified",true);e("#CustomDMZHostInput").input("modified",false)}}});e("#CustomDMZHostInput").keyup(function(){if(e(this).val()!==h){var v=e("#CustomDMZHostInput").data("xmo-item");v.current(e(this).val());v.modified(true)}else{var v=e("#CustomDMZHostInput").data("xmo-item");v.modified(false)}})}).delegate("#FirewallPage","pagecreate",function(){var z=e(this),w=e.QueryString(z.data("url")),r=e("input[name=FirewallLevel]",z),B=e("#FirewallRuleList",z),D=e("#FirewallRuleAddBtn",z),C=e(),u=e("#FWGridLabel",z),F=e("#ApplyButton",z),v;b.getSettingsDeviceHeaderInfos(w,z);if(w.host!==undefined){var A=e("#ConnectedDevices").array("value");e.each(A,function(G,H){if(((""+H.uid)===w.host)&&H.IPAddress.length){v=H.IPAddress;return false}})}r.change(function(G){if(r.filter(":checked").attr("value")==="CUSTOM"){D.show();u.show();if(b.displayMode===b.GUI_SMARTPHONE_MODE){B.show();D.hide();u.hide()}else{C.show()}}else{D.hide();u.hide();if(b.displayMode===b.GUI_SMARTPHONE_MODE){B.hide()}else{C.hide()}}});if(b.displayMode===b.GUI_SMARTPHONE_MODE){B.bind("arraybeforeinsert",function(H,I){if((w.host!==undefined)&&(!v||(I.value.SourceIP!==v))){H.preventDefault();return}if(I.value.Enable===undefined){I.value.Enable=false}var G=e("#FirewallRuleTmpl",z).tmpl({uid:I.value.uid,rule:I.value.MACAddress,page:"firewall-rule.html?uid="+I.value.uid});B.append(G).listview("refresh")})}else{var E=e('<table id="FirewallRuleTable" >'),x=1,y,t;function s(G){var O=e("#"+G,E),H=O.item("value");H=e.extend({},H,E.jqGrid("getRowData",G));if(H.hasOwnProperty("DestIP")&&H.DestIP.indexOf("/")!==-1){var L=H.DestIP.split("/");var P=L.shift();var I=L.pop();H.DestIP=P;H.DestMask=c(I)}if(H.hasOwnProperty("SourceIP")&&H.SourceIP.indexOf("/")!==-1){var L=H.SourceIP.split("/");var P=L.shift();var I=L.pop();H.SourceIP=P;H.SourceMask=c(I)}if(H.hasOwnProperty("DestPort")&&H.DestPort.indexOf("-")!==-1){var Q=H.DestPort.split("-").map(function(S){return parseInt(S,10)});var N=Q[Q.indexOf(Math.min.apply(Math,Q))];var J=Q[Q.indexOf(Math.max.apply(Math,Q))];H.DestPort=N.toString();H.DestPortRangeMax=J.toString()}else{H.DestPortRangeMax=0}if(H.hasOwnProperty("DestPort")&&parseInt(H.DestPort,10)===0){H.DestPort=1;H.DestPortRangeMax=65535}if(H.hasOwnProperty("SourcePort")&&H.SourcePort.indexOf("-")!==-1){var M=H.SourcePort.split("-").map(function(S){return parseInt(S,10)});var K=M[M.indexOf(Math.min.apply(Math,M))];var R=M[M.indexOf(Math.max.apply(Math,M))];H.SourcePort=K.toString();H.SourcePortRangeMax=R.toString()}else{H.SourcePortRangeMax=0}if(H.hasOwnProperty("SourcePort")&&parseInt(H.SourcePort,10)===0){H.SourcePort=1;H.SourcePortRangeMax=65535}if(H.hasOwnProperty("Protocol")&&(H.Protocol==="ICMP"||H.Protocol==="GRE"||H.Protocol==="AH"||H.Protocol==="ESP")){H.SourcePort=0;H.SourcePortRangeMax=0;H.DestPort=0;H.DestPortRangeMax=0}O.item("value",H)}B.bind("arraybeforeinsert",function(H,I){var J="rule"+x,G;if((w.host!==undefined)&&(!v||(I.value.SourceIP!==v))){H.preventDefault();return}if(I.value.Enable===undefined){I.value.Enable=false}if(I.value.hasOwnProperty("DestIP")){I.value.DestIP=I.value.DestIP+"/"+g(I.value.DestMask)}if(I.value.hasOwnProperty("SourceIP")){I.value.SourceIP=I.value.SourceIP+"/"+g(I.value.SourceMask)}E.jqGrid("addRowData",J,I.value);G=E.find("#"+J).object({connected:false,objset:null});if(x<=m){e(G).addClass("not-editable-row")}else{G.find(".gui-table-delete-row").click(function(K){E.jqGrid("delRowData",J)}).end()}I.item=G.data("xmo-item");I.item.current(I.value,I.capability,I.xpath);t=J;x++}).bind("arraypostactions",function(G,H){if(y){E.jqGrid("saveRow",y);s(y);y=undefined}}).after(E).children().hide();C=E.jqGrid({datatype:"local",height:173,colNames:[b.i18n.msg("HOME_ENABLE"),b.i18n.msg("ACCESS_SERVICE"),b.i18n.msg("HOME_PROTOCOL"),b.i18n.msg("FIREWALL_DEST_IP"),b.i18n.msg("FIREWALL_DEST_PORT"),b.i18n.msg("FIREWALL_SRC_ADDR"),b.i18n.msg("FIREWALL_SRC_PORT"),b.i18n.msg("FIREWALL_ACTION"),b.i18n.msg("FIREWALL_DEST_INTERFACE"),b.i18n.msg("NAT_DELETE")],colModel:[{name:"Enable",index:"Enable",width:60,sortable:false,resizable:false,editable:true,edittype:"checkbox",editoptions:{value:"true:false"},formatter:function(G,H,I){return""+G=="true"?b.i18n.msg("HOME_YES"):b.i18n.msg("HOME_NO")},unformat:function(H,I,G){return""+H==b.i18n.msg("HOME_YES")?"true":"false"},cellattr:function(I,K,H,G,J){return' data-label="'+b.i18n.msg("HOME_ENABLE")+'"'}},{name:"Service",index:"Service",width:80,sortable:false,resizable:false,editable:true,edittype:"select",editoptions:{value:"NONE:NONE;FTP:FTP;FTP-DATA:FTP-DATA;SSH:SSH;TELNET:TELNET;DNS:DNS;NTP:NTP;NNTP:NNTP;HTTP:HTTP;HTTPS:HTTPS;POP3:POP3;POP3S:POP3S;IMAP:IMAP;IMAPS:IMAPS;TFTP:TFTP;ICMP:ICMP;TRACEROUTE:TRACEROUTE;SNMP-TCP:SNMP-TCP;SNMP-UDP:SNMP-UDP;SYSLOG:SYSLOG;IPSEC:IPSEC;SMTP:SMTP;SSMTP:SSMTP;SMTP-AUTH:SMTP-AUTH",dataEvents:[{type:"change",fn:function(I){var H=this.id.replace("Service","DestPort"),G=this.id.replace("Service","SourcePort"),J=this.id.replace("Service","Protocol");e("#"+H).prop("disabled",true);e("#"+G).prop("disabled",true);e("#"+J).prop("disabled",true);switch(this.value){case"FTP":e("#"+H).val(21);e("#"+G).val(0);e("#"+J).val("TCP");break;case"FTP-DATA":e("#"+H).val(20);e("#"+G).val(0);e("#"+J).val("TCP");break;case"SSH":e("#"+H).val(22);e("#"+G).val(0);e("#"+J).val("TCP");break;case"TELNET":e("#"+H).val(23);e("#"+G).val(0);e("#"+J).val("TCP");break;case"DNS":e("#"+H).val(53);e("#"+G).val(0);e("#"+J).val("BOTH");break;case"NTP":e("#"+H).val(123);e("#"+G).val(0);e("#"+J).val("UDP");break;case"NNTP":e("#"+H).val(119);e("#"+G).val(0);e("#"+J).val("TCP");break;case"HTTP":e("#"+H).val(80);e("#"+G).val(0);e("#"+J).val("TCP");break;case"HTTPS":e("#"+H).val(443);e("#"+G).val(0);e("#"+J).val("TCP");break;case"POP3":e("#"+H).val(110);e("#"+G).val(0);e("#"+J).val("TCP");break;case"POP3S":e("#"+H).val(995);e("#"+G).val(0);e("#"+J).val("TCP");break;case"IMAP":e("#"+H).val(143);e("#"+G).val(0);e("#"+J).val("TCP");break;case"IMAPS":e("#"+H).val(993);e("#"+G).val(0);e("#"+J).val("TCP");break;case"TFTP":e("#"+H).val(69);e("#"+G).val(0);e("#"+J).val("UDP");break;case"ICMP":e("#"+H).val(0);e("#"+G).val(0);e("#"+J).val("Any");break;case"TRACEROUTE":e("#"+H).val(0);e("#"+G).val(0);e("#"+J).val("Any");break;case"SNMP-TCP":e("#"+H).val("161-162");e("#"+G).val("161-162");e("#"+J).val("TCP");break;case"SNMP-UDP":e("#"+H).val(161);e("#"+G).val(0);e("#"+J).val("UDP");break;case"SYSLOG":e("#"+H).val(514);e("#"+G).val(0);e("#"+J).val("UDP");break;case"IPSEC":e("#"+H).val(0);e("#"+G).val(0);e("#"+J).val("Any");break;case"SMTP":e("#"+H).val(25);e("#"+G).val(0);e("#"+J).val("TCP");break;case"SSMTP":e("#"+H).val(465);e("#"+G).val(0);e("#"+J).val("TCP");break;case"SMTP-AUTH":e("#"+H).val(587);e("#"+G).val(0);e("#"+J).val("TCP");break;default:e("#"+H).val(0);e("#"+G).val(0);e("#"+J).val("Any");e("#"+H).prop("disabled",false);e("#"+G).prop("disabled",false);e("#"+J).prop("disabled",false);break}}}]},cellattr:function(I,K,H,G,J){return' data-label="'+b.i18n.msg("ACCESS_SERVICE")+'"'}},{name:"Protocol",index:"Protocol",width:60,sortable:false,resizable:false,editable:true,edittype:"select",editoptions:{value:"ALL:Any;TCP:TCP;UDP:UDP;BOTH:TCP/UDP;ICMP:ICMP;GRE:GRE;AH:AH;ESP:ESP",dataEvents:[{type:"change",fn:function(G){var H=e(G.target).val();if(H!=="ALL"&&H!=="TCP"&&H!=="UDP"&&H!=="BOTH"){e("#"+y+"_DestPort").attr("disabled","true").hide();e("#"+y+"_SourcePort").attr("disabled","true").hide();e("#"+y+"_Service").prop("disabled",true);e("#"+y+"_DestPort").val(0);e("#"+y+"_SourcePort").val(0)}else{e("#"+y+"_DestPort").removeAttr("disabled").show();e("#"+y+"_SourcePort").removeAttr("disabled").show();e("#"+y+"_Service").prop("disabled",false)}}}]},formatter:function(G,H,I){if(G==="BOTH"){return"TCP/UDP"}else{if(G==="ALL"){return"Any"}else{return G||" "}}},unformat:function(H,I,G){if(H==="TCP/UDP"){return"BOTH"}else{if(H==="Any"){return"ALL"}else{return H}}},cellattr:function(I,K,H,G,J){return' data-label="'+b.i18n.msg("HOME_PROTOCOL")+'"'}},{name:"DestIP",index:"DestIP",width:100,sortable:false,resizable:false,editable:true,cellattr:function(I,K,H,G,J){return' data-label="'+b.i18n.msg("FIREWALL_DEST_IP")+'"'}},{name:"DestPort",index:"DestPort",width:100,sortable:false,resizable:false,editable:true,formatter:function(G,H,I){if(parseInt(I.DestPort,10)===1&&parseInt(I.DestPortRangeMax,10)===65535){return"0"}else{if(I.hasOwnProperty("DestPortRangeMax")&&parseInt(I.DestPortRangeMax,10)!=0){if(G.toString().indexOf("-")!==-1){return G}else{return G+"-"+I.DestPortRangeMax}}else{return G}}},unformat:function(H,I,G){return H},cellattr:function(I,K,H,G,J){return' data-label="'+b.i18n.msg("FIREWALL_DEST_PORT")+'"'}},{name:"SourceIP",index:"SourceIP",width:100,sortable:false,resizable:false,editable:!v,cellattr:function(I,K,H,G,J){return' data-label="'+b.i18n.msg("FIREWALL_SRC_ADDR")+'"'}},{name:"SourcePort",index:"SourcePort",width:70,sortable:false,resizable:false,editable:true,formatter:function(G,H,I){if(parseInt(I.SourcePort,10)===1&&parseInt(I.SourcePortRangeMax,10)===65535){return"0"}else{if(I.hasOwnProperty("SourcePortRangeMax")&&parseInt(I.SourcePortRangeMax,10)!=0){if(G.toString().indexOf("-")!==-1){return G}else{return G+"-"+I.SourcePortRangeMax}}else{return G}}},unformat:function(H,I,G){return H},cellattr:function(I,K,H,G,J){return' data-label="'+b.i18n.msg("FIREWALL_SRC_PORT")+'"'}},{name:"Target",index:"Target",width:50,sortable:false,resizable:false,editable:false,edittype:"select",editoptions:{value:"ACCEPT:Accept"},cellattr:function(I,K,H,G,J){return' data-label="'+b.i18n.msg("FIREWALL_ACTION")+'"'}},{name:"DestInterface",index:"DestInterface",width:50,sortable:false,resizable:false,editable:false,formatter:function(G,H,I){if(G==undefined){return"IP DATA"}else{if(G=="Device/IP/Interfaces/Interface[IP_BACKUP]"){return"IP BACKUP"}else{return G}}},unformat:function(H,I,G){if(H=="IP DATA"){return"Device/IP/Interfaces/Interface[IP_DATA]"}else{if(H=="IP BACKUP"){return"Device/IP/Interfaces/Interface[IP_BACKUP]"}else{return H}}},cellattr:function(I,K,H,G,J){return' data-label="'+b.i18n.msg("FIREWALL_DEST_INTERFACE")+'"'}},{name:"Delete",index:"Delete",width:70,sortable:false,resizable:false,classes:"gui-table-delete-row",cellattr:function(I,K,H,G,J){return' data-label="'+b.i18n.msg("NAT_DELETE")+'"'}}],scrollOffset:0,caption:B.children("li:first").text(),forceFit:true,editurl:"clientArray",onSelectRow:function(K){var J=parseInt(K.substring("rule".length));if(J>=m){var H={keys:true,aftersavefunc:function(L){s(L);a(E,E.jqGrid("getRowData",L),L);E.jqGrid("resetSelection");y=undefined}};if(K&&K!==y){E.jqGrid("saveRow",y);s(y);E.jqGrid("editRow",K,H);E.data("editedrow",K);y=K}var I=e("#"+K+"_Protocol").val();var G=e("#"+K+"_Service").val();if(I!=="ALL"&&I!=="TCP"&&I!=="UDP"&&I!=="BOTH"){e("#"+K+"_DestPort").attr("disabled","true").hide();e("#"+K+"_SourcePort").attr("disabled","true").hide();e("#"+K+"_DestPort").val(0);e("#"+K+"_SourcePort").val(0)}else{e("#"+K+"_DestPort").removeAttr("disabled").show();e("#"+K+"_SourcePort").removeAttr("disabled").show()}if(G==="NONE"){e("#"+K+"_DestPort").removeAttr("disabled");e("#"+K+"_SourcePort").removeAttr("disabled")}else{e("#"+K+"_DestPort").attr("disabled","true");e("#"+K+"_SourcePort").attr("disabled","true");e("#"+K+"_Protocol").attr("disabled","true")}}else{return false}}}).parents("div.ui-jqgrid").addClass("gui-table");D.click(function(H){y=E.data("editedrow");if(y){E.jqGrid("saveRow",y);s(y);if(!e.isEmptyObject(E.jqGrid("getRowData",y))){a(E,E.jqGrid("getRowData",y),y)}y=undefined}H.preventDefault();H.stopImmediatePropagation();if((w.host!==undefined)&&!v){b.alert("Device must have an IP address");return}var G=l.split(".");G.splice(3,1,"0");var I={Enable:true,SourceInterface:"Device/IP/Interfaces/Interface[IP_BR_LAN]",DestInterface:"Device/IP/Interfaces/Interface[IP_DATA]",DestIP:"0.0.0.0",DestMask:"0.0.0.0",SourceIP:v?v:G.join("."),SourceMask:o,Protocol:"TCP",DestPort:"0",DestPortRangeMax:"0",SourcePort:"0",SourcePortRangeMax:"0",Service:"NONE",DestInterface:"Device/IP/Interfaces/Interface[IP_DATA]",Target:"ACCEPT"};B.array("insert",-1,I,new b.api.Capability({name:"Rule"}));E.jqGrid("setSelection",t)});F.on("firewallpagetrigger",function(G,I,H){if(e("#DMZHostSelect",z).val()==="CUSTOMDMZ"){var R=/((^\s*((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*$)|(^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$))/;var L=e("#CustomDMZHostInput",z).val();var P=L.split(".");var M=o.split(".");var T=[];var S="Device/NAT/PortMappings/PortMapping[Alias='FT_API_DMZ']";var O="Device/NAT/PortMappings/PortMapping[Alias='FT_API_DMZ_IPv6']";var Q=b.client.newRequest();var K="ipv6";for(var N=0;N<P.length;N++){T.push((P[N]&255)|(~M[N]&255))}var J=T.join(".");if(!R.test(L)){e("<div>").simpledialog2({mode:"button",buttonPrompt:"<br/>"+b.i18n.msg("FIREWALL_ERROR_IPV4_IPV6")+"<br/><br/><br/>",themeDialog:"d",buttons:{OK:{text:b.i18n.msg("HOME_OK"),click:function(){},theme:"b"}}});return true}else{if(L.toLowerCase().indexOf("fe80")===0){e("<div>").simpledialog2({mode:"button",buttonPrompt:"<br/>"+b.i18n.msg("FIREWALL_ERROR_IPV6_LINK_LOCAL")+"<br/><br/><br/>",themeDialog:"d",buttons:{OK:{text:b.i18n.msg("HOME_OK"),click:function(){},theme:"b"}}});return true}}if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(L)){K="ipv4";if(!n(L,l+"/"+g(o))||L===J){e("<div>").simpledialog2({mode:"button",buttonPrompt:"<br/>"+b.i18n.msg("FIREWALL_DMZ_IPV4_BAD_POOL")+"<br/><br/><br/>",themeDialog:"d",buttons:{OK:{text:b.i18n.msg("HOME_OK"),click:function(){},theme:"b"}}});return true}else{if(n(L,"192.168.182.0/27")){e("<div>").simpledialog2({mode:"button",buttonPrompt:"<br/>"+b.i18n.msg("DHCP_ERROR_RESERVED_NETWORK")+"<br/><br/><br/>",themeDialog:"d",buttons:{OK:{text:b.i18n.msg("HOME_OK"),click:function(){},theme:"b"}}});return true}else{if(L===l){e("<div>").simpledialog2({mode:"button",buttonPrompt:"<br/>"+b.i18n.msg("FIREWALL_ERROR_GTW_USE")+"<br/><br/><br/>",themeDialog:"d",buttons:{OK:{text:b.i18n.msg("HOME_OK"),click:function(){},theme:"b"}}});return true}else{if((q(e.ipTVMin)<=q(L))&&(q(e.ipTVMax)>=q(L))){e("<div>").simpledialog2({mode:"button",buttonPrompt:"<br/>"+b.i18n.msg("FIREWALL_ERROR_IPTV_POOL")+"<br/><br/><br/>",themeDialog:"d",buttons:{OK:{text:b.i18n.msg("HOME_OK"),click:function(){},theme:"b"}}});return true}}}}}var U=e("#CustomDMZHostInput").data("xmo-item");if(K==="ipv4"){U.current(e("#CustomDMZHostInput").val(),undefined,S+"/InternalClient");Q.setValue(S+"/InternalClient",e("#CustomDMZHostInput").val());Q.setValue(S+"/Enable",true);Q.setValue(O+"/InternalClient","");Q.setValue(O+"/Enable",false);Q.send(function(){e.mobile.changePage(f+j,{reverse:true})},function(){})}else{U.current(e("#CustomDMZHostInput").val(),undefined,O);Q.setValue(S+"/InternalClient","");Q.setValue(S+"/Enable",false);Q.setValue(O+"/InternalClient",e("#CustomDMZHostInput").val());Q.setValue(O+"/Enable",true);Q.send(function(){e.mobile.changePage(f+j,{reverse:true})},function(){})}if(y!=undefined){E.jqGrid("saveRow",y)}if(E[0].p.data.length>m){if(y!=undefined){if(a(E,E.jqGrid("getRowData",y),y)===true){return true}}}}return false})}}).delegate("#FirewallPage","pagebeforeshow",function(){var s=(this),t=b.client.newRequest(),r=b.client.newRequest();e("#BridgedLANHostEnableCheck",s).change(function(){r.getValue("Device/Ethernet/Interfaces/Interface[Alias='PHY4']/Status",function(u){if(e("#BridgedLANHostEnableCheck",s).val()==="true"&&u==="UP"){b.alert(b.i18n.msg("FIREWALL_ENABLING_BRIDGED_LAN_HOST")+"\n"+b.i18n.msg("FIREWALL_ETHERNET_ENABLING_BRIDGED_LAN_HOST"))}else{if(e("#BridgedLANHostEnableCheck",s).val()==="true"){b.alert(b.i18n.msg("FIREWALL_ENABLING_BRIDGED_LAN_HOST"))}}});r.send()});t.getValue("Device/NAT/PortMappings/PortMapping[Service='DMZ' and Enable='true']/InternalClient",function(u){if(u!=""){e("#DMZHostSelect",s).val(u);if(p.indexOf(u)!==-1){e("#DMZHostSelect option[value='"+u+"']",s).attr("selected","selected");e(".CustomDMZHostInput").hide()}else{e("#DMZHostSelect option[value='CUSTOMDMZ']",s).attr("selected","selected");e(".CustomDMZHostInput").show()}}else{e("#DMZHostSelect option[value='']",s).attr("selected","selected");e(".CustomDMZHostInput").hide()}e("#DMZHostSelect",s).refresh(true)},function(){e("#DMZHostSelect option[value='']",s).attr("selected","selected");e(".CustomDMZHostInput").hide();e("#DMZHostSelect",s).refresh(true)});t.send()}).delegate("#FirewallPage","pageshow",function(){e("#ApplyButton",e(this)).disable()});function q(s){var r=s.split(".");return(((((+r[0]*256)+(+r[1]))*256)+(+r[2]))*256)+(+r[3])}function n(u,v){var s,w,r=q(u);if((s=v.match(/^(.*?)\/(\d{1,2})$/))&&((w=q(s[1]))>=0)){var t=Math.pow(2,32-parseInt(s[2]));return(r>w)&&(r<w+t-1)}else{return false}}function c(s){var r=[];for(i=0;i<4;i++){var t=Math.min(s,8);r.push(256-Math.pow(2,8-t));s-=t}return r.join(".")}function g(s){var t=0,r=0,u=parseInt(s.split(".")[0],10);if(isNaN(u)){return}bitsfromleft=k(u);if(isNaN(bitsfromleft)){return}r+=bitsfromleft;u=parseInt(s.split(".")[1],10);if(isNaN(u)){return}bitsfromleft=k(u);if(isNaN(bitsfromleft)){return}r+=bitsfromleft;u=parseInt(s.split(".")[2],10);if(isNaN(u)){return}bitsfromleft=k(u);if(isNaN(bitsfromleft)){return}r+=bitsfromleft;u=parseInt(s.split(".")[3],10);if(isNaN(u)){return}bitsfromleft=k(u);if(isNaN(bitsfromleft)){return}r+=bitsfromleft;t=r;return t}function k(r){if(r==255){return(8)}i=0;bitpat=65280;while(i<8){if(r==(bitpat&255)){return(i)}bitpat=bitpat>>1;i++}return(Number.NaN)}function a(v,s,x){var r="";if(s.DestIP.indexOf("/")!==-1){var w=s.DestIP.split("/").shift();var y=parseInt(s.DestIP.split("/").pop(),10);if(!w.match("^(([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])$")){r=d(r,b.i18n.msg("FIREWALL_DEST_IP_ERROR"))}if(y>32||y<0||isNaN(y)){r=d(r,b.i18n.msg("FIREWALL_DEST_SUBNETMASK_ERROR"))}}else{r=d(r,b.i18n.msg("FIREWALL_DEST_IPADDRESS_ERROR"))}if(s.SourceIP.indexOf("/")!==-1){var u=s.SourceIP.split("/").shift();var t=parseInt(s.SourceIP.split("/").pop(),10);if(!u.match("^(([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])$")){r=d(r,b.i18n.msg("FIREWALL_SOURCE_IP_ERROR"))}if(t>32||t<0||isNaN(t)){r=d(r,b.i18n.msg("FIREWALL_SOURCE_SUBNETMASK_ERROR"))}}else{r=d(r,b.i18n.msg("FIREWALL_SOURCE_IPADDRESS_ERROR"))}if(s.Protocol==="ALL"||s.Protocol==="TCP"||s.Protocol==="UDP"){if(isNaN(parseInt(s.DestPort,10))||parseInt(s.DestPort,10)<0||parseInt(s.DestPort,10)>65535){r=d(r,b.i18n.msg("FIREWALL_DEST_PORT_ERROR"))}if(isNaN(parseInt(s.SourcePort,10))||parseInt(s.SourcePort,10)<0||parseInt(s.SourcePort,10)>65535){r=d(r,b.i18n.msg("FIREWALL_SOURCE_PORT_ERROR"))}}if(r.length>0){b.alert(r);v.jqGrid("delRowData",x);return true}return false}function d(r,s){if(r.indexOf(s)==-1){r+=s+"\n"}return r}});jQuery(function(c){var a=c.gui,d,b;c(document).delegate("#FirewallDevicePage","pagebeforecreate",function(){var f=c(this),g=c.QueryString(f.data("url")),e=c("#DMZHostSelect",f);a.getSettingsDeviceHeaderInfos(g,f);c("#DMZHostInput",f).width("30%")}).delegate("#FirewallDevicePage","pagecreate",function(){var h=c(this),m=c.QueryString(h.data("url")),l=c("input[name=FirewallLevel]",h),f=c("#FirewallRuleList",h),e=c("#FirewallRuleAddBtn",h),g=c("#FWGridLabel",h),k;if(m.host!==undefined){var j=a.client.newRequest();j.getValue("Device/Hosts/Hosts/Host[@uid='"+m.host+"']",function(n){d=n.PhysAddress;b=n.IPAddress});j.send()}c("#DMZCurrentHost",h).change(function(n){if(this.value=="false"){c("#DMZHostInput",h).val("");c("#DMZEnableCheck",h).val("false");c("#DMZEnableCheck",h).refresh(true)}else{c("#DMZHostInput",h).val(b);c("#DMZEnableCheck",h).val("true");c("#DMZEnableCheck",h).refresh(true)}})}).delegate("#FirewallDevicePage","pagebeforeshow",function(){var e=c(this),f=a.client.newRequest();f.getValue("Device/NAT/PortMappings/PortMapping[Service='DMZ']/InternalClient",function(g){if(g.toUpperCase()!=b){c("#DMZEnableCheck",e).val("false");c("#DMZEnableCheck",e).refresh(true);c("#DMZCurrentHost",e).val("false");c("#DMZCurrentHost",e).refresh(true)}else{c("#DMZEnableCheck",e).val("true");c("#DMZEnableCheck",e).refresh(true);c("#DMZCurrentHost",e).val("true");c("#DMZCurrentHost",e).refresh(true);c("#DMZHostInput",e).val(b)}});f.send()})});jQuery(function(j){var b=j.gui,o,n=0;var e=new Array();var d=new Array();var k=new Array();var l=new Array();j(document).delegate("#NatPage","pagebeforecreate",function(){var p=j(this),r=j.QueryString(p.data("url"));b.getSettingsDeviceHeaderInfos(r,p);j("#EthernetDevNameNat",p).html(b.i18n.msg("HOME_DEVICE"));j.gui.natIpAddr=undefined;if(r.host!==undefined){var q=b.client.newRequest();q.getValue("Device/Hosts/Hosts/Host[@uid='"+r.host+"']/IPAddress",function(s){j.gui.natIpAddr=s});q.send()}}).delegate("#NatPage","pageinit",function(){var z=j(this),F=j.QueryString(z.data("url")),B=j("#NATPortMappingList",z),y=j("#NATPortMappingAddBtn",z),u=j("#PinholesPortMappingList",z),H=j("#PinholesPortMappingAddBtn",z),G=j("#UPnPPortMappingList",z),p=j("#ApplyButton",z),D=false,x=1,q=b.client.newRequest();j("#IpGateway",z).hide();j("#DMZIp",z).hide();j("#DMZEnable",z).hide();z.bind("objsetload",function(J,K){D=true});e=new Array();d=new Array();k=new Array();l=new Array();q.getValue("Device/Services/BGCNetworkProperties/NetworkTopology",function(J){if(J.toLowerCase()==="titan"){j(".AddressPortTranslation",z).text(b.i18n.msg("NAT_TITAN_ADDR_PORT_TRANSLAT"))}else{j(".AddressPortTranslation",z).text(b.i18n.msg("NAT_ADDR_PORT_TRANSLAT"))}});q.send();if(b.displayMode===b.GUI_DESKTOP_MODE){var C=j('<table id="NATPortMappingRuleTable" >'),t=j('<table id="PinholingRuleTable" >'),w=j('<table id="UPnPRuleTable" >'),s,v,I,A;function r(L){var J=j("#"+L,o),K=J.item("value");K=j.extend({},K,o.jqGrid("getRowData",L));J.item("value",K)}function E(O){var K=j("#"+O,o),L=K.item("value");L=j.extend({},L,o.jqGrid("getRowData",O));if(L.hasOwnProperty("DestPort")&&L.DestPort.indexOf("-")!==-1){var N=L.DestPort.split("-").map(function(P){return parseInt(P,10)});var M=N[N.indexOf(Math.min.apply(Math,N))];var J=N[N.indexOf(Math.max.apply(Math,N))];L.DestPort=M.toString();L.DestPortRangeMax=J.toString()}else{L.DestPortRangeMax=0}if(L.hasOwnProperty("Protocol")&&(L.Protocol==="ICMP"||L.Protocol==="GRE"||L.Protocol==="AH"||L.Protocol==="ESP")){L.SourcePort=0;L.SourcePortRangeMax=0;L.DestPort=0;L.DestPortRangeMax=0}K.item("value",L)}B.bind("arraybeforeinsert",function(L,M){var K=M.value.Creator,O="rule"+x++,N,J;if(K==="UPNP"){if(M.value.ExternalInterface==undefined||M.value.ExternalInterface.indexOf("IP_DATA")!=-1){e.push(M.value)}}if((F.host!==undefined)&&(!j.gui.natIpAddr||(M.value.InternalClient!==j.gui.natIpAddr))){if((K=="USER"||K==undefined)&&(M.value.Manuel==undefined)){if(M.value.Protocol==undefined){M.value.Protocol="TCP"}d.push(M.value)}L.preventDefault();return}if(b.client.user.toLowerCase()=="user"&&K==="UPNP"&&M.value.ExternalInterface!=undefined&&M.value.ExternalInterface.indexOf("IP_DATA")==-1){L.preventDefault();return}if(K==="USER"||K===undefined){o=C}else{L.preventDefault();return}M.value.Enable=M.value.Enable||false;M.value.Protocol=M.value.Protocol||"TCP";M.value.RemoteHost=M.value.RemoteHost||"";M.value.ExternalPort=M.value.ExternalPort||0;M.value.ExternalPortEndRange=M.value.ExternalPortEndRange||0;N=j.extend({},M.value);N.Enable=N.Enable?"true":"false";o.jqGrid("addRowData",O,N);J=o.find("#"+O).object({connected:false,objset:null}).change(function(){var P=o.data("editedrow");if(P===O){return false}});M.item=J.data("xmo-item");M.item.current(M.value,M.capability,M.xpath);J.find(".gui-table-delete-row").click(function(P){o.jqGrid("delRowData",O)});v=O}).bind("arraypostactions",function(J,K){I=C.data("editedrow");if(I){C.jqGrid("saveRow",I);r(I);I=undefined}}).bind("arraybeforesubmit",function(J,K){C.each(function(){o=j(this),I=o.data("editedrow");if(I){o.jqGrid("saveRow",I);o.removeData("editedrow")}})}).after(C).hide();s={datatype:"local",height:200,colNames:[b.i18n.msg("HOME_STATUS"),b.i18n.msg("NAT_ENABLE"),b.i18n.msg("ACCESS_SERVICE"),b.i18n.msg("HOME_PROTOCOL"),b.i18n.msg("NAT_EXT_PORTSTART"),b.i18n.msg("NAT_EXT_PORTEND"),b.i18n.msg("NAT_INT_PORT"),b.i18n.msg("NAT_INT_HOST"),b.i18n.msg("NAT_REMOTE_HOST"),b.i18n.msg("NAT_DESCRIPTION"),b.i18n.msg("NAT_DELETE")],colModel:[{name:"Status",index:"Status",width:90,sortable:false,resizable:false,editable:false,edittype:"text",formatter:function(J,K,L){if(J=="ENABLED"){return b.i18n.msg("HOME_OK")}else{if(J=="DISABLED"){return b.i18n.msg("NAT_DISABLED")}else{if(J=="ERROR"){return b.i18n.msg("NAT_FAILED")}else{if(J=="ERROR_MISCONFIGURED"){return b.i18n.msg("NAT_MISCONF")}else{if(J==undefined){return b.i18n.msg("NAT_DISABLED")}else{return""}}}}}},unformat:function(K,L,J){if(K==b.i18n.msg("HOME_OK")){return"ENABLED"}else{if(K==b.i18n.msg("NAT_DISABLED")){return"DISABLED"}else{if(K==b.i18n.msg("NAT_MISCONF")){return"ERROR_MISCONFIGURED"}else{if(K==b.i18n.msg("NAT_FAILED")){return"ERROR"}else{return""}}}}},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("HOME_STATUS")+'"'}},{name:"Enable",index:"Enable",width:45,sortable:false,resizable:false,editable:true,edittype:"checkbox",editoptions:{value:"true:false"},formatter:function(J,K,L){return J==="true"?b.i18n.msg("HOME_YES"):b.i18n.msg("HOME_NO")},unformat:function(K,L,J){return K===b.i18n.msg("HOME_YES")?"true":"false"},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_ENABLE")+'"'}},{name:"Service",index:"Service",width:65,sortable:false,resizable:false,editable:true,edittype:"select",editoptions:{value:"NONE:"+b.i18n.msg("HOME_NONE")+";FTP:FTP;FTP-DATA:FTP-DATA;SSH:SSH;TELNET:TELNET;DNS:DNS;NTP:NTP;NNTP:NNTP;HTTP:HTTP;HTTPS:HTTPS;POP3:POP3;POP3S:POP3S;IMAP:IMAP;IMAPS:IMAPS;TFTP:TFTP;ICMP:ICMP;SNMP-TCP:SNMP-TCP;SNMP-UDP:SNMP-UDP;SYSLOG:SYSLOG",dataEvents:[{type:"change",fn:function(M){var K=this.id.replace("Service","InternalPort"),J=this.id.replace("Service","ExternalPort"),L=this.id.replace("Service","ExternalPortEndRange"),N=this.id.replace("Service","Protocol");j("#"+J).prop("disabled",true);j("#"+K).prop("disabled",true);j("#"+L).prop("disabled",true);j("#"+N).prop("disabled",true);switch(this.value){case"FTP":j("#"+K).val(21);j("#"+J).val(21);j("#"+N).val("TCP");break;case"FTP-DATA":j("#"+K).val(20);j("#"+J).val(20);j("#"+N).val("TCP");break;case"SSH":j("#"+K).val(22);j("#"+J).val(22);j("#"+N).val("TCP");break;case"TELNET":j("#"+K).val(23);j("#"+J).val(23);j("#"+N).val("TCP");break;case"DNS":j("#"+K).val(53);j("#"+J).val(53);j("#"+N).val("UDP");break;case"NTP":j("#"+K).val(123);j("#"+J).val(123);j("#"+N).val("UDP");break;case"NNTP":j("#"+K).val(119);j("#"+J).val(119);j("#"+N).val("TCP");break;case"HTTP":j("#"+K).val(80);j("#"+J).val(80);j("#"+N).val("TCP");break;case"HTTPS":j("#"+K).val(443);j("#"+J).val(443);j("#"+N).val("TCP");break;case"POP3":j("#"+K).val(110);j("#"+J).val(110);j("#"+N).val("TCP");break;case"POP3S":j("#"+K).val(995);j("#"+J).val(995);j("#"+N).val("TCP");break;case"IMAP":j("#"+K).val(143);j("#"+J).val(143);j("#"+N).val("TCP");break;case"IMAPS":j("#"+K).val(993);j("#"+J).val(993);j("#"+N).val("TCP");break;case"TFTP":j("#"+K).val(69);j("#"+J).val(69);j("#"+N).val("UDP");break;case"SNMP-TCP":j("#"+K).val(162);j("#"+J).val(162);j("#"+N).val("TCP");break;case"SNMP-UDP":j("#"+K).val(161);j("#"+J).val(161);j("#"+N).val("UDP");break;case"SYSLOG":j("#"+K).val(514);j("#"+J).val(514);j("#"+N).val("UDP");break;default:j("#"+K).val("");j("#"+J).val("");j("#"+N).val("Any");j("#"+J).prop("disabled",false);j("#"+K).prop("disabled",false);j("#"+L).prop("disabled",false);j("#"+N).prop("disabled",false);break}}}]},formatter:function(J,K,L){return J==="NONE"?b.i18n.msg("HOME_NONE"):J},unformat:function(K,L,J){return K===b.i18n.msg("HOME_NONE")?"NONE":K},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("ACCESS_SERVICE")+'"'}},{name:"Protocol",index:"Protocol",width:60,sortable:false,resizable:false,editable:true,edittype:"select",editoptions:{value:"BOTH:"+b.i18n.msg("NAT_TCPUDP")+";TCP:TCP;UDP:UDP"},formatter:function(J,K,L){if(J==="BOTH"){return"TCP-UDP"}else{return J}},unformat:function(K,L,J){if(K===b.i18n.msg("NAT_TCPUDP")){return"BOTH"}else{return K}},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("HOME_PROTOCOL")+'"'}},{name:"ExternalPort",index:"ExternalPort",width:60,sortable:false,resizable:false,editable:true,cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_EXT_PORTSTART")+'"'}},{name:"ExternalPortEndRange",index:"ExternalPortEndRange",width:60,sortable:false,resizable:false,editable:true,cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_EXT_PORTEND")+'"'}},{name:"InternalPort",index:"InternalPort",width:50,sortable:false,resizable:false,editable:true,formatter:function(J,K,L){return""+J},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_INT_PORT")+'"'}},{name:"InternalClient",index:"InternalClient",width:90,sortable:false,resizable:false,editable:!j.gui.natIpAddr,cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_INT_HOST")+'"'}},{name:"RemoteHost",index:"RemoteHost",width:90,sortable:false,resizable:false,editable:true,formatter:function(J,K,L){return J===""?b.i18n.msg("NAT_ANY"):J},unformat:function(K,L,J){return(K===b.i18n.msg("NAT_ANY")||K==="0.0.0.0")?"":K},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_REMOTE_HOST")+'"'}},{name:"Description",index:"Description",width:75,sortable:false,resizable:false,editable:true,cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_DESCRIPTION")+'"'}},{name:"Delete",index:"Delete",width:70,sortable:false,resizable:false,classes:"gui-table-delete-row",cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_DELETE")+'"'}}],forceFit:true,scrollOffset:0,editurl:"clientArray",onSelectRow:function(J){o=j(this),editparams={keys:true,aftersavefunc:function(K){h(o,j("#IpGateway",z).html(),j("#DMZIp",z).html(),j("#DMZEnable",z).html(),w);o.jqGrid("resetSelection");o.removeData("editedrow");o.change();r(K)}},I=o.data("editedrow");if(J&&J!==I){if(I!==undefined){o.jqGrid("saveRow",I)}o.jqGrid("editRow",J,editparams);o.data("editedrow",J);if(j("#"+J+"_Service :selected").val().toLowerCase()!="none"){j("#"+J+"_ExternalPort").prop("disabled",true);j("#"+J+"_ExternalPortEndRange").prop("disabled",true);j("#"+J+"_InternalPort").prop("disabled",true);j("#"+J+"_Protocol").prop("disabled",true)}else{j("#"+J+"_ExternalPort").prop("disabled",false);j("#"+J+"_ExternalPortEndRange").prop("disabled",false);j("#"+J+"_InternalPort").prop("disabled",false);j("#"+J+"_Protocol").prop("disabled",false)}}}};s.caption=B.children("li:first").text();C.jqGrid(s).parents("div.ui-jqgrid").addClass("gui-table");G.bind("arraybeforeinsert",function(L,M){var K=M.value.Creator,O="ruleUpnp"+x++,N,J;if((F.host!==undefined)&&(!j.gui.natIpAddr||(M.value.InternalClient!==j.gui.natIpAddr))){L.preventDefault();return}if(K==="UPNP"){if(M.value.ExternalInterface==undefined||M.value.ExternalInterface.indexOf("IP_DATA")!=-1){e.push(M.value)}}if(b.client.user.toLowerCase()=="user"&&K==="UPNP"&&M.value.ExternalInterface!=undefined&&M.value.ExternalInterface.indexOf("IP_DATA")==-1){L.preventDefault();return}if(K==="UPNP"){o=w}else{L.preventDefault();return}M.value.Enable=M.value.Enable||false;M.value.Protocol=M.value.Protocol||"TCP";M.value.RemoteHost=M.value.RemoteHost||"";M.value.ExternalPort=M.value.ExternalPort||0;M.value.ExternalPortEndRange=M.value.ExternalPortEndRange||0;N=j.extend({},M.value);N.Enable=N.Enable?"true":"false";o.jqGrid("addRowData",O,N);J=o.find("#"+O).object({connected:false,objset:null}).change(function(){var P=o.data("editedrow");if(P===O){return false}});M.item=J.data("xmo-item");M.item.current(M.value,M.capability,M.xpath);v=O}).after(w).hide();options2={datatype:"local",height:200,colNames:[b.i18n.msg("NAT_ENABLE"),b.i18n.msg("NAT_DESCRIPTION"),b.i18n.msg("HOME_PROTOCOL"),b.i18n.msg("NAT_REMOTE_HOST"),b.i18n.msg("NAT_EXT_PORTSTART"),b.i18n.msg("NAT_EXT_PORTEND"),b.i18n.msg("NAT_INT_HOST"),b.i18n.msg("NAT_INT_PORT")],colModel:[{name:"Enable",index:"Enable",width:50,sortable:false,resizable:false,editable:true,edittype:"checkbox",editoptions:{value:"true:false"},formatter:function(J,K,L){return J==="true"?b.i18n.msg("HOME_YES"):b.i18n.msg("HOME_NO")},unformat:function(K,L,J){return K===b.i18n.msg("HOME_YES")?"true":"false"},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_ENABLE")+'"'}},{name:"Description",index:"Description",width:90,sortable:false,resizable:false,editable:false,cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_DESCRIPTION")+'"'}},{name:"Protocol",index:"Protocol",width:70,sortable:false,resizable:false,editable:false,edittype:"select",editoptions:{value:"ALL:"+b.i18n.msg("NAT_ANY")+";TCP:TCP;UDP:UDP;BOTH:TCP-UDP;ICMP:ICMP;GRE:GRE;AH:AH;ESP:ESP"},formatter:function(J,K,L){if(J==="ALL"){return b.i18n.msg("NAT_ANY")}else{if(J==="BOTH"){return"TCP-UDP"}else{return J}}},unformat:function(K,L,J){if(K===b.i18n.msg("NAT_ANY")){return"ALL"}else{if(K==="TCP-UDP"){return"BOTH"}else{return K}}},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("HOME_PROTOCOL")+'"'}},{name:"RemoteHost",index:"RemoteHost",width:80,sortable:false,resizable:false,editable:false,formatter:function(J,K,L){return J===""?b.i18n.msg("NAT_ANY"):J},unformat:function(K,L,J){return(K===b.i18n.msg("NAT_ANY")||K==="0.0.0.0")?"":K},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_REMOTE_HOST")+'"'}},{name:"ExternalPort",index:"ExternalPort",width:100,sortable:false,resizable:false,editable:false,cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_EXT_PORTSTART")+'"'}},{name:"ExternalPortEndRange",index:"ExternalPortEndRange",width:100,sortable:false,resizable:false,editable:false,cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_EXT_PORTEND")+'"'}},{name:"InternalClient",index:"InternalClient",width:80,sortable:false,resizable:false,editable:false,cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_INT_HOST")+'"'}},{name:"InternalPort",index:"InternalPort",width:80,sortable:false,resizable:false,editable:false,formatter:function(J,K,L){return""+J},unformat:function(K,L,J){return parseInt(K)},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_INT_PORT")+'"'}}],forceFit:true,scrollOffset:0,editurl:"clientArray",onSelectRow:function(J){o=j(this),editparams={keys:true,aftersavefunc:function(K){o.jqGrid("resetSelection");o.removeData("editedrow");o.change();r(K)}},I=o.data("editedrow");if(J&&J!==I){if(I!==undefined){o.jqGrid("saveRow",I)}o.jqGrid("editRow",J,editparams);o.data("editedrow",J)}}};options2.caption=G.children("li:first").text();w.jqGrid(options2).parents("div.ui-jqgrid").addClass("gui-table");u.bind("arraybeforeinsert",function(J,R){var O=R.value.Creator,P=R.value.IPVersion,K="rule"+x++,M,T;if((O==="USER"||O===undefined)&&P==6&&R.value.Description.length>0){o=t;k.push(R.value)}else{J.preventDefault();return}R.value.Enable=R.value.Enable||false;R.value.Protocol=R.value.Protocol||"TCP";R.value.SourceIP=R.value.SourceIP||"";R.value.DestPortRangeMax=R.value.DestPortRangeMax||0;M=j.extend({},R.value);M.Enable=M.Enable?"true":"false";var V=b.client.newRequest(),S=b.client.newRequest();var U="Device/Firewall/Config";V.getValue(U,function(X){S.getValue("Device/Firewall/Chains",function(aa){for(var Y=0;Y<aa.length;Y++){if(aa[Y].Name.toLowerCase()==X.toLowerCase()){var Z=b.client.newRequest();Z.getValue("Device/Firewall/Chains/Chain[Name='"+aa[Y].Name+"']/Rules",function(ab){j.each(ab,function(ac,ad){if(ad.Creator=="USER"){l.push(ad)}})});Z.send({synchronous:true})}}});S.send({synchronous:true})});V.send({synchronous:true});var N=false;var L=t[0].p.data;if(L.length>=1){for(var Q=0;Q<L.length;Q++){if((L[Q].Protocol==M.Protocol)&&(L[Q].SourceIP==M.SourceIP)){N=true;break}}}if(!N){if(l.length>=1){for(var W=0;W<l.length;W++){if(M.Protocol==l[W].Protocol&&M.SourceIP==l[W].SourceIP&&M.DestIP==l[W].DestIP){M.Status=l[W].Status}}}t.jqGrid("addRowData",K,M);T=o.find("#"+K).object({connected:false,objset:null}).change(function(){var X=o.data("editedrow");if(X===K){return false}});R.item=T.data("xmo-item");R.item.current(R.value,R.capability,R.xpath);T.find(".gui-table-delete-row").click(function(Z){o.jqGrid("delRowData",K);var X=b.client.newRequest();xPathMediumChain="Device/Firewall/Chains/Chain[Name='Medium']/Rules";X.getValue(xPathMediumChain,function(ac){var ab=b.client.newRequest();j.each(ac,function(af,ae){for(var ad=0;ad<k.length;ad++){if(ae.uid==k[ad].uid&&ae.Protocol==k[ad].Protocol&&ae.SourceIP==k[ad].SourceIP){ab.deleteElement(xPathMediumChain+"/Rule[@uid='"+ae.uid+"']")}}});ab.send()});X.send();var Y=b.client.newRequest();xPathHighChain="Device/Firewall/Chains/Chain[Name='High']/Rules";Y.getValue(xPathHighChain,function(ac){var ab=b.client.newRequest();j.each(ac,function(af,ae){for(var ad=0;ad<k.length;ad++){if(ae.uid==k[ad].uid&&ae.Protocol==k[ad].Protocol&&ae.SourceIP==k[ad].SourceIP){ab.deleteElement(xPathHighChain+"/Rule[@uid='"+ae.uid+"']")}}});ab.send()});Y.send();var aa=b.client.newRequest();xPathCustomChain="Device/Firewall/Chains/Chain[Name='Custom']/Rules";aa.getValue(xPathCustomChain,function(ac){var ab=b.client.newRequest();j.each(ac,function(af,ae){for(var ad=0;ad<k.length;ad++){if(ae.uid==k[ad].uid&&ae.Protocol==k[ad].Protocol&&ae.SourceIP==k[ad].SourceIP){ab.deleteElement(xPathCustomChain+"/Rule[@uid='"+ae.uid+"']")}}});ab.send()});aa.send()})}else{o.jqGrid("delRowData",K)}v=K}).bind("arraypostactions",function(J,K){I=t.data("editedrow");if(I){t.jqGrid("saveRow",I);E(I);I=undefined}}).bind("arraybeforesubmit",function(J,K){t.each(function(){o=j(this),I=o.data("editedrow");if(I){o.jqGrid("saveRow",I);E(I);o.removeData("editedrow")}})}).after(t).hide();A={datatype:"local",height:200,colNames:[b.i18n.msg("HOME_STATUS"),b.i18n.msg("HOME_ENABLE"),b.i18n.msg("ACCESS_SERVICE"),b.i18n.msg("HOME_PROTOCOL"),b.i18n.msg("NAT_EXT_PORT"),b.i18n.msg("FIREWALL_DEST_PORT"),b.i18n.msg("FIREWALL_DEST_IP"),b.i18n.msg("NAT_REMOTE_HOST"),b.i18n.msg("NAT_DESCRIPTION"),b.i18n.msg("NAT_DELETE")],colModel:[{name:"Status",index:"Status",width:90,sortable:false,resizable:false,editable:false,edittype:"text",formatter:function(J,K,L){if(J=="ENABLED"){return b.i18n.msg("HOME_OK")}else{if(J=="DISABLED"){return b.i18n.msg("NAT_DISABLED")}else{if(J=="ERROR"){return b.i18n.msg("NAT_FAILED")}else{if(J=="ERROR_MISCONFIGURED"){return b.i18n.msg("NAT_MISCONF")}else{if(J==undefined){return b.i18n.msg("NAT_DISABLED")}else{return""}}}}}},unformat:function(K,L,J){if(K==b.i18n.msg("HOME_OK")){return"ENABLED"}else{if(K==b.i18n.msg("NAT_DISABLED")){return"DISABLED"}else{if(K==b.i18n.msg("NAT_MISCONF")){return"ERROR_MISCONFIGURED"}else{if(K==b.i18n.msg("NAT_FAILED")){return"ERROR"}else{return""}}}}},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("HOME_STATUS")+'"'}},{name:"Enable",index:"Enable",width:45,sortable:false,resizable:false,editable:true,edittype:"checkbox",editoptions:{value:"true:false"},formatter:function(J,K,L){return J==="true"?b.i18n.msg("HOME_YES"):b.i18n.msg("HOME_NO")},unformat:function(K,L,J){return K===b.i18n.msg("HOME_YES")?"true":"false"},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_ENABLE")+'"'}},{name:"Service",index:"Service",width:65,sortable:false,resizable:false,editable:true,edittype:"select",editoptions:{value:"NONE:"+b.i18n.msg("HOME_NONE")+";FTP:FTP;FTP-DATA:FTP-DATA;SSH:SSH;TELNET:TELNET;DNS:DNS;NTP:NTP;NNTP:NNTP;HTTP:HTTP;HTTPS:HTTPS;POP3:POP3;POP3S:POP3S;IMAP:IMAP;IMAPS:IMAPS;TFTP:TFTP;ICMP:ICMP;TRACEROUTE:TRACEROUTE;SNMP-TCP:SNMP-TCP;SNMP-UDP:SNMP-UDP;SYSLOG:SYSLOG;IPSEC:IPSEC;SMTP:SMTP;SSMTP:SSMTP;SMTP-AUTH:SMTP-AUTH",dataEvents:[{type:"change",fn:function(L){var K=this.id.replace("Service","DestPort"),J=this.id.replace("Service","SourcePort"),M=this.id.replace("Service","Protocol");j("#"+K).prop("disabled",true);j("#"+J).prop("disabled",true);j("#"+M).prop("disabled",true);switch(this.value){case"FTP":j("#"+K).val(21);j("#"+J).val(0);j("#"+M).val("TCP");break;case"FTP-DATA":j("#"+K).val(20);j("#"+J).val(0);j("#"+M).val("TCP");break;case"SSH":j("#"+K).val(22);j("#"+J).val(0);j("#"+M).val("TCP");break;case"TELNET":j("#"+K).val(23);j("#"+J).val(0);j("#"+M).val("TCP");break;case"DNS":j("#"+K).val(53);j("#"+J).val(0);j("#"+M).val("UDP");break;case"NTP":j("#"+K).val(123);j("#"+J).val(0);j("#"+M).val("UDP");break;case"NNTP":j("#"+K).val(119);j("#"+J).val(0);j("#"+M).val("TCP");break;case"HTTP":j("#"+K).val(80);j("#"+J).val(0);j("#"+M).val("TCP");break;case"HTTPS":j("#"+K).val(443);j("#"+J).val(0);j("#"+M).val("TCP");break;case"POP3":j("#"+K).val(110);j("#"+J).val(0);j("#"+M).val("TCP");break;case"POP3S":j("#"+K).val(995);j("#"+J).val(0);j("#"+M).val("TCP");break;case"IMAP":j("#"+K).val(143);j("#"+J).val(0);j("#"+M).val("TCP");break;case"IMAPS":j("#"+K).val(993);j("#"+J).val(0);j("#"+M).val("TCP");break;case"TFTP":j("#"+K).val(69);j("#"+J).val(0);j("#"+M).val("UDP");break;case"ICMP":j("#"+K).val(0);j("#"+J).val(0);j("#"+M).val("Any");break;case"TRACEROUTE":j("#"+K).val(0);j("#"+J).val(0);j("#"+M).val("Any");break;case"SNMP-TCP":j("#"+K).val("161-162");j("#"+J).val("161-162");j("#"+M).val("TCP");break;case"SNMP-UDP":j("#"+K).val(161);j("#"+J).val(0);j("#"+M).val("UDP");break;case"SYSLOG":j("#"+K).val(514);j("#"+J).val(0);j("#"+M).val("UDP");break;case"IPSEC":j("#"+K).val(0);j("#"+J).val(0);j("#"+M).val("Any");break;case"SMTP":j("#"+K).val(25);j("#"+J).val(0);j("#"+M).val("TCP");break;case"SSMTP":j("#"+K).val(465);j("#"+J).val(0);j("#"+M).val("TCP");break;case"SMTP-AUTH":j("#"+K).val(587);j("#"+J).val(0);j("#"+M).val("TCP");break;default:j("#"+K).val(0);j("#"+J).val(0);j("#"+M).val("Any");j("#"+K).prop("disabled",false);j("#"+J).prop("disabled",false);j("#"+M).prop("disabled",false);break}}}]},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("ACCESS_SERVICE")+'"'}},{name:"Protocol",index:"Protocol",width:60,sortable:false,resizable:false,editable:true,edittype:"select",editoptions:{value:"ALL:Any;BOTH:"+b.i18n.msg("NAT_TCPUDP")+";TCP:TCP;UDP:UDP;ICMP:ICMP;GRE:GRE;AH:AH;ESP:ESP",dataEvents:[{type:"change",fn:function(J){var K=j(J.target).val();if(K!=="ALL"&&K!=="TCP"&&K!=="UDP"&&K!=="BOTH"){j("#"+I+"_DestPort").attr("disabled","true").hide();j("#"+I+"_SourcePort").attr("disabled","true").hide();j("#"+I+"_Service").prop("disabled",true);j("#"+I+"_DestPort").val(0);j("#"+I+"_SourcePort").val(0)}else{j("#"+I+"_DestPort").removeAttr("disabled").show();j("#"+I+"_SourcePort").removeAttr("disabled").show();j("#"+I+"_Service").prop("disabled",false)}}}]},formatter:function(J,K,L){if(J==="BOTH"){return"TCP-UDP"}else{if(J==="ALL"){return"Any"}else{return J||" "}}},unformat:function(K,L,J){if(K===b.i18n.msg("NAT_TCPUDP")){return"BOTH"}else{if(K==="Any"){return"ALL"}else{return K}}},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("HOME_PROTOCOL")+'"'}},{name:"DestPortRangeMax",index:"DestPortRangeMax",width:60,sortable:false,resizable:false,editable:true,cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_EXT_PORT")+'"'}},{name:"DestPort",index:"DestPort",width:50,sortable:false,resizable:false,editable:true,formatter:function(J,K,L){if(parseInt(L.DestPort,10)===1&&parseInt(L.DestPortRangeMax,10)===65535){return"0"}else{if(L.hasOwnProperty("DestPortRangeMax")&&parseInt(L.DestPortRangeMax,10)!=0){if(J.toString().indexOf("-")!==-1){return J}else{return J+"-"+L.DestPortRangeMax}}else{return J}}},unformat:function(K,L,J){return K},cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("FIREWALL_DEST_PORT")+'"'}},{name:"DestIP",index:"DestIP",width:90,sortable:false,resizable:false,editable:true,cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("FIREWALL_DEST_IP")+'"'}},{name:"SourceIP",index:"SourceIP",width:90,sortable:false,resizable:false,editable:!j.gui.natIpAddr,cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_REMOTE_HOST")+'"'}},{name:"Description",index:"Description",width:75,sortable:false,resizable:false,editable:true,cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_DESCRIPTION")+'"'}},{name:"Delete",index:"Delete",width:70,sortable:false,resizable:false,classes:"gui-table-delete-row",cellattr:function(L,N,K,J,M){return' data-label="'+b.i18n.msg("NAT_DELETE")+'"'}}],forceFit:true,scrollOffset:0,editurl:"clientArray",onSelectRow:function(N){var M=parseInt(N.substring("rule".length));if(M>=n){var K={keys:true,aftersavefunc:function(O){E(O);a(t,t.jqGrid("getRowData",O),O);t.jqGrid("resetSelection");I=undefined}};if(N&&N!==I){t.jqGrid("saveRow",I);E(I);t.jqGrid("editRow",N,K);t.data("editedrow",N);I=N}var L=j("#"+N+"_Protocol").val();var J=j("#"+N+"_Service").val();if(L!=="ALL"&&L!=="TCP"&&L!=="UDP"&&L!=="BOTH"){j("#"+N+"_DestPort").attr("disabled","true").hide();j("#"+N+"_DestPortRangeMax").attr("disabled","true").hide();j("#"+N+"_DestPort").val(0);j("#"+N+"_DestPortRangeMax").val(0)}else{j("#"+N+"_DestPort").removeAttr("disabled").show();j("#"+N+"_DestPortRangeMax").removeAttr("disabled").show()}if(J==="NONE"){j("#"+N+"_DestPort").removeAttr("disabled");j("#"+N+"_DestPortRangeMax").removeAttr("disabled")}else{j("#"+N+"_DestPort").attr("disabled","true");j("#"+N+"_DestPortRangeMax").attr("disabled","true");j("#"+N+"_Protocol").attr("disabled","true")}}else{return false}}};A.caption=u.children("li:first").text();t.jqGrid(A).parents("div.ui-jqgrid").addClass("gui-table");y.click(function(J){I=C.data("editedrow");if(I){C.jqGrid("saveRow",I);r(I);I=undefined}J.preventDefault();J.stopImmediatePropagation();if((F.host!==undefined)&&!j.gui.natIpAddr){b.alert(b.i18n.msg("NAT_CTRL_MUST_IP"));return}var K={Enable:true,Status:"EDITING",Creator:"USER",InternalInterface:"Device/IP/Interfaces/Interface[IP_BR_LAN]",ExternalInterface:"Device/IP/Interfaces/Interface[IP_DATA]",RemoteHost:"",ExternalPort:"0",InternalClient:j.gui.natIpAddr?j.gui.natIpAddr:"",InternalPort:"0",Description:"",Protocol:"ALL",Service:"NONE",Manuel:true};B.array("insert",-1,K,new b.api.Capability({name:"PortMapping"}));C.jqGrid("setSelection",v)});H.click(function(J){I=t.data("editedrow");if(I){t.jqGrid("saveRow",I);E(I);if(!j.isEmptyObject(t.jqGrid("getRowData",I))){a(t,t.jqGrid("getRowData",I),I)}I=undefined}J.preventDefault();J.stopImmediatePropagation();if((F.host!==undefined)&&!j.gui.natIpAddr){b.alert(b.i18n.msg("NAT_CTRL_MUST_IP"));return}var K={Enable:true,Status:"EDITING",Creator:"USER",SourceInterface:"Device/IP/Interfaces/Interface[IP_BR_LAN]",DestInterface:"Device/IP/Interfaces/Interface[IP_DATA]",SourceIP:"",DestIP:"",DestMask:"0.0.0.0",DestPort:"0",DestPortRangeMax:"0",Description:"-",IPVersion:"6",Protocol:"ALL",Service:"NONE",DestInterface:"Device/IP/Interfaces/Interface[IP_DATA]",Target:"ACCEPT"};u.array("insert",-1,K,new b.api.Capability({name:"Rule"}));t.jqGrid("setSelection",v)});p.on("natpagetrigger",function(J,N,M){var L=C.data("editedrow");var K=t.data("editedrow");if(L!=undefined){C.jqGrid("saveRow",L)}if(C[0].p.data.length>=1){if(h(C,j("#IpGateway",z).html(),j("#DMZIp",z).html(),j("#DMZEnable",z).html(),w)==true){return true}}if(K!=undefined){t.jqGrid("saveRow",K)}if(t[0].p.data.length>=1){if(L!=undefined){if(a(t,t.jqGrid("getRowData",L),L)===true){return true}}}return false})}}).delegate("#NatPage","pageshow",function(){if(b.displayMode===b.GUI_SMARTPHONE_MODE){j("#NATPortMappingAddBtn",j(this)).hide();j("#PinholesPortMappingAddBtn",j(this)).hide();j("#pressEnter",j(this)).hide();j("#portMappingTable",j(this)).empty();j("#portMappingTable",j(this)).append("<table data-role='table' data-mode='columntoggle' style='border:1px solid' class='mobilePort' id='tablePort'></table>");j("#tablePort",j(this)).append("<thead>");j("#tablePort",j(this)).append("<tr>");j("#tablePort",j(this)).append("<th>"+b.i18n.msg("HOME_STATUS")+"</th>");j("#tablePort",j(this)).append("<th>"+b.i18n.msg("HOME_PROTOCOL")+"</th>");j("#tablePort",j(this)).append("<th>"+b.i18n.msg("NAT_INT_HOST")+"</th>");j("#tablePort",j(this)).append("<th>"+b.i18n.msg("NAT_INT_PORT")+"</th>");j("#tablePort",j(this)).append("<th>"+b.i18n.msg("NAT_REMOTE_HOST")+"</th>");j("#tablePort",j(this)).append("<th>"+b.i18n.msg("NAT_EXT_PORTSTART")+"</th>");j("#tablePort",j(this)).append("</tr>");j("#tablePort",j(this)).append("</thead>");j("#tablePort",j(this)).append("<tbody id='bodyTable'>");j("#tablePort",j(this)).append("</tbody>");j("#portMappingTable",j(this)).append("<br/>");j("#upnpPortMappingTable",j(this)).empty();j("#upnpPortMappingTable",j(this)).append("<table data-role='table' data-mode='columntoggle' style='border:1px solid' class='mobilePort' id='upnpTablePort'></table>");j("#upnpTablePort",j(this)).append("<thead>");j("#upnpTablePort",j(this)).append("<tr>");j("#upnpTablePort",j(this)).append("<th>"+b.i18n.msg("HOME_STATUS")+"</th>");j("#upnpTablePort",j(this)).append("<th>"+b.i18n.msg("HOME_PROTOCOL")+"</th>");j("#upnpTablePort",j(this)).append("<th>"+b.i18n.msg("NAT_INT_HOST")+"</th>");j("#upnpTablePort",j(this)).append("<th>"+b.i18n.msg("NAT_INT_PORT")+"</th>");j("#upnpTablePort",j(this)).append("<th>"+b.i18n.msg("NAT_REMOTE_HOST")+"</th>");j("#upnpTablePort",j(this)).append("<th>"+b.i18n.msg("NAT_EXT_PORTSTART")+"</th>");j("#upnpTablePort",j(this)).append("</tr>");j("#upnpTablePort",j(this)).append("</thead>");j("#upnpTablePort",j(this)).append("<tbody id='upnpBodyTable'>");j("#upnpTablePort",j(this)).append("</tbody>");j("#upnpPortMappingTable",j(this)).append("<br/>");j("#pinholingTable",j(this)).empty();j("#pinholingTable",j(this)).append("<table data-role='table' data-mode='columntoggle' style='border:1px solid' class='mobilePort' id='pinholingTablePort'></table>");j("#pinholingTablePort",j(this)).append("<thead>");j("#pinholingTablePort",j(this)).append("<tr>");j("#pinholingTablePort",j(this)).append("<th>"+b.i18n.msg("HOME_STATUS")+"</th>");j("#pinholingTablePort",j(this)).append("<th>"+b.i18n.msg("HOME_PROTOCOL")+"</th>");j("#pinholingTablePort",j(this)).append("<th>"+b.i18n.msg("FIREWALL_DEST_IP")+"</th>");j("#pinholingTablePort",j(this)).append("<th>"+b.i18n.msg("FIREWALL_DEST_PORT")+"</th>");j("#pinholingTablePort",j(this)).append("<th>"+b.i18n.msg("NAT_REMOTE_HOST")+"</th>");j("#pinholingTablePort",j(this)).append("<th>"+b.i18n.msg("NAT_EXT_PORT")+"</th>");j("#pinholingTablePort",j(this)).append("</tr>");j("#pinholingTablePort",j(this)).append("</thead>");j("#pinholingTablePort",j(this)).append("<tbody id='pinholeBodyTable'>");j("#pinholingTablePort",j(this)).append("</tbody>");j("#pinholingTable",j(this)).append("<br/>");var r=j.gui.client.newRequest(),p=j.gui.client.newRequest();var q=j(this);r.getValue("Device/NAT/PortMappings",function(y){for(var w=0;w<y.length;w++){var x=y[w].Creator,v;var t=y[w].InternalClient.split(".");var s="";if(y[w].Status=="ENABLED"){s=b.i18n.msg("HOME_OK")}else{if(y[w].Status=="DISABLED"){s=b.i18n.msg("NAT_DISABLED")}else{if(y[w].Status=="ERROR"){s=b.i18n.msg("NAT_FAILED")}else{if(y[w].Status=="ERROR_MISCONFIGURED"){s=b.i18n.msg("NAT_MISCONF")}else{if(y[w].Status==undefined){s=b.i18n.msg("NAT_DISABLED")}else{s=""}}}}}var u="<tr><td id='tdPort'>"+s+"</td><td id='tdPort'>"+y[w].Protocol+"</td><td id='tdPort'>x.x."+t[2]+"."+t[3]+"</td><td id='tdPort'>"+y[w].InternalPort+"</td><td id='tdPort'>"+y[w].RemoteHost+"</td><td id='tdPort'>"+y[w].ExternalPort+"</td></tr>";if(x==="USER"||x===undefined){j("#bodyTable",q).append(u)}else{if(x==="UPNP"){j("#upnpBodyTable",q).append(u)}}}});r.send();p.getValue("Device/Firewall/Chains/Chain/Rules",function(y){for(var w=0;w<y.length;w++){var x=y[w].Creator,v;var t=y[w].DestIP.split(".");var s="";if(y[w].Status=="ENABLED"){s=b.i18n.msg("HOME_OK")}else{if(y[w].Status=="DISABLED"){s=b.i18n.msg("NAT_DISABLED")}else{if(y[w].Status=="ERROR"){s=b.i18n.msg("NAT_FAILED")}else{if(y[w].Status=="ERROR_MISCONFIGURED"){s=b.i18n.msg("NAT_MISCONF")}else{if(y[w].Status==undefined){s=b.i18n.msg("NAT_DISABLED")}else{s=""}}}}}var u="<tr><td id='tdPort'>"+s+"</td><td id='tdPort'>"+y[w].Protocol+"</td><td id='tdPort'>"+y[w].DestPortRangeMax+"</td><td id='tdPort'>"+y[w].DestPort+"</td><td id='tdPort'>"+y[w].DestIP+"</td><td id='tdPort'>"+y[w].SourceIP+"</td></tr>";if(x==="USER"||x===undefined){j("#pinholeBodyTable",q).append(u)}}});p.send()}j("#ApplyButton",j(this)).disable()}).delegate("#NatPage","pagebeforehide",function(){j("#NATPortMappingRuleTable")[0].p.data.forEach(function(p){if(p.Status==="EDITING"){j("#"+p.id).remove()}});j("#PinholingRuleTable")[0].p.data.forEach(function(p){if(p.Status==="EDITING"){j("#"+p.id).remove()}})});function m(p,q){if(p=="ALL"||q=="ALL"){return true}else{if(p=="BOTH"&&(q==undefined||q=="TCP"||q=="UDP"||q=="BOTH")){return true}else{if(q=="BOTH"&&(p==undefined||p=="TCP"||p=="UDP"||q=="BOTH")){return true}else{if(p==q||(p==undefined&&q=="TCP")||(p=="TCP"&&q==undefined)){return true}else{return false}}}}}function c(p,q){if(p==undefined||q==undefined||p==q||p==""||q==""){return true}else{return false}}function g(p,q){if(!(q in p)){p[q]=""}return p}function f(p,q){if(p.indexOf(q)==-1){p+=q+"\n"}return p}function h(r,v,A,y,I){var u;var q=new String();var B={};size=r[0].p.data.length;if(size>1||d.length){for(var x=size-1;x>=0;x--){if(r[0].p.data[x]!=undefined){u=r.jqGrid("getRowData",r[0].p.data[x].id);if(u.InternalClient==undefined){continue}}else{continue}for(var D=0;D<size&&q=="";D++){if(x==D||r[0].p.data[D]==undefined){continue}var H=r.jqGrid("getRowData",r[0].p.data[D].id);if(H.ExternalPort==undefined){continue}if(!u.InternalClient.match("^(([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])$")){q=f(q,b.i18n.msg("NAT_CTRL_INT_HOST_MUST_IP"));B=g(B,r[0].p.data[x].id)}if(u.RemoteHost!=""&&!u.RemoteHost.match("^(([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])$")){q=f(q,b.i18n.msg("NAT_CTRL_REMOTE_HOST_MUST_IP"));B=g(B,r[0].p.data[x].id)}if(u.ExternalPortEndRange>0&&u.ExternalPortEndRange!=u.ExternalPort){if((!u.ExternalPort.toString().match("^[0-9]{1,5}$")||parseInt(u.ExternalPort)<1||parseInt(u.ExternalPort)>65535||!u.ExternalPortEndRange.toString().match("^[0-9]{1,5}$")||parseInt(u.ExternalPortEndRange)<1||parseInt(u.ExternalPortEndRange)>65535||parseInt(u.ExternalPort)>=parseInt(u.ExternalPortEndRange))){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORTRANGE_NUMBER"));B=g(B,r[0].p.data[x].id)}if(H.ExternalPortEndRange>0&&H.ExternalPortEndRange!=H.ExternalPort){for(var G=u.ExternalPort;G<=u.ExternalPortEndRange;G++){for(var E=parseInt(H.ExternalPort);E<=parseInt(H.ExternalPortEndRange);E++){if(G==E&&c(H.RemoteHost,u.RemoteHost)&&m(H.Protocol,u.Protocol)){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORT_BUSY"));B=g(B,r[0].p.data[x].id)}}}}else{for(var G=u.ExternalPort;G<=u.ExternalPortEndRange;G++){if(G==H.ExternalPort&&m(H.Protocol,u.Protocol)&&c(H.RemoteHost,u.RemoteHost)){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORT_BUSY"));B=g(B,r[0].p.data[x].id)}}}}else{if(H.ExternalPortEndRange>0&&H.ExternalPortEndRange!=H.ExternalPort){var F=new Array();F[0]=H.ExternalPort;F[1]=H.ExternalPortEndRange;if((!H.ExternalPort.toString().match("^[0-9]{1,5}$")||parseInt(H.ExternalPort)<1||parseInt(H.ExternalPort)>=65535||!H.ExternalPortEndRange.toString().match("^[0-9]{1,5}$")||parseInt(H.ExternalPortEndRange)<1||parseInt(H.ExternalPortEndRange)>=65535||parseInt(H.ExternalPort)>=parseInt(H.ExternalPortEndRange))){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORTRANGE_NUMBER"));B=g(B,r[0].p.data[x].id)}for(var G=H.ExternalPort;G<=H.ExternalPortEndRange;G++){if(G==u.ExternalPort&&c(H.RemoteHost,u.RemoteHost)&&m(H.Protocol,u.Protocol)){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORT_BUSY"));B=g(B,r[0].p.data[x].id)}}}else{if(u.ExternalPort==H.ExternalPort&&c(H.RemoteHost,u.RemoteHost)&&m(H.Protocol,u.Protocol)){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORT_BUSY"));B=g(B,r[0].p.data[x].id)}if((!u.ExternalPort.toString().match("^[0-9]{1,5}$")||parseInt(u.ExternalPort)<1||parseInt(u.ExternalPort)>65535)){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORT_NUMBER"));B=g(B,r[0].p.data[x].id)}}}if(u.InternalClient==v){q=f(q,b.i18n.msg("NAT_CTRL_INT_HOST_GTW"));B=g(B,r[0].p.data[x].id)}if(y=="true"&&A!=""&&u.InternalClient==A){q=f(q,b.i18n.msg("NAT_CTRL_INT_HOST_DMZ"));B=g(B,r[0].p.data[x].id)}if((!u.InternalPort.toString().match("^[0-9]{1,5}$")||parseInt(u.InternalPort)<1||parseInt(u.InternalPort)>65535)){q=f(q,b.i18n.msg("NAT_CTRL_INT_PORT_NUMBER"));B=g(B,r[0].p.data[x].id)}}for(D=0;D<d.length&&q=="";D++){var H=d[D];if(H.ExternalPort==undefined){continue}if(!u.InternalClient.match("^(([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])$")){q=f(q,b.i18n.msg("NAT_CTRL_INT_HOST_MUST_IP"));B=g(B,r[0].p.data[x].id)}if(u.RemoteHost!=""&&!u.RemoteHost.match("^(([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])$")){q=f(q,b.i18n.msg("NAT_CTRL_REMOTE_HOST_MUST_IP"));B=g(B,r[0].p.data[x].id)}if(u.ExternalPortEndRange>0&&u.ExternalPortEndRange!=u.ExternalPort){if((!u.ExternalPort.toString().match("^[0-9]{1,5}$")||parseInt(u.ExternalPort)<1||parseInt(u.ExternalPort)>=65535||!u.ExternalPortEndRange.toString().match("^[0-9]{1,5}$")||parseInt(u.ExternalPortEndRange)<1||parseInt(u.ExternalPortEndRange)>=65535||parseInt(u.ExternalPort)>=parseInt(u.ExternalPortEndRange))){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORTRANGE_NUMBER"));B=g(B,r[0].p.data[x].id)}if(H.ExternalPortEndRange>0){for(var G=u.ExternalPort;G<=u.ExternalPortEndRange;G++){for(var E=H.ExternalPort;E<=H.ExternalPortEndRange;E++){if(G==E&&c(H.RemoteHost,u.RemoteHost)&&m(H.Protocol,u.Protocol)){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORT_BUSY"));B=g(B,r[0].p.data[x].id)}}}}else{for(var G=u.ExternalPort;G<=u.ExternalPortEndRange;G++){if(G==H.ExternalPort.toString()&&m(H.Protocol,u.Protocol)&&c(H.RemoteHost,u.RemoteHost)){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORT_BUSY"));B=g(B,r[0].p.data[x].id)}}}}else{if(H.ExternalPortEndRange>0){if((!H.ExternalPort.toString().match("^[0-9]{1,5}$")||parseInt(H.ExternalPort)<1||parseInt(H.ExternalPort)>=65535||!H.ExternalPortEndRange.toString().match("^[0-9]{1,5}$")||parseInt(H.ExternalPortEndRange)<1||parseInt(H.ExternalPortEndRange)>=65535||parseInt(H.ExternalPort)>=parseInt(H.ExternalPortEndRange))){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORTRANGE_NUMBER"));B=g(B,r[0].p.data[x].id)}for(var G=H.ExternalPort;G<=H.ExternalPortEndRange;G++){if(G==u.ExternalPort&&c(H.RemoteHost,u.RemoteHost)&&m(H.Protocol,u.Protocol)){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORT_BUSY"));B=g(B,r[0].p.data[x].id)}}}else{if(u.ExternalPort==H.ExternalPort&&c(H.RemoteHost,u.RemoteHost)&&m(H.Protocol,u.Protocol)){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORT_BUSY"));B=g(B,r[0].p.data[x].id)}if((!u.ExternalPort.toString().match("^[0-9]{1,5}$")||parseInt(u.ExternalPort)<1||parseInt(u.ExternalPort)>65535)){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORT_NUMBER"));B=g(B,r[0].p.data[x].id)}}}if(u.InternalClient==v){q=f(q,b.i18n.msg("NAT_CTRL_INT_HOST_GTW"));B=g(B,r[0].p.data[x].id)}if(y=="true"&&A!=""&&u.InternalClient==A){q=f(q,b.i18n.msg("NAT_CTRL_INT_HOST_DMZ"));B=g(B,r[0].p.data[x].id)}if((!u.InternalPort.toString().match("^[0-9]{1,5}$")||parseInt(u.InternalPort)<1||parseInt(u.InternalPort)>65535)){q=f(q,b.i18n.msg("NAT_CTRL_INT_PORT_NUMBER"));B=g(B,r[0].p.data[x].id)}}}}else{if(size==1){u=r.jqGrid("getRowData",r[0].p.data[0].id);if(!u.InternalClient.match("^(([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])$")){q=f(q,b.i18n.msg("NAT_CTRL_INT_HOST_MUST_IP"))}if(u.RemoteHost!=""&&!u.RemoteHost.match("^(([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])$")){q=f(q,b.i18n.msg("NAT_CTRL_REMOTE_HOST_MUST_IP"))}if(u.InternalClient==v){q=f(q,b.i18n.msg("NAT_CTRL_INT_HOST_GTW"))}if(y=="true"&&A!=""&&u.InternalClient==A){q=f(q,b.i18n.msg("NAT_CTRL_INT_HOST_DMZ"))}if(u.ExternalPortEndRange>0&&u.ExternalPortEndRange!=u.ExternalPort){if(!u.ExternalPort.toString().match("^[0-9]{1,5}$")||(parseInt(u.ExternalPort)<1)||(parseInt(u.ExternalPort)>65535)||!u.ExternalPortEndRange.toString().match("^[0-9]{1,5}$")||(parseInt(u.ExternalPortEndRange)<1)||(parseInt(u.ExternalPortEndRange)>65535)||(parseInt(u.ExternalPort)>=parseInt(u.ExternalPortEndRange))){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORTRANGE_NUMBER"))}}else{if(!u.ExternalPort.match("^[0-9]{1,5}$")||parseInt(u.ExternalPort)<1||parseInt(u.ExternalPort)>65535){q=f(q,b.i18n.msg("NAT_CTRL_EXT_PORT_NUMBER"))}}if(!u.InternalPort.match("^[0-9]{1,5}$")||parseInt(u.InternalPort)<1||parseInt(u.InternalPort)>65535){q=f(q,b.i18n.msg("NAT_CTRL_INT_PORT_NUMBER"))}if(q.length>0){B=g(B,r[0].p.data[0].id)}}}if(q.length>0){b.alert(q);for(var z in B){r.jqGrid("delRowData",z)}return true}if(e.length){for(var C=0;C<e.length;C++){H=e[C];size=r[0].p.data.length;for(var x=size-1;x>=0;x--){if(r[0].p.data[x]!=undefined){u=r.jqGrid("getRowData",r[0].p.data[x].id)}if(c(H.RemoteHost,u.RemoteHost)&&m(H.Protocol,u.Protocol)){var w=parseInt(u.ExternalPort);var t=parseInt(u.ExternalPortEndRange);var s=parseInt(H.ExternalPort);var p=parseInt(H.ExternalPortEndRange);if(w==s&&t==0&&p==0){b.alert(b.i18n.msg("NAT_CTRL_RULE_IN_UPNP"));r.jqGrid("delRowData",r[0].p.data[x].id);return true}if(t==0&&w>=s&&w<=p){b.alert(b.i18n.msg("NAT_CTRL_RULE_IN_UPNP"));r.jqGrid("delRowData",r[0].p.data[x].id);return true}if(p==0&&s>=w&&s<=t){b.alert(b.i18n.msg("NAT_CTRL_RULE_IN_UPNP"));r.jqGrid("delRowData",r[0].p.data[x].id);return true}if(w>=s&&w<=p){b.alert(b.i18n.msg("NAT_CTRL_RULE_IN_UPNP"));r.jqGrid("delRowData",r[0].p.data[x].id);return true}if(s>=w&&s<=t){b.alert(b.i18n.msg("NAT_CTRL_RULE_IN_UPNP"));r.jqGrid("delRowData",r[0].p.data[x].id);return true}}}}}return false}function a(s,q,u){var p="";if(q.DestIP){var t=q.DestIP;if(!t.match("^(([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])$")){p=f(p,b.i18n.msg("FIREWALL_DEST_IP_ERROR"))}}if(q.SourceIP){var r=q.SourceIP;if(!r.match("^(([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])$")){p=f(p,b.i18n.msg("FIREWALL_SOURCE_IP_ERROR"))}}if(q.Protocol==="ALL"||q.Protocol==="TCP"||q.Protocol==="UDP"){if(isNaN(parseInt(q.DestPort,10))||parseInt(q.DestPort,10)<0||parseInt(q.DestPort,10)>65535){p=f(p,b.i18n.msg("FIREWALL_DEST_PORT_ERROR"))}if(isNaN(parseInt(q.SourcePort,10))||parseInt(q.SourcePort,10)<0||parseInt(q.SourcePort,10)>65535){p=f(p,b.i18n.msg("FIREWALL_SOURCE_PORT_ERROR"))}}if(p.length>0){b.alert(p);s.jqGrid("delRowData",u);return true}return false}});jQuery(function(d){var b=d.gui,c=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY","SUNDAY"],a=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23];d(document).delegate("#ParentalControlPage","pagebeforecreate",function(){var f=d(this),h=d.QueryString(f.data("url")),g=d("#SchedulerHostsSelect",f);b.getSettingsDeviceHeaderInfos(h,f);if(h.host!==undefined){var e=g.attr("data-options-xpath");e=e.replace(/\[.*\]/,"[@uid='"+h.host+"']");g.attr("data-options-xpath",e)}if(b.deviceType!=b.GUI_SMARTPHONE_MODE){d("#globalMobile").remove()}}).delegate("#ParentalControlPage","pagecreate",function(){var o=d(this),x,A,B=d.QueryString(o.data("url")),e=d(".gui-scheduler ",o),C=e.children(".gui-scheduler-week"),n=C.children(".gui-scheduler-header").children(".gui-scheduler-hours"),q=e.children(".gui-scheduler-days"),y=C.children(".gui-scheduler-select"),u=d(".gui-scheduler-static ",o),l=u.children(".gui-scheduler-week"),D=l.children(".gui-scheduler-header").children(".gui-scheduler-hours"),w=u.children(".gui-scheduler-days"),k=l.children(".gui-scheduler-select"),g=d("#SchedulerHostsSelect",o),f=d("#SchedulerDaysSelect",o),j=d("#SchedulerSelectDaysBtn",o),E=d("#SchedulerUnselectDaysBtn",o),t=d("#SchedulerHoursSelect",o),m=[],p=[],s=[],v=false;o.bind("objsetload",function(h,F){v=true});if(B.host!==undefined){d("#ParentalControlHosts",o).hide()}g.select("option","sessionOptions",{depth:-1}).bind("selectbeforeoption",function(h,G){var F=G.value;G.value=m.length;if(F.IPAddress==="1.1.1.2"||F.IPAddress==="10.1.1.2"){h.preventDefault();h.stopImmediatePropagation();return}if((F.InterfaceType==="Ethernet"||F.InterfaceType==="WiFi")&&(F.PhysAddress===""||F.IPAddress==="")){h.preventDefault();h.stopImmediatePropagation();return}if(F.UserDeviceType==="TV_DECODER"){h.preventDefault();h.stopImmediatePropagation();return}m.push(F);F.scheduler={};d.each(c,function(I,H){F.scheduler[H]={hours:[]}});d.each(F.BlacklistedSchedule,function(I,H){var J=F.scheduler[H.DayIndex];for(x=0;x<24;x++){J.hours[x]=H["Hours"+x]}});if(F.UserFriendlyName!=""&&F.UserFriendlyName!=undefined&&F.PhysAddress!=undefined&&F.UserFriendlyName.toLowerCase()!=F.PhysAddress.toLowerCase()){G.text=F.UserFriendlyName}else{if(F.UserHostName){G.text=F.UserHostName}else{if(F.HostName){G.text=F.HostName}else{G.text=b.i18n.msg("HOME_DEVICE")}}}if(F.PhysAddress!=""){G.text+=" ("+F.PhysAddress+")"}if(B.host!==undefined){G.selected=true}}).change(function(){if(v||(B.host!==undefined)){p=[];g.children("option:selected").each(function(){p.push(m[d(this).val()])});d("li",y).removeClass("gui-scheduler-configured gui-scheduler-mixed gui-scheduler-denied").unbind("slotvalue");d("li",k).removeClass("gui-scheduler-configured gui-scheduler-mixed gui-scheduler-denied").unbind("slotvalue");if(m.length){d.each(p,function(H,G){d.each(c,function(I,K){var J=G.scheduler[K],P=y.find(".gui-scheduler-"+K.toLowerCase()),N=k.find(".gui-scheduler-"+K.toLowerCase()),M,O,L;d.each(a,function(R,Q){M=P.eq(Q);$slot_stat=N.eq(Q);O=J.hours[Q];M.bind("slotvalue",function(S,T){J.hours[Q]=T.denied});if(H>0){if(!M.hasClass("gui-scheduler-mixed")){if(M.hasClass("gui-scheduler-denied")){if(!O){M.addClass("gui-scheduler-mixed").removeClass("gui-scheduler-denied");$slot_stat.addClass("gui-scheduler-mixed").removeClass("gui-scheduler-denied")}}else{if(O){M.addClass("gui-scheduler-mixed");$slot_stat.addClass("gui-scheduler-mixed")}}}else{M.addClass("gui-scheduler-mixed").removeClass("gui-scheduler-denied");$slot_stat.addClass("gui-scheduler-mixed").removeClass("gui-scheduler-denied")}}else{if(O){M.addClass("gui-scheduler-denied");$slot_stat.addClass("gui-scheduler-denied")}}})})})}if(p.length){d(".gui-scheduler-dayselect",o).enable();var F=false;var h=[];d.each(z(p),function(G,I){var H=[];d.each(I.hours,function(J,K){if(K){H.push({hour:J,value:K});F=true}});h.push({day:G,hours:H})})}}});function z(G){var F=[];for(var h in G){if((typeof G[h]=="object")&&!G.hasOwnProperty("hours")){F=F.concat(z(G[h]))}else{if(G.hasOwnProperty("hours")){F.push(G)}}}return F}d("#SchedulerSelectAllBtn",o).click(function(){var h=[];g.children("option").each(function(){h.push(d(this).val())});g.val(h).change()});d("#SchedulerUnselectAllBtn",o).click(function(){g.val("").change()});if(b.deviceType!=b.GUI_SMARTPHONE_MODE){for(x=0;x<24;x++){n.append('<li class="gui-scheduler-'+x+'h" data-hour="'+x+'h" >&nbsp;</li>')}d.each(c,function(G,F){var h=d('<div class="gui-scheduler-row" >');for(x=0;x<24;x++){h.append('<li class="gui-scheduler-slot gui-scheduler-'+x+"h gui-scheduler-"+F.toLowerCase()+'" >&nbsp;</li>')}y.append(h)})}function r(h){if(p.length===0){b.alert(b.i18n.msg("PARENTAL_NO_HOST_SELECT"));return false}else{d("#ApplyButton",o).removeClass("ui-disabled");d("#ApplyButton",o).data("force-enabled",true);return true}}q.children(".gui-scheduler-day").mousedown(r).end().selectable({filter:".gui-scheduler-day"}).bind("selectableselecting",function(G,H){var F=d(H.selecting),h=y.find(".gui-scheduler-"+F.attr("data-day").toLowerCase());h.addClass("ui-selecting")}).bind("selectableunselecting",function(G,H){var F=d(H.unselecting),h=y.find(".gui-scheduler-"+F.attr("data-day").toLowerCase());h.removeClass("ui-selecting")}).bind("selectableselected",function(G,H){var F=d(H.selected),h=y.find(".gui-scheduler-"+F.attr("data-day").toLowerCase());h.each(function(){var J=d(this),I=J.hasClass("gui-scheduler-mixed");if(I){J.removeClass("gui-scheduler-mixed").addClass("gui-scheduler-denied")}else{J.toggleClass("gui-scheduler-denied")}J.trigger("slotvalue",{denied:J.hasClass("gui-scheduler-denied")})}).removeClass("ui-selecting")});n.children().mousedown(r).end().selectable().bind("selectableselecting",function(F,G){var H=d(G.selecting),h=y.find(".gui-scheduler-"+H.attr("data-hour"));h.addClass("ui-selecting")}).bind("selectableunselecting",function(F,G){var H=d(G.unselecting),h=y.find(".gui-scheduler-"+H.attr("data-hour"));h.removeClass("ui-selecting")}).bind("selectableselected",function(F,G){var H=d(G.selected),h=y.find(".gui-scheduler-"+H.attr("data-hour"));h.each(function(){var J=d(this),I=J.hasClass("gui-scheduler-mixed");if(I){J.removeClass("gui-scheduler-mixed").addClass("gui-scheduler-denied")}else{J.toggleClass("gui-scheduler-denied")}J.trigger("slotvalue",{denied:J.hasClass("gui-scheduler-denied")})}).removeClass("ui-selecting")});y.find("li").mousedown(r).end().selectable({filter:"li",selected:function(h,F){d("#ApplyButton",o).data("force-enabled",true)}}).bind("selectableselected",function(G,H){var F=d(H.selected),h=F.hasClass("gui-scheduler-mixed");if(b.deviceType===b.GUI_SMARTPHONE_MODE){var I=F.context.classList[2].replace("gui-scheduler-","");I+=F.context.classList[1].replace("gui-scheduler-","")}if(h){F.removeClass("gui-scheduler-mixed").addClass("gui-scheduler-denied");if(b.deviceType===b.GUI_SMARTPHONE_MODE){d("#"+I).removeClass("gui-scheduler-mixed").addClass("gui-scheduler-denied")}}else{F.toggleClass("gui-scheduler-denied");if(b.deviceType===b.GUI_SMARTPHONE_MODE){d("#"+I).toggleClass("gui-scheduler-denied")}}F.trigger("slotvalue",{denied:F.hasClass("gui-scheduler-denied")})});d("#SchedulerAlwaysAllowedBtn",o).click(function(){if(r()){d("li",y).removeClass("gui-scheduler-mixed gui-scheduler-denied").trigger("slotvalue",{denied:false});d("li",k).removeClass("gui-scheduler-mixed gui-scheduler-denied").trigger("slotvalue",{denied:false})}});d("#SchedulerAlwayDeniedBtn",o).click(function(){if(r()){d("li",y).removeClass("gui-scheduler-mixed").addClass("gui-scheduler-denied").trigger("slotvalue",{denied:true});d("li",k).removeClass("gui-scheduler-mixed").addClass("gui-scheduler-denied").trigger("slotvalue",{denied:true})}});f.change(function(){var H=[];s=[];f.children("option:selected").each(function(){H.push(d(this).val())});if(H.length){var h=d(),G=[];y.find(".ui-selecting").removeClass("ui-selecting");t.val("").change();d.each(H,function(J,I){var K=y.find(".gui-scheduler-"+I.toLowerCase());h=h.add(K);K.addClass("ui-selecting");s.push(K)});for(x=0;x<24;x++){var F=h.filter(".gui-scheduler-"+x+"h");if(F.filter(".gui-scheduler-denied").length!==F.length){G.push(""+x)}}t.val(G).change();d(".gui-scheduler-hourselect",o).enable()}else{d(".gui-scheduler-hourselect",o).disable();t.val("").change()}});d("#SchedulerSelectDaysBtn",o).click(function(){var h=[];f.children("option").not(":first").each(function(){h.push(d(this).val())});f.val(h).change()});d("#SchedulerUnselectDaysBtn",o).click(function(){f.val("").change()});for(x=0;x<24;x++){t.append('<option value="'+x+'" >'+x+"h</option>")}t.change(function(){if(s.length){var h=[];t.children("option:selected").each(function(){h.push(d(this).val())});d.each(s,function(F,G){G.removeClass("gui-scheduler-mixed").addClass("gui-scheduler-denied");d.each(h,function(I,H){G.filter(".gui-scheduler-"+H+"h").removeClass("gui-scheduler-denied")})})}});d("#SchedulerSelectHoursBtn",o).click(function(){var h=[];t.children("option").not(":first").each(function(){h.push(d(this).val())});t.val(h).change()});d("#SchedulerUnselectHoursBtn",o).click(function(){t.val("").change()});g.bind("selectpostactions",function(G,H){var F=H.request,h;d.each(m,function(I,J){h=false;d.each(J.scheduler,function(M,L){var K=false,O;d.each(L.hours,function(Q,P){K=K||P});d.each(J.BlacklistedSchedule,function(Q,P){if(P.DayIndex===M){O=P}});if(K){if(O){d.each(a,function(Q,P){if(L.hours[P]!==O["Hours"+P]){F.setValue("Device/Hosts/Hosts/Host[@uid='"+J.uid+"']/BlacklistedSchedule/ManagementDay[@DayIndex='"+M+"']/Hours"+P,L.hours[P])}})}else{var N={DayIndex:M};d.each(a,function(Q,P){N["Hours"+P]=L.hours[P]});F.addChild("Device/Hosts/Hosts/Host[@uid='"+J.uid+"']/BlacklistedSchedule",{ManagementDay:N})}}else{if(O){F.deleteElement("Device/Hosts/Hosts/Host[@uid='"+J.uid+"']/BlacklistedSchedule/ManagementDay[@DayIndex='"+M+"']")}}});if(h!==(J.BlacklistedSchedule.length!==0)){F.setValue("Device/Hosts/Hosts/Host[@uid='"+J.uid+"']/Blacklisted",h)}})})}).delegate("#ParentalControlPage","pageinit",function(){var l=d(this),g=d.QueryString(l.data("url")),j=d("#WebSiteList",l),f=d("#WebSiteAddBtn",l),n=d("#WebSiteAddAddressBtn",l),k=d("#WebSiteHostsSelect",l),h=1;d(".gui-scheduler-dayselect, .gui-scheduler-hourselect",l).disable();j.bind("arraybeforeinsert",function(p,q){q.value.Enable=q.value.Enable||false;q.value.WebPage=q.value.WebPage||""});if(false){j.bind("arraybeforeinsert",function(p,q){var r=d("#WebSiteTmpl",l).tmpl({uid:q.value.uid,site:q.value.Host,page:"web-site.html?index="+h});j.append(r).listview().listview("refresh");h++})}else{d("#gui-scheduler-desktop").show();d("#gui-scheduler-mobile").hide();var m=d('<table id="WebSiteTable" >'),o,e;j.bind("arraybeforeinsert",function(s,t){var w="site"+h,v,p,u;v=d.extend({},t.value);v.Enable=v.Enable?"true":"false";v.Hosts=[];v.NetworkObjects=[];var r=false;for(u=0;u<h;u++){var q=m.jqGrid("getRowData","site"+u);if(q.WebPage===v.WebPage){r=true;break}}if(r!=true){m.jqGrid("addRowData",w,v);p=m.find("#"+w).object({connected:false,objset:null}).bind("objectgetvalue",function(x,y){var z=m.jqGrid("getRowData",w);y.value.Enable=(z.Enable==="true");y.value.WebPage=z.WebPage});t.item=p.data("xmo-item");delete t.value.NetworkObjects;delete t.value.Services;delete t.value.ManagerSchedules;t.item.current(t.value,t.capability,t.xpath);p.find(".gui-table-delete-row").click(function(x){m.jqGrid("delRowData",w)});e=w;h++}}).bind("arraybeforesubmit",function(p,r){var q=m.data("editedrow");if(q){m.jqGrid("saveRow",q);m.removeData("editedrow")}}).after(m).hide();o={datatype:"local",height:200,colNames:[b.i18n.msg("HOME_ENABLE"),b.i18n.msg("PARENTAL_WEB_SITE_ADDR"),b.i18n.msg("PARENTAL_DELETE")],colModel:[{name:"Enable",index:"Enable",width:60,sortable:false,resizable:false,editable:true,edittype:"checkbox",editoptions:{value:"true:false"},formatter:function(p,q,r){return p==="true"?b.i18n.msg("HOME_YES"):b.i18n.msg("HOME_NO")},unformat:function(q,r,p){return q===b.i18n.msg("HOME_YES")?"true":"false"},cellattr:function(r,t,q,p,s){return' data-label="'+b.i18n.msg("HOME_ENABLE")+'"'}},{name:"WebPage",index:"WebPage",width:250,sortable:false,resizable:false,editable:false,formatter:function(p,q,r){return p},unformat:function(q,r,p){return q},cellattr:function(r,t,q,p,s){return' data-label="'+b.i18n.msg("PARENTAL_WEB_SITE_ADDR")+'"'}},{name:"Delete",index:"Delete",width:70,sortable:false,resizable:false,classes:"gui-table-delete-row",cellattr:function(r,t,q,p,s){return' data-label="'+b.i18n.msg("PARENTAL_DELETE")+'"'}}],forceFit:true,editurl:"clientArray",onSelectRow:function(s){var p=d(this),q={keys:true,aftersavefunc:function(t){p.jqGrid("resetSelection");p.removeData("editedrow")}},r=p.data("editedrow");if(s&&s!==r){if(r!==undefined){p.jqGrid("saveRow",r)}p.jqGrid("editRow",s,q);p.data("editedrow",s);p.find("select").selectmenu({nativeMenu:false,mini:true,inline:true})}}};o.caption=j.children("li:first").text();m.jqGrid(o).parents("div.ui-jqgrid").addClass("gui-table");n.click(function(s){var p=d("#WebSiteAddInput",l),u,r=true,t=[],q=false;s.preventDefault();s.stopImmediatePropagation();u=p.val().split(/\n|,|;|\s+/);d.each(u,function(w,A){A=d.trim(A).toLowerCase();var z=/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi;var y=/((^\s*((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*$)|(^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$))/;var x=new RegExp(z);var v=new RegExp(y);if(!A.match(x)&&!A.match(v)){q=true}if(d.inArray(A,t)==-1&&A!=""){t.push(A)}});if(!q){p.val("");d("#WiFiWebSiteInputWarning",l).hide();d.each(t,function(w,y){if(y.length&&y!=""){var x,v;v=y.match(/https?:\/\/([^:\/]+)(:|\/|$)/);if(v){y=v[1]}x={Enable:true,RuleType:"WEBRESTRICTION",WebPage:y};j.array("insert",-1,x,new b.api.Capability({name:"WebAccess"}));r=false}});d("#WebSiteAddPopup",l).popup("close")}else{d("#WiFiWebSiteInputWarning",l).show()}})}k.select("option","sessionOptions",{depth:-1}).bind("selectbeforeoption",function(p,r){var q=r.value;r.value=q.uid;if(q.UserFriendlyName){r.text=q.UserFriendlyName}else{if(q.UserHostName){r.text=q.UserHostName}else{if(q.HostName){r.text=q.HostName}else{if(q.IPAddress){r.text=q.IPAddress}else{r.text=q.PhysAddress}}}}}).change(function(){});if(b.deviceType===b.GUI_SMARTPHONE_MODE){d("#gui-scheduler-desktop").hide();d("#gui-scheduler-mobile").show();d("#gui-scheduler-monday").hide();d(".gui-scheduler-monday").click(function(){d("#gui-scheduler-mobile").hide();d("#gui-scheduler-monday").show()});d(".gui-scheduler-tuesday").click(function(){d("#gui-scheduler-mobile").hide();d("#gui-scheduler-tuesday").show()});d(".gui-scheduler-wednesday").click(function(){d("#gui-scheduler-mobile").hide();d("#gui-scheduler-wednesday").show()});d(".gui-scheduler-thursday").click(function(){d("#gui-scheduler-mobile").hide();d("#gui-scheduler-thursday").show()});d(".gui-scheduler-friday").click(function(){d("#gui-scheduler-mobile").hide();d("#gui-scheduler-friday").show()});d(".gui-scheduler-saturday").click(function(){d("#gui-scheduler-mobile").hide();d("#gui-scheduler-saturday").show()});d(".gui-scheduler-sunday").click(function(){d("#gui-scheduler-mobile").hide();d("#gui-scheduler-sunday").show()});d(".ApplyScheduleDiv").click(function(){d("#gui-scheduler-monday").hide();d("#gui-scheduler-tuesday").hide();d("#gui-scheduler-wednesday").hide();d("#gui-scheduler-thursday").hide();d("#gui-scheduler-friday").hide();d("#gui-scheduler-saturday").hide();d("#gui-scheduler-sunday").hide();d("#gui-scheduler-mobile").show()})}else{d("#gui-scheduler-desktop").show()}}).delegate("#ParentalControlPage","pagebeforeshow",function(){var e=d(this);if(b.deviceType===b.GUI_DESKTOP_MODE){d("#gui-scheduler-desktop.gui-scheduler").show();d("#gui-scheduler-mobile").hide()}else{d("#gui-scheduler-mobile").show();d("#gui-scheduler-desktop.gui-scheduler").hide()}})});jQuery(function(b){var a=b.gui;b(document).delegate("#UserPage","pagecreate",function(){var d=b(this);var c=function(f){var h=b("#NewPasswdInput",f).val(),e=b("#ConfirmPasswdInput",f).val(),g=b("#PasswdInput",f).val();b(".gui-info #LoginWarning",f).remove();if(h.length<8){b(".gui-info",f).append('<p id="LoginWarning" class="gui-status-warning text-danger"><br/>'+a.i18n.msg("USER_SECU_LOW")+"</p>");b("#ApplyButton",f).data("disabled",true)}else{if(h!==e){b(".gui-info",f).append('<p id="LoginWarning" class="gui-status-warning text-danger"><br/>'+a.i18n.msg("USER_PASS_DIFFERENT")+"</p>");b("#ApplyButton",f).data("disabled",true)}else{if(h.length>64){b(".gui-info",f).append('<p id="LoginWarning" class="gui-status-warning text-danger"><br/>'+a.i18n.msg("USER_MAX_LEN")+"</p>");b("#ApplyButton",f).data("disabled",true)}else{b("#ApplyButton",f).data("disabled",false)}}}};b("#NewPasswdInput",d).keyup(function(e,f){c(d)});b("#ConfirmPasswdInput",d).keyup(function(e,f){c(d)});b("#ApplyButton",d).on("userpagetrigger",function(f){var e=a.client.newRequest();prefix="/"+a.opt.GUI_VERSION_OPT+"/gui/tpl/src/",home="home/home.html";e.remoteCall("Device/UserAccounts/Users/User[@uid='1']","changeClearPassword",{OldPassword:b("#PasswdInput",d).val(),NewPassword:b("#NewPasswdInput",d).val()},undefined,function(){a.alert(a.i18n.msg("USER_SUCESS"),{callbackClose:function(){b.mobile.changePage(prefix+home,{reverse:true})}})},function(){a.alert(a.i18n.msg("USER_FAIL"))});e.send();return true})})});jQuery(function(b){var a=b.gui;b(document).delegate("#RemoteAccessPage","pagebeforecreate",function(){var e=b(this),d=a.client.user,c=b("#HTTPSRemoteAccess",e);if(d.toLowerCase()==="expert"||d.toLowerCase()==="admin"){b(":jqmData(xpath)",c).each(function(){var g=b(this),f=g.attr("data-xpath");f=f.replace(/\[Login=\'[^']*\'\]/,"[Login='"+d+"']");g.attr("data-xpath",f)})}}).delegate("#RemoteAccessPage","pageshow",function(){var d=b(this),c=a.client.user,e=a.client.newRequest();b("#ApplyButton",d).on("remoteaccesspagetrigger",function(f){if(c.toLowerCase()==="expert"){e.setValue("Device/UserAccounts/Users/User[Login='Admin']/RemoteAccesses/RemoteAccess[@uid='3']/Enabled",b("#HTTPSRemoteAccessCheck").val());e.setValue("Device/UserAccounts/Users/User[Login='Admin']/RemoteAccesses/RemoteAccess[@uid='3']/Port",b("#HTTPPortInput").val());e.setValue("Device/UserAccounts/Users/User[Login='User']/RemoteAccesses/RemoteAccess[@uid='3']/Enabled",b("#HTTPSRemoteAccessCheck").val());e.setValue("Device/UserAccounts/Users/User[Login='User']/RemoteAccesses/RemoteAccess[@uid='3']/Port",b("#HTTPPortInput").val())}else{if(c.toLowerCase()==="admin"){e.setValue("Device/UserAccounts/Users/User[Login='Expert']/RemoteAccesses/RemoteAccess[@uid='3']/Enabled",b("#HTTPSRemoteAccessCheck").val());e.setValue("Device/UserAccounts/Users/User[Login='Expert']/RemoteAccesses/RemoteAccess[@uid='3']/Port",b("#HTTPPortInput").val());e.setValue("Device/UserAccounts/Users/User[Login='User']/RemoteAccesses/RemoteAccess[@uid='3']/Enabled",b("#HTTPSRemoteAccessCheck").val());e.setValue("Device/UserAccounts/Users/User[Login='User']/RemoteAccesses/RemoteAccess[@uid='3']/Port",b("#HTTPPortInput").val())}}e.send()})})});jQuery(function(e){var c=e.gui,j="10.1.1.1",h="10.1.1.2",g="1.1.1.1",k="1.1.1.2",d="192.168.182.0/27";e(document).delegate("#DHCPDNSPage","pagebeforecreate",function(){var l=e(this);if(c.client.user.toLowerCase()==="user"){e("#DHCPIPAddrInput, #DHCPPoolIPStartInput, #DHCPPoolIPEndInput, #DHCPTVPoolIPStartInput, #DHCPTVPoolIPEndInput",l).attr({size:"2",maxlength:"3"}).css({"text-align":"center",width:"3em"})}else{e("#DHCPIPAddrBefore, #DHCPIPAddrAfter, .gui-dhcp-pool-before",l).hide()}}).delegate("#DHCPDNSPage","pageinit",function(){var A=e(this),F=e("#DHCPIPAddrInput",A),n=e("#DHCPSubnetMaskInput",A),v=e("#DHCPIPAddrBefore",A),z=e("#DHCPIPAddrAfter",A),C=e(".gui-dhcp-ip-addr",A),q=e(".gui-dhcp-pool-range",A),J=e("#DHCPPoolIPStartInput",A),o=e("#DHCPPoolIPEndInput",A),E=e("#DHCPTVPoolIPStartInput",A),p=e("#DHCPTVPoolIPEndInput",A),K=e(".gui-dhcp-pool-before",A),u=e("#DHCPRestoreBtn",A),t=e("#DHCPStaticAddrList",A),D=e("#DHCPStaticAddrAdd",A),w=e("#IPv4LeaseTime",A),L=e("#UserState",A),B,s,y=1,H=false,I=[],G=false;var m=c.client.newRequest();m.getValue("Device/Hosts/Hosts",function(O){var M=0;for(var N=0;N<O.length;N++){if(O[N].InterfaceType=="Ethernet"||O[N].InterfaceType=="WiFi"){I[M]=O[N];M++}}});m.getValue("Device/WiFi/Quantenna",function(M){g=M.BootIPLocal;k=M.BootIPRemote;j=M.MngtIPLocal;h=M.MngtIPRemote});m.send();L.hide();if(c.client.user.toLowerCase()=="admin"){L.text("sA")}else{L.text("u")}e(".gui-advanced-btnDHCP",A).click(function(){console.warn("isAdvancedDhcp");console.warn(G);if(G===true){G=false}else{G=true}console.log("isAdvancedDhcp");console.log(G);$btn=e(this);$btn.toggleClass("ui-icon-top").parent().find(".gui-advanced-info").slideToggle("slow");if($btn.text()==c.i18n.msg("HOME_ADVANCED")){$btn.text(c.i18n.msg("HOME_HIDE_ADVANCED"))}else{$btn.text(c.i18n.msg("HOME_ADVANCED"))}L.text("sA");if(c.client.user.toLowerCase()=="user"){if(G){L.text("sA");e("#DHCPIPAddrInput, #DHCPPoolIPStartInput, #DHCPPoolIPEndInput, #DHCPTVPoolIPStartInput, #DHCPTVPoolIPEndInput",A).attr({size:"20",maxlength:"15"}).css({"text-align":"left",width:"240px"});e("#DHCPIPAddrBefore, #DHCPIPAddrAfter, .gui-dhcp-pool-before",A).hide()}else{L.text("u");e("#DHCPIPAddrInput, #DHCPPoolIPStartInput, #DHCPPoolIPEndInput, #DHCPTVPoolIPStartInput, #DHCPTVPoolIPEndInput",A).attr({size:"2",maxlength:"3"}).css({"text-align":"center",width:"3em"});e("#DHCPIPAddrBefore, #DHCPIPAddrAfter, .gui-dhcp-pool-before",A).show()}oldThridIP=F.val();oldBeforeRange=K.eq(0).text();console.log("oldThridIP");console.log(oldThridIP);console.log("oldBeforeRange");console.log(oldBeforeRange);if(oldThridIP.length<=3){F.val(v.text()+oldThridIP+z.text());F.item("current",F.val())}else{F.val(oldThridIP.split(".")[2]);F.item("current",oldThridIP.split(".")[2])}n.enable();w.enable();F.unbind("inputbeforeloaded");if(G){F.unbind("inputbeforesubmit")}else{F.bind("inputbeforesubmit",function(N,O){O.value=v.text()+O.value+z.text()})}F.unbind("keyup");u.unbind("click");F.bind("inputbeforeloaded",function(N,O){C.item("current",O.value);l=O.value}).keyup(function(){if(!G){var O=F.val(),V=F.item("modified"),W=v.text()+O+z.text();C.item("value",W);K.text(v.text()+O+".");n.val("255.255.255.0").change();poolstartBytes=J.val().split(".");lastPoolStart="2";if(poolstartBytes.length==4){lastPoolStart=poolstartBytes[3]}J.val(K.eq(0).text()+lastPoolStart).change();poolendBytes=o.val().split(".");lastPoolEnd="63";if(poolendBytes.length==4){lastPoolEnd=poolendBytes[3]}o.val(K.eq(0).text()+lastPoolEnd).change();tvpoolstartBytes=E.val().split(".");lastTVPoolStart="64";if(tvpoolstartBytes.length==4){lastTVPoolStart=tvpoolstartBytes[3]}E.val(K.eq(0).text()+lastTVPoolStart).change();tvpoolendBytes=p.val().split(".");lastTVPoolEnd="127";if(tvpoolendBytes.length==4){lastTVPoolEnd=tvpoolendBytes[3]}p.val(K.eq(0).text()+lastTVPoolEnd).change();q.item("modified",V?true:null)}else{var O=e(this).val();C.item("value",O);var P=O.split(".");var R=n.val().split(".");bytesPoolstart=J.val().split(".");bytesPoolend=o.val().split(".");bytesTVPoolstart=E.val().split(".");bytesTVPoolend=p.val().split(".");var Q="",U="",T="",S="";var N="";for(i=0;i<=3;i++){if(parseInt(R[i])==0||i==3){Q+=N+bytesPoolstart[i];U+=N+bytesPoolend[i];T+=N+bytesTVPoolstart[i];S+=N+bytesTVPoolend[i]}else{if(P[i]==undefined){valBytes=N+""}else{valBytes=N+P[i]}Q+=valBytes;U+=valBytes;T+=valBytes;S+=valBytes}N="."}J.val(Q);o.val(U);E.val(T);p.val(S);if(F.val()!=F.item("current")){$applybutton=e("#ApplyButton",A);$applybutton.removeData("disabled");$applybutton.enable()}}});u.click(function(){e("<div>").simpledialog2({mode:"button",buttonPrompt:"<br/>"+c.i18n.msg("DHCP_DELETE_STATICS")+"<br/><br/><br/>",themeDialog:"d",buttons:{OK:{text:c.i18n.msg("HOME_OK"),click:function(){if(s.jqGrid("getGridParam","").data){for(var N=0;N<s.jqGrid("getGridParam","").data.length;N++){s.jqGrid("delRowData",s.jqGrid("getGridParam","").data[N].id)}}H=true;s.remove();F.val("192.168.1.1").change();n.val("255.255.255.0").change();J.val("192.168.1.2").change();o.val("192.168.1.63").change();E.val("192.168.1.64").change();p.val("192.168.1.127").change();w.val("3600");C.item("value",F.val());e("#ApplyButton",A).removeData("disabled");e("#ApplyButton",A).enable()},theme:"b"},Cancel:{text:c.i18n.msg("HOME_CANCEL"),click:function(){},icon:"delete",theme:"d"}}})})}var M=c.client.newRequest();M.getValue("Device/Services/BGCTV/Mode",function(O,N){if(O=="BRIDGED"){e("#tvpoolstart").hide();e("#tvpoolend").hide()}});M.send();return false});var l;if(c.client.user.toLowerCase()==="user"&&L.text()=="u"){n.disable();w.disable();F.bind("inputbeforeloaded",function(N,O){var M=O.value.split(".");C.item("current",O.value);l=M;v.text(M[0]+"."+M[1]+".");z.text("."+M[3]);O.value=M[2]}).bind("inputbeforesubmit",function(M,N){N.value=v.text()+N.value+z.text()}).keyup(function(O){var P=F.val(),M=v.text()+P+z.text(),N=F.item("modified");C.item("value",M);K.text(v.text()+P+".");n.val("255.255.255.0").change();poolstartBytes=J.val().split(".");lastPoolStart="2";if(poolstartBytes.length==4){lastPoolStart=poolstartBytes[3]}J.val(K.eq(0).text()+lastPoolStart).change();poolendBytes=o.val().split(".");lastPoolEnd="63";if(poolendBytes.length==4){lastPoolEnd=poolendBytes[3]}o.val(K.eq(0).text()+lastPoolEnd).change();tvpoolstartBytes=E.val().split(".");lastTVPoolStart="64";if(tvpoolstartBytes.length==4){lastTVPoolStart=tvpoolstartBytes[3]}E.val(K.eq(0).text()+lastTVPoolStart).change();tvpoolendBytes=p.val().split(".");lastTVPoolEnd="127";if(tvpoolendBytes.length==4){lastTVPoolEnd=tvpoolendBytes[3]}p.val(K.eq(0).text()+lastTVPoolEnd).change();q.item("modified",N?true:null)});u.click(function(){e("<div>").simpledialog2({mode:"button",buttonPrompt:"<br/>"+c.i18n.msg("DHCP_DELETE_STATICS")+"<br/><br/><br/>",themeDialog:"d",buttons:{OK:{text:c.i18n.msg("HOME_OK"),click:function(){if(s.jqGrid("getGridParam","").data){for(var M=0;M<s.jqGrid("getGridParam","").data.length;M++){s.jqGrid("delRowData",s.jqGrid("getGridParam","").data[M].id)}}H=true;s.remove();F.val("192.168.1.1").change();n.val("255.255.255.0").change();J.val("192.168.1.2").change();o.val("192.168.1.63").change();E.val("192.168.1.64").change();p.val("192.168.1.127").change();w.val("3600");C.item("value",F.val());e("#ApplyButton",A).removeData("disabled");e("#ApplyButton",A).enable()},theme:"b"},Cancel:{text:c.i18n.msg("HOME_CANCEL"),click:function(){},icon:"delete",theme:"d"}}})})}else{F.bind("inputbeforeloaded",function(M,N){C.item("current",N.value);l=N.value}).keyup(function(){var S=e(this).val();C.item("value",S);var R=S.split(".");var T=n.val().split(".");bytesPoolstart=J.val().split(".");bytesPoolend=o.val().split(".");bytesTVPoolstart=E.val().split(".");bytesTVPoolend=p.val().split(".");var Q="",P="",O="",M="";var N="";for(i=0;i<=3;i++){if(parseInt(T[i])==0||i==3){Q+=N+bytesPoolstart[i];P+=N+bytesPoolend[i];O+=N+bytesTVPoolstart[i];M+=N+bytesTVPoolend[i]}else{if(R[i]==undefined){valBytes=N+""}else{valBytes=N+R[i]}Q+=valBytes;P+=valBytes;O+=valBytes;M+=valBytes}N="."}J.val(Q);o.val(P);E.val(O);p.val(M)});u.click(function(){e("<div>").simpledialog2({mode:"button",buttonPrompt:"<br/>"+c.i18n.msg("DHCP_DELETE_STATICS")+"<br/><br/><br/>",themeDialog:"d",buttons:{OK:{text:c.i18n.msg("HOME_OK"),click:function(){if(s.jqGrid("getGridParam","").data){for(var M=0;M<s.jqGrid("getGridParam","").data.length;M++){s.jqGrid("delRowData",s.jqGrid("getGridParam","").data[M].id)}}H=true;s.remove();F.val("192.168.1.1").change();n.val("255.255.255.0").change();J.val("192.168.1.2").change();o.val("192.168.1.63").change();E.val("192.168.1.64").change();p.val("192.168.1.127").change();w.val("3600");C.item("value",F.val());e("#ApplyButton",A).removeData("disabled");e("#ApplyButton",A).enable()},theme:"b"},Cancel:{text:c.i18n.msg("HOME_CANCEL"),click:function(){},icon:"delete",theme:"d"}}})})}t.bind("arraybeforeinsert",function(M,N){N.value.Enable=N.value.Enable||false;N.value.Chaddr=N.value.Chaddr||"";N.value.Yiaddr=N.value.Yiaddr||""});if(c.displayMode===c.GUI_SMARTPHONE_MODE){t.bind("arraybeforeinsert",function(N,O){var M=e("#DHCPStaticAddrTmpl",A).tmpl({uid:O.value.uid,macaddr:O.value.Chaddr,ipaddr:O.value.Yiaddr,page:"static-addr.html?index="+y++});t.append(M).listview("refresh")})}else{var r,x;s=e('<table id="'+t[0].id.replace(/List$/,"Table")+'" >');t.bind("arraybeforeinsert",function(N,O){var Q="addr"+y++,P,M;P=e.extend({},O.value);P.Enable=P.Enable?true:false;s.jqGrid("addRowData",Q,P);M=s.find("#"+Q).object({connected:false,objset:null}).bind("objectgetvalue",function(R,S){var T=e.extend(S.value,s.jqGrid("getRowData",Q));T.Enable=(T.Enable==true)});O.item=M.data("xmo-item");O.item.current(O.value,O.capability,O.xpath);M.find(".gui-table-delete-row").click(function(R){s.jqGrid("delRowData",Q)});x=Q}).bind("arraybeforesubmit",function(M,O){var N=s.data("editedrow");if(N){s.jqGrid("saveRow",N);s.removeData("editedrow")}}).after(s).removeClass("gui-advanced-info").hide();r={datatype:"local",height:200,colNames:[c.i18n.msg("DHCP_HOSTNAME"),c.i18n.msg("HOME_MAC_ADDR"),c.i18n.msg("INTERNET_IPV4_ADDR"),c.i18n.msg("DHCP_DELETE")],colModel:[{name:"Hostname",index:"Hostname",width:200,sortable:false,resizable:false,editable:true,edittype:"select",formatter:"select",editoptions:{value:function(){var N="Device:"+c.i18n.msg("DHCP_NEW_DEVICE");for(var M=0;M<I.length;M++){if(I[M].HostName!=""){N+=";"+I[M].PhysAddress.replace(/:/g,".")+":"+I[M].HostName}else{if(I[M].UserFriendlyName!=""){N+=";"+I[M].PhysAddress.replace(/:/g,".")+":"+I[M].UserFriendlyName}else{N+=";"+I[M].PhysAddress.replace(/:/g,".")+":device"}}}return N},dataEvents:[{type:"change",fn:function(N){var M=this.id.replace("Hostname","Chaddr");if(this.value!="Device"){e("#"+M).val(this.value.replace(/\./g,":").toUpperCase());e("#"+M).prop("disabled",true)}else{e("#"+M).val("");e("#"+M).prop("disabled",false)}}}]},formatter:function(M,N,P){for(var O=0;O<I.length;O++){if(P.Chaddr==I[O].PhysAddress.toUpperCase()){if(I[O].HostName!=""){return I[O].HostName}else{if(I[O].UserFriendlyName!=""){return I[O].UserFriendlyName}else{return"Device"}}}}return"Device"},unformat:function(N,O,M){},cellattr:function(O,Q,N,M,P){return' data-label="'+c.i18n.msg("DHCP_HOSTNAME")+'"'}},{name:"Chaddr",index:"Chaddr",width:200,sortable:false,resizable:false,editable:true,formatter:function(M,N,O){if(M!=""){M=M.replace(/-/g,":");if(!M.match(/^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$/i)){e("#ApplyButton",A).addClass("ui-disabled")}else{e("#ApplyButton",A).removeClass("ui-disabled")}}else{e("#ApplyButton",A).addClass("ui-disabled")}return M.toUpperCase()},unformat:function(N,O,M){return N},cellattr:function(O,Q,N,M,P){return' data-label="'+c.i18n.msg("HOME_MAC_ADDR")+'"'}},{name:"Yiaddr",index:"Yiaddr",width:140,sortable:false,resizable:false,editable:true,formatter:function(M,N,O){if(M!=""){if(!M.match(/^([0-255].){3}[0-255]$/)){e("#ApplyButton",A).addClass("ui-disabled")}else{e("#ApplyButton",A).removeClass("ui-disabled")}}else{e("#ApplyButton",A).addClass("ui-disabled")}return M},unformat:function(N,O,M){return N},cellattr:function(O,Q,N,M,P){return' data-label="'+c.i18n.msg("INTERNET_IPV4_ADDR")+'"'}},{name:"Delete",index:"Delete",width:80,sortable:false,resizable:false,classes:"gui-table-delete-row",cellattr:function(O,Q,N,M,P){return' data-label="'+c.i18n.msg("DHCP_DELETE")+'"'}}],scrollOffset:0,forceFit:true,editurl:"clientArray",onSelectRow:function(R){var M=e(this),N,Q,O={keys:true,aftersavefunc:function(S){f(M,S,J,o,E,p,v,F,z,0,n,K.eq(0),L.text(),w.val());M.jqGrid("resetSelection");M.removeData("editedrow");M.change()}},P=M.data("editedrow");if(R&&R!==P){if(P!==undefined){M.jqGrid("saveRow",P)}M.jqGrid("editRow",R,O);M.data("editedrow",R);N=e("#"+R+"_Chaddr",this);Q=e("#"+R+"_Yiaddr",this);N.addClass("gui-selected-input")}}};r.caption=t.children("li:first").text();s.jqGrid(r).parents("div.ui-jqgrid").addClass("gui-table gui-advanced-info").hide();D.click(function(N){N.preventDefault();N.stopImmediatePropagation();var O={Enable:true,Chaddr:"",Yiaddr:""};t.array("insert",-1,O,new c.api.Capability({name:"StaticAddress"}));s.jqGrid("setSelection",x);var M=e(this);e("#ApplyButton",M).addClass("ui-disabled")})}e("#ApplyButton",A).on("dhcpagetrigger",function(M){A.context.gatewayIpModified=e("#DHCPIPAddrInput",A).item("modified");var N=s.data("editedrow");if(H==false){if(N!=undefined){return f(s,N,J,o,E,p,v,F,z,1,n,K.eq(0),L.text(),w.val())}else{return f(s,-1,J,o,E,p,v,F,z,1,n,K.eq(0),L.text(),w.val())}}})});function b(l){var m=new Array("0","128","192","224","240","248","252","254","255");isValid=false;e.each(m,function(n){if(m[n]==l){isValid=true}});if(isValid){return true}else{return false}}function a(l){bytes=l.split(".");e.each(bytes,function(m){while(bytes[m].length<3){bytes[m]="0"+bytes[m]}});return bytes.join()}function f(l,x,E,o,w,p,D,A,G,C,m,H,J,q){var t=new String("");gtwip="";if(c.client.user.toLowerCase()=="user"&&J=="u"){gtwip=D.text()+A.val()+G.text();while(gtwip.indexOf(",")!=-1){gtwip=gtwip.replace(",",".")}}else{gtwip=A.val()}if(q.match("^0")||!q.match("^[0-9]{1,5}$")||parseInt(q)<1800||parseInt(q)>86400){t+=c.i18n.msg("DHCP_ERROR_LEASE_TIME_VALUE")+"\n"}$netmaskVal=m.val();$netmaskBytes=$netmaskVal.split(".");var s=(IPnumber(gtwip)&IPnumber($netmaskVal));if($netmaskBytes.length!=4){t+=c.i18n.msg("DHCP_ERROR_SUBNET_MASK_FORMAT")+"\n"}else{if($netmaskVal=="255.255.255.255"||$netmaskVal=="255.255.255.254"){t+=c.i18n.msg("DHCP_ERROR_SUBNET_MASK_FORMAT")+"\n"}else{if(!gtwip.match("^(([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])$")||gtwip=="0.0.0.0"){t+=c.i18n.msg("DHCP_ERROR_GTW_IP_INCORRECT")+"\n"}else{if(!(IPnumber(gtwip)>IPnumber("10.0.0.0")&&IPnumber(gtwip)<=IPnumber("10.255.255.254"))&&!(IPnumber(gtwip)>IPnumber("172.16.0.0")&&IPnumber(gtwip)<=IPnumber("172.31.255.254"))&&!(IPnumber(gtwip)>IPnumber("192.168.0.0")&&IPnumber(gtwip)<=IPnumber("192.168.255.254"))){t+=c.i18n.msg("DHCP_ERROR_GTW_IP_INCORRECT")+"\n"}else{errorMask=false;if($netmaskBytes[0]<128){errorMask=true}if($netmaskBytes[0]==255){if($netmaskBytes[1]==255){if($netmaskBytes[2]==255){errorMask=!b($netmaskBytes[3])}else{if(!b($netmaskBytes[2])||$netmaskBytes[3]!=0){errorMask=true}}}else{if(!b($netmaskBytes[1])||$netmaskBytes[2]!=0||$netmaskBytes[3]!=0){errorMask=true}}}else{if(!b($netmaskBytes[0])||$netmaskBytes[1]!=0||$netmaskBytes[2]!=0||$netmaskBytes[3]!=0){errorMask=true}}if(errorMask){t+=c.i18n.msg("DHCP_ERROR_SUBMASK_INVALID")+"\n"}var n,r,v,I;n=E.val();r=o.val();v=w.val();I=p.val();if(s!=(IPnumber(n)&IPnumber($netmaskVal))){t+=c.i18n.msg("DHCP_ERROR_POOL_START_BAD_NETWORK")+"\n"}else{if(s!=(IPnumber(r)&IPnumber($netmaskVal))){t+=c.i18n.msg("DHCP_ERROR_POOL_END_BAD_NETWORK")+"\n"}else{if(s!=(IPnumber(v)&IPnumber($netmaskVal))){t+=c.i18n.msg("DHCP_ERROR_TV_POOL_START_BAD_NETWORK")+"\n"}else{if(s!=(IPnumber(I)&IPnumber($netmaskVal))){t+=c.i18n.msg("DHCP_ERROR_TV_POOL_END_BAD_NETWORK")+"\n"}else{if(s==(IPnumber(k)&IPnumber($netmaskVal))){t+=c.i18n.msg("DHCP_ERROR_RESERVED_NETWORK")+"\n"}else{if(s==(IPnumber(h)&IPnumber($netmaskVal))){t+=c.i18n.msg("DHCP_ERROR_RESERVED_NETWORK")+"\n"}else{if(d.indexOf("/")!=-1&&s==(IPnumber(d.substr(0,d.indexOf("/")))&IPnumber("255.255.255.0"))){t+=c.i18n.msg("DHCP_ERROR_RESERVED_NETWORK")+"\n"}}}}}}}var u=new Array();convertTmp=parseInt(convertMaskToDec($netmaskBytes[0]))+parseInt(convertMaskToDec($netmaskBytes[1]))+parseInt(convertMaskToDec($netmaskBytes[2]))+parseInt(convertMaskToDec($netmaskBytes[3]));ipBroadCast=Math.pow(2,(32-convertTmp))-1;u.push(ipBroadCast);firstUsable=getFirstUsableAddr(gtwip.split("."),$netmaskBytes,(32-convertTmp));lastUsable=getLastUsableAddr(gtwip.split("."),$netmaskBytes,(32-convertTmp),ipBroadCast);bytesPoolstart=n.split(".");bytesPoolend=r.split(".");bytesTVPoolstart=v.split(".");bytesTVPoolend=I.split(".");if(!(IPnumber(n)<IPnumber(r))){t+=c.i18n.msg("DHCP_ERROR1_POOL")+"\n"}else{if(!(IPnumber(r)<IPnumber(v))){t+=c.i18n.msg("DHCP_ERROR2_POOL")+"\n"}else{if(!(IPnumber(v)<IPnumber(I))){t+=c.i18n.msg("DHCP_ERROR1_TV")+"\n"}else{if(!(IPnumber(firstUsable.join())<=IPnumber(n)&&IPnumber(I)<=IPnumber(lastUsable.join())&&IPnumber(firstUsable.join())<=IPnumber(gtwip)&&IPnumber(gtwip)<=IPnumber(lastUsable.join()))){t+=c.i18n.msg("DHCP_RANGE_MISCONF")+"\n"}else{if(gtwip==n||gtwip==r||gtwip==v||gtwip==I){t+=c.i18n.msg("DHCP_ERROR_GTW_USE")+"\n"}invalidLastPoolByteState=false;e.each(u,function(L){if(bytesPoolstart[3]==u[L]||bytesPoolend[3]==u[L]||bytesTVPoolstart[3]==u[L]||bytesTVPoolend[3]==u[L]){invalidLastPoolByteState=true}});if(invalidLastPoolByteState){t+=c.i18n.msg("DHCP_ERROR_POOL_ZERO_BROADCAST")+"\n"}}}}}}}}}if(x==-1&&l[0].p.data.length){x=l[0].p.data[0].id}if(x!=-1){l.jqGrid("saveRow",x);var K=l.jqGrid("getRowData",x);var F="",B="";for(var z=0;z<l[0].p.data.length;z++){F="";if(l[0].p.data[z].Chaddr==""||l[0].p.data[z].Yiaddr==""){F+=c.i18n.msg("DHCP_ERROR_EMPTY_RULE")+"\n"}else{if(!l[0].p.data[z].Chaddr.match("^([0-9A-Fa-f]{2}[:]){5}([0-9A-Fa-f]{2})$")){F+=c.i18n.msg("DHCP_ERROR_MAC_INCORRECT")+"\n"}if(!l[0].p.data[z].Yiaddr.match("^(([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{0,2}|2[0-4][0-9]|25[0-5])$")){F+=c.i18n.msg("DHCP_ERROR_IP_INCORRECT")+"\n"}else{if(l[0].p.data[z].Yiaddr.match("^"+gtwip+"$")){F+=c.i18n.msg("DHCP_ERROR_GTW_USE")+"\n"}else{if((s!=(IPnumber(l[0].p.data[z].Yiaddr)&IPnumber($netmaskVal)))){F+=c.i18n.msg("DHCP_ERROR_BAD_NETWORK")+"\n"}else{if(!(IPnumber(E.val())<=IPnumber(l[0].p.data[z].Yiaddr)&&IPnumber(l[0].p.data[z].Yiaddr)<=IPnumber(o.val()))){F+=c.i18n.msg("DHCP_ERROR_BAD_POOL")+"\n"}}}}for(var y=0;y<l[0].p.data.length;y++){if(z!=y){if(l[0].p.data[y].Yiaddr==l[0].p.data[z].Yiaddr){F+=c.i18n.msg("DHCP_ERROR_IP_USE")+"\n"}if(l[0].p.data[y].Chaddr==l[0].p.data[z].Chaddr){F+=c.i18n.msg("DHCP_ERROR_MAC_USE")+"\n"}}}}if(F.length){B+=c.i18n.msg("HOME_ROW")+" "+(z+1)+": "+F+"\n"}}if(B.length){t+="\n"+c.i18n.msg("DHCP_ERROR_STATIC_ADDR")+"\n"+B}}if(t.length>0){c.alert(t);return true}return false}});jQuery(function(b){var a=b.gui;b(document).delegate("#DynDNSPage","pageshow",function(){var d=b(this),c=b("#DynDNSProviderSelect",d);c.bind("selectbeforeoption",function(e,f){var g=f.value;f.value="Device/Services/DynamicDNS/Services/Service[Name='"+g.Name+"']";f.text=g.Name}).bind("selectbeforeloaded",function(e,f){c.item("current",f.value);c.change(function(){var h=c.val();var g=a.client.newRequest();if(h==="Device/Services/DynamicDNS/Services/Service[Name='Custom']"){b(".data-write").show();b(".data-read").hide();b("#DynDNSCutomServer",d).find("input").enable();b("#dynDNSauthentification",d).selectmenu().selectmenu("enable").selectmenu("refresh");g.getValue(h,function(j){b("#serverCustomDNSCustom").val(j.Server);b("#portDynDNSCustom").val(j.ServerPort);b("#requestCustomDNSCustom").val(j.Request);b("#updateIntervalDynDNSCustom").val(j.UpdateInterval);b("#retryIntervalDynDNSCustom").val(j.RetryInterval);b("#maxRetriesDynDNSCustom").val(j.MaxRetries)})}else{b(".data-write").hide();b(".data-read").show();g.getValue(h,function(j){b("#serverCustomDNS",d).val(j.Server);b("#portDynDNS",d).val(j.ServerPort);b("#requestCustomDNS",d).val(j.Request);b("#updateIntervalDynDNS",d).val(j.UpdateInterval);b("#retryIntervalDynDNS",d).val(j.RetryInterval);b("#maxRetriesDynDNS",d).val(j.MaxRetries);if(j.Authentication=="BASIC"){b("select#dynDNSauthentification",d).val("BASIC");b("select#dynDNSauthentification",d).change()}else{b("select#dynDNSauthentification",d).val("NONE");b("select#dynDNSauthentification",d).change()}});g.send();b("#DynDNSCutomServer",d).find("input").disable();b("#dynDNSauthentification",d).selectmenu().selectmenu("disable").selectmenu("refresh")}}).change()})})});jQuery(function(b){var a=b.gui;b(document).delegate("#LANSharing","pagebeforecreate",function(){var c=b(this);var d=a.client.newRequest();currentLogin=a.client.user.charAt(0).toUpperCase()+a.client.user.substr(1);d.getValue("Device/Services/BGCHotspotService/GUI/"+currentLogin+"/ShowHotspotPage",function(f,e){if(""+f=="false"){b("#LANSharing").hide();b.mobile.changePage("infos.html")}});d.getValue("Device/Services/BGCHotspotService/GUI/"+currentLogin+"/ShowHotspotControlButton",function(f,e){if(""+f=="Visible"||""+f=="Grayed_out"){if(""+f=="Grayed_out"){b("#HotspotEnable",c).slider({disabled:true})}b("#FonEnableSlider",c).show();b("#FonEnableTxt",c).hide()}else{b("#FonEnableSlider",c).hide();b("#FonEnableTxt",c).show()}});d.getValue("Device/WiFi/SSIDs/SSID[@uid='3']/SSID",function(e){b("#HotspotSSID3",c).text(a.i18n.msg("FON_SSID_NAME")+" : "+e)});d.getValue("Device/WiFi/SSIDs/SSID[@uid='4']/SSID",function(e){b("#HotspotSSID4",c).text(a.i18n.msg("FON_SSID_NAME")+" : "+e)});d.send({synchronous:true});if(a.client.user.toLowerCase()=="user"){b("#LoggedInGuestsNumberCP",c).remove();b("#LoggedInGuestsNumberEAP",c).remove();b("#LoggedInGuestListCP",c).remove();b("#LoggedInGuestListEAP",c).remove()}else{if(a.client.user.toLowerCase()=="expert"){b("#LoggedInGuestsNumberCP",c).remove();b("#LoggedInGuestsNumberEAP",c).remove()}}}).delegate("#LANSharing","pagecreate",function(){var l=b(this),x=b("#LoggedInGuestListCP",l),t=b("#LoggedInGuestListEAP",l),A=1;var g=[];var r=1;if(a.client.user.toLowerCase()!=="user"){if(a.displayMode===a.GUI_SMARTPHONE_MODE){x.bind("arraybeforeinsert",function(C,D){var n=b("#LoggedInGuestTmpl",l).tmpl({uid:D.value.uid,mac:D.value.Mac});n.guiTranslate();x.append(n).listview("refresh")});t.bind("arraybeforeinsert",function(C,D){var n=b("#LoggedInGuestTmpl",l).tmpl({uid:D.value.uid,mac:D.value.Mac});n.guiTranslate();t.append(n).listview("refresh")})}else{var k=b('<table id="LoggedInGuestTable">'),A=1,B,h;function d(D){var n=b("#"+D,k),C=n.item("value");C=b.extend({},C,k.jqGrid("getRowData",D));n.item("value",C)}var o=b('<table id="LoggedInGuestTableCP">'),f=1,m;function d(D){var n=b("#"+D,o),C=n.item("value");C=b.extend({},C,o.jqGrid("getRowData",D));n.item("value",C)}x.hide().after(o).bind("arraybeforeinsert",function(D,E){var C=a.client.newRequest();E.value.Interface="";if(E.value.MACAddress==undefined||E.value.MACAddress==""){D.preventDefault();return}if(E.value.MACAddress!=undefined&&E.value.MACAddress!=""){E.value.MACAddress=E.value.MACAddress.replace(/-/g,":")}if(true){var F="guest"+f,n;o.jqGrid("addRowData",F,E.value);n=o.find("#"+F).object({connected:false,objset:null});E.item=n.data("xmo-item");E.item.current(E.value,E.capability,E.xpath);m=F;f++}});var c=b('<table id="LoggedInGuestTableEAP">'),w=1,u;function d(D){var n=b("#"+D,c),C=n.item("value");C=b.extend({},C,c.jqGrid("getRowData",D));n.item("value",C)}t.hide().after(c).bind("arraybeforeinsert",function(C,D){D.value.Interface="";if(D.value.MACAddress==undefined||D.value.MACAddress==""){C.preventDefault();return}if(D.value.MACAddress!=undefined&&D.value.MACAddress!=""){D.value.MACAddress=D.value.MACAddress.replace(/-/g,":")}if(D.value.AuthenticationState==true){var E="guest"+w,n;c.jqGrid("addRowData",E,D.value);n=c.find("#"+E).object({connected:false,objset:null});D.item=n.data("xmo-item");D.item.current(D.value,D.capability,D.xpath);u=E;w++}});if(a.client.user.toLowerCase()=="admin"){k.jqGrid({datatype:"local",height:200,colNames:[a.i18n.msg("HOME_MAC_ADDR"),a.i18n.msg("FON_LOGIN"),a.i18n.msg("FON_PRIV_IP"),a.i18n.msg("FON_PUB_IP"),a.i18n.msg("FON_DHCP_LEASE_TIME"),a.i18n.msg("FON_PPPOE_SESS_TIME"),a.i18n.msg("FON_INTERFACE"),a.i18n.msg("FON_INTERFACE")],colModel:[{name:"Mac",index:"Mac",width:120,sortable:false,resizable:false,editable:false,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("HOME_MAC_ADDR")+'"'}},{name:"Login",index:"Login",width:100,sortable:false,resizable:false,editable:false,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("FON_LOGIN")+'"'}},{name:"Ip",index:"Ip",width:100,sortable:false,resizable:false,editable:false,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("FON_PRIV_IP")+'"'}},{name:"LocalIPAddress",index:"LocalIPAddress",width:100,sortable:false,resizable:false,editable:false,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("FON_PUB_IP")+'"'}},{name:"LeaseTimeRemaining",index:"LeaseTimeRemaining",width:180,sortable:false,resizable:false,editable:false,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("FON_DHCP_LEASE_TIME")+'"'}},{name:"LastChange",index:"LastChange",width:120,sortable:false,resizable:false,editable:false,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("FON_PPPOE_SESS_TIME")+'"'}},{name:"Interface",index:"Interface",width:0,sortable:false,resizable:false,editable:false,hidden:true,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("FON_INTERFACE")+'"'}},{name:"Interface2",index:"Interface2",width:0,sortable:false,resizable:false,editable:false,hidden:true,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("FON_INTERFACE")+'"'}}],caption:a.i18n.msg("FON_CONNECTED_DEVICES"),forceFit:true,scrollOffset:0}).parents("div.ui-jqgrid").addClass("gui-table");o.jqGrid({datatype:"local",height:200,colNames:[a.i18n.msg("HOME_MAC_ADDR")],colModel:[{name:"MACAddress",index:"MACAddress",width:220,sortable:false,resizable:false,editable:false,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("HOME_MAC_ADDR")+'"'}},],caption:a.i18n.msg("FON_CONNECTED_DEVICES"),forceFit:true,scrollOffset:0}).parents("div.ui-jqgrid").addClass("gui-table");c.jqGrid({datatype:"local",height:200,colNames:[a.i18n.msg("HOME_MAC_ADDR")],colModel:[{name:"MACAddress",index:"MACAddress",width:220,sortable:false,resizable:false,editable:false,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("HOME_MAC_ADDR")+'"'}}],caption:a.i18n.msg("FON_CONNECTED_DEVICES"),forceFit:true,scrollOffset:0}).parents("div.ui-jqgrid").addClass("gui-table")}else{k.jqGrid({datatype:"local",height:200,colNames:[a.i18n.msg("HOME_MAC_ADDR"),a.i18n.msg("FON_PRIV_IP"),a.i18n.msg("FON_DHCP_LEASE_TIME")],colModel:[{name:"Mac",index:"Mac",width:120,sortable:false,resizable:false,editable:false,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("HOME_MAC_ADDR")+'"'}},{name:"Ip",index:"Ip",width:100,sortable:false,resizable:false,editable:false,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("FON_PRIV_IP")+'"'}},{name:"LeaseTimeRemaining",index:"LeaseTimeRemaining",width:180,sortable:false,resizable:false,editable:false,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("FON_DHCP_LEASE_TIME")+'"'}}],caption:a.i18n.msg("FON_CONNECTED_DEVICES"),forceFit:true,scrollOffset:0}).parents("div.ui-jqgrid").addClass("gui-table");o.jqGrid({datatype:"local",height:200,colNames:[a.i18n.msg("HOME_MAC_ADDR")],colModel:[{name:"MACAddress",index:"MACAddress",width:220,sortable:false,resizable:false,editable:false,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("HOME_MAC_ADDR")+'"'}}],caption:a.i18n.msg("FON_CONNECTED_DEVICES"),forceFit:true,scrollOffset:0}).parents("div.ui-jqgrid").addClass("gui-table");c.jqGrid({datatype:"local",height:200,colNames:[a.i18n.msg("HOME_MAC_ADDR")],colModel:[{name:"MACAddress",index:"MACAddress",width:220,sortable:false,resizable:false,editable:false,cellattr:function(D,F,C,n,E){return' data-label="'+a.i18n.msg("HOME_MAC_ADDR")+'"'}}],caption:a.i18n.msg("FON_CONNECTED_DEVICES"),forceFit:true,scrollOffset:0}).parents("div.ui-jqgrid").addClass("gui-table")}}b.FONnbLogGuestCP=-1;var z=b("#NbGuestsCP",l);var p=b("#NbMaxGuestsCP",l);var q=b("#CurrentNbLoggedGuestsCP",l);var v=b("#CurrentMaxCP",l);v.hide();q.hide();v.bind("statusvalue",function(n,C){p.text(C.value)});q.bind("statusvalue",function(C,D){var E=a.client.newRequest();var n=new Array();E.getValue("Device/WiFi/AccessPoints/AccessPoint[@uid='3']/AssociatedDevices",function(F){b.each(F,function(H,G){if(true){n.push(G)}});if(b.FONnbLogGuestCP==-1){b.FONnbLogGuestCP=n.length;b("#CurrentNbLoggedGuestsCP").text(b.FONnbLogGuestCP);z.text(b.FONnbLogGuestCP)}else{if(b.FONnbLogGuestCP!=n.length){b.FONnbLogGuestCP=n.length;a.refreshPage();b("#CurrentNbLoggedGuestsCP").text(b.FONnbLogGuestCP);z.text(b.FONnbLogGuestCP)}}});E.send()});b.FONnbLogGuestEAP=-1;var s=b("#NbGuestsEAP",l);var y=b("#NbMaxGuestsEAP",l);var j=b("#CurrentNbLoggedGuestsEAP",l);var e=b("#CurrentMaxEAP",l);e.hide();j.hide();e.bind("statusvalue",function(n,C){y.text(C.value)});j.bind("statusvalue",function(C,D){var E=a.client.newRequest();var n=new Array();E.getValue("Device/WiFi/AccessPoints/AccessPoint[@uid='4']/AssociatedDevices",function(F){b.each(F,function(H,G){if(G.AuthenticationState==true){n.push(G)}});if(b.FONnbLogGuestEAP==-1){b.FONnbLogGuestEAP=n.length;b("#CurrentNbLoggedGuestsEAP").text(b.FONnbLogGuestEAP);s.text(b.FONnbLogGuestEAP)}else{if(b.FONnbLogGuestEAP!=n.length){b.FONnbLogGuestEAP=n.length;a.refreshPage();b("#CurrentNbLoggedGuestsEAP").text(b.FONnbLogGuestEAP);s.text(b.FONnbLogGuestEAP)}}});E.send()})}}).delegate("#LANSharing","pagebeforeshow",function(){var c=b(this);if(b("#FonEnableSlider",c).hasClass("ui-state-disabled")){b("#FonEnableSlider",c).removeClass("ui-state-disabled")}if(b("#FonEnableSlider > div",c).hasClass("ui-disabled")){b("#FonEnableSlider > div",c).addClass("ui-slider-mini")}}).delegate("#LANSharing","pagehide",function(){b(this).remove})});jQuery(function(e){var c=e.gui,d=false,b;function a(){e.firstBGCConnection=true;if(!d){d=true;e.mobile.loading("show");b=c.client.user;c.client._clean();setTimeout(a,50000);return}c.client.openSession(b,undefined,function(){d=false;e.firstBGCConnection=true;e.mobile.loading("hide");c.alert(c.i18n.msg("MAINTENANCE_MODEM_RESTART")+" "+b,{callbackClose:function(){location.reload(true)}})},function(){if(b.toLowerCase()==b){b=b.charAt(0).toUpperCase()+b.substr(1)}else{b=b.toLowerCase()}setTimeout(a,5000)})}e(document).delegate("#MaintenancePage","pagebeforecreate",function(){var g=e(this),k=e("#Upgrade",g),l=e("#SSHService",g),h=e("#ManagementServer",g),j=e("#Config",g),m=e("#Route",g),f=c.client.user;if(f.toLowerCase()==="expert"||f.toLowerCase()==="admin"){e(":jqmData(xpath)",l).each(function(){var o=e(this),n=o.attr("data-xpath");n=n.replace(/\[Login=\'[^']*\'\]/,"[Login='"+f+"']");o.attr("data-xpath",n)});e("#SecondaryGatewayIP",g).show()}else{k.remove();l.remove();h.remove();j.remove();m.remove();e("#SecondaryGatewayIP",g).remove()}if(c.client.user.toLowerCase()!=="admin"){e("#SSHWANRestriction",g).remove();m.remove()}}).delegate("#MaintenancePage","pageinit",function(){var g=e(this),h=e("#SSHAccessCheck",g);function j(l){var k=c.client.newRequest();if(l=="RPC_RestoreConfig"){k.uploadFile("Device/DeviceInfo/VendorConfigFiles/VendorConfigFile[Alias='DEVICE_CONFIG']","#ConfigFileInput",function(){a()},function(){c.alert(c.i18n.msg("MAINTENANCE_RESTORE_ERROR"))})}else{if(l=="RPC_Reboot"){k.remoteCall("Device","reboot",{},undefined,function(){a()},function(){c.alert(c.i18n.msg("MAINTENANCE_GATEWAY_NOT_REBOOT"))})}else{if(l=="RPC_RestoreFactory"){k.remoteCall("Device","reinitialize",{RestoreMode:"PARTIAL"},undefined,function(){a()},function(){c.alert(c.i18n.msg("MAINTENANCE_GATEWAY_NOT_RESTORE"))})}else{c.alert("Unknow case");return}}}k.send()}function f(k){e("<div>").simpledialog2({mode:"button",buttonPrompt:"<br/>"+c.i18n.msg("MAINTENANCE_SUR")+"<br/><br/><br/>",themeDialog:"d",buttons:{OK:{text:c.i18n.msg("HOME_YES"),click:function(){j(k)},theme:"b"},Cancel:{text:c.i18n.msg("HOME_NO"),click:function(){},icon:"delete",theme:"d"}}})}e("#RebootBtn",g).click(function(k){f("RPC_Reboot")});e("#ConfigBackupBtn",g).click(function(l){var k=c.client.newRequest();k.downloadFile("Device/DeviceInfo/VendorConfigFiles/VendorConfigFile[Alias='DEVICE_CONFIG']",function(){c.alert(c.i18n.msg("MAINTENANCE_CONFIG_SAVE"))},function(){c.alert(c.i18n.msg("MAINTENANCE_BACKUP_ERROR"))});k.send()});e("#ConfigRestoreBtn",g).click(function(k){f("RPC_RestoreConfig")});e("#RestoreFactoryBtn",g).click(function(k){f("RPC_RestoreFactory")});e("#UpgradeBtn",g).click(function(l){var k=c.client.newRequest();if(e("#UpgradeFile").val()!=""){k.firmwareUpgrade("Device",e("#UpgradeFile",g),function(){a()},function(){c.alert(c.i18n.msg("MAINTENANCE_FW_UPGRADE_ERROR"))},{fileType:e("#UpgradeFileTypeSelect",g).val()});k.send()}else{c.alert(c.i18n.msg("MAINTENANCE_BACKUPFILE_ERROR"))}});e("#ACSRequestDownloadBtn",g).click(function(m){var k=e("#ACSDownloadTypeSelect",g),n=e("#ACSRequestDownloadRetryCheck",g),l=c.client.newRequest();l.remoteCall("Device","requestDownload",{FileType:k.val(),Retry:(n.val()==="true")},undefined,function(){c.alert(c.i18n.msg("MAINTENANCE_DOWNLOAD_REQUEST"))},function(){c.alert(c.i18n.msg("MAINTENANCE_GATEWAY_NOT_RESTORE"))});l.send()});e("#ConfigFileInput").bind("change",function(){e("#ConfigFileInput").prev("span").html(e(this).val())});e("#UpgradeFile").bind("change",function(){e("#UpgradeFile").prev("span").html(e(this).val())});e("#FakeConfigFileInput").parent("div").css({"max-width":"220px"});e("#FakeUpgradeFile").parent("div").css({"max-width":"220px"})}).delegate("#MaintenancePage","pageshow",function(){var g=e(this),h=c.client.newRequest();h.getValue("Device/IP/Interfaces/Interface[Alias='IP_BR_LAN']/IPv4Addresses/IPv4Address[Alias='IP_BR_LAN_SECONDARY_ADDRESS']/AddressingType",function(k){if(k.toLowerCase()==="static"){e("#SubnetMaskAddress",g).enable();e("#IPAddress",g).enable()}else{e("#SubnetMaskAddress",g).disable();e("#IPAddress",g).disable()}});function f(){if(e("#IPAddress",g).data("isEmpty")=="false"||e("#IPAddress",g).val()!=""){return false}else{return true}}function j(){if((e("#SubnetMaskAddress").val()==""||f())&&e("#SecondaryGatewayIPEnableCheck").val()=="true"){if(e("#IPAddress").parent().is(":visible")){e("#SecondaryIPEmptyWarning").show();e("#SecondaryGatewayIPEnableCheck option[value='false']").attr("selected",true);e("#SecondaryGatewayIPEnableCheck").slider("refresh")}}else{e("#SecondaryIPEmptyWarning").hide()}}h.getValue("Device/Services/BGCNetworkProperties/NetworkTopology",function(k){if(k.toLowerCase()==="titan"&&c.client.user.toLowerCase()!=="user"){e("#ZTC",g).show()}else{e("#ZTC",g).remove()}if(c.client.user.toLowerCase()==="user"){e("#NetworkTopology",g).remove()}});h.send();e("#IPAddress").blur(function(){j()});e("#SubnetMaskAddress").blur(function(){j()});e("#SecondaryGatewayIPEnableCheck").change(function(){j()});e("#NetworkTopologyToggle",g).change(function(){h.getValue("Device/Services/BGCTV/Mode",function(k){if(k.toLowerCase()==="bridged"){if(e("#NetworkTopologyToggle",g).val()==="TITAN"){c.alert(c.i18n.msg("MAINTENANCE_REFUSED_TV_SINGLE_IP_ERROR"));e("#ApplyButton",g).disable()}}});h.getValue("Device/Managers/NetworkData/InterfaceType",function(k){if(k.toLowerCase()==="adsl"){if(e("#NetworkTopologyToggle",g).val()==="TITAN"){c.alert(c.i18n.msg("MAINTENANCE_REFUSED_ADSL_SINGLE_IP_ERROR"));e("#ApplyButton",g).disable()}}});h.send()});e("#ApplyButton",g).unbind("maintenancepagetrigger");e("#ApplyButton",g).on("maintenancepagetrigger",function(k){h.getValue("Device/Services/BGCTV/Mode",function(l){if(l.toLowerCase()==="bridged"){if(e("#NetworkTopologyToggle",g).val()==="TITAN"){h.setValue("Device/Services/BGCNetworkProperties/NetworkTopology","Legacy");h.send();return true}}});h.getValue("Device/Managers/NetworkData/InterfaceType",function(l){if(l.toLowerCase()==="adsl"){if(e("#NetworkTopologyToggle",g).val()==="TITAN"){h.setValue("Device/Services/BGCNetworkProperties/NetworkTopology","Legacy");h.send();return true}}});h.send();if(e("#ACSUrl",g).val()===""){c.alert(c.i18n.msg("MAINTENANCE_ACS_URL_REQUIRED"));return true}else{if(e("#ACSUsername",g).val()===""){c.alert(c.i18n.msg("MAINTENANCE_ACS_USERNAME_REQUIRED"));return true}}return false})})});jQuery(function(e){var a=e.gui;var c=false;var b=false;var f,g;e(document).delegate("#WiFiPage","pagebeforecreate",function(k){var h=e(this),m=e("a",h),l=e.QueryString(h.data("url"));var j=a.client.newRequest();j.getValue("Device/WiFi/AccessPoints/AccessPoint[Alias='PRIV0']/Security/KeyPassphrase",function(n){f=n});j.getValue("Device/WiFi/AccessPoints/AccessPoint[Alias='VID1']/Security/KeyPassphrase",function(n){g=n});j.send();if(l.radio=="2G4"){var j=a.client.newRequest();j.getValue("Device/Services/BGCHotspotService/Enable",function(o,n){if(""+o=="true"){c=true}});j.getValue("Device/Services/BGCHotspotService/Status",function(o,n){if(""+o=="Enabled"){b=true}else{b=false}});j.send({synchronous:true})}if(l.radio==="5G"){e(".gui-wifi-radio",h).text("5");e(":jqmData(xpath)",h).each(function(){var o=e(this),n=o.attr("data-xpath");n=n.replace("WL_PRIV","WL_VIDEO_5G").replace("GuiEnable_2G4","GuiEnable_5G").replace("RADIO2G4","RADIO5G").replace("PRIV0","VID1");o.attr("data-xpath",n);e("#WiFiSSIDInput2").data().xpath="Device/WiFi/SSIDs/SSID[Alias='WL_PRIV']/SSID"});m.each(function(){var o=e(this),n=o.attr("href");n=n.replace("2G4","5G");o.attr("href",n)});e(".gui-extension-wifi",h).remove();var j=a.client.newRequest();j.getValue("Device/WiFi/Radios/Radio[@uid='2']/SupportedStandards",function(o,n){if(""+o=="a,n,ac"){e("#Mode5G p",h).text("802.11 ac")}else{e("#Mode5G p",h).text("802.11 n")}});j.send({synchronous:true});e("#Mode5G",h).show();e("#Mode2G4",h).remove();var j=a.client.newRequest();j.getValue("Device/Services/BGCTV/Mode",function(n){if(n=="BRIDGED"){e("#Menu a",h).attr("xmsg","WIFI_GENERAL_BRIDGED");e("#Wifi5GBridgedWarning",h).show()}});j.send({synchronous:true})}else{e("#Mode5G",h).remove();e("#Mode2G4",h).show()}if(l.radio==="unified"){e("#Mode2G4",h).remove();e(".wifi-unified",h).removeClass("hide");e(".wifi-no-unified",h).remove();e(".gui-wifi-radio",h).parent().html("Wi-Fi");e(".hide-channels",h).bind("statusvalue",function(n,o){if(o.value){e("li.gui-wifi-channel",h).hide()}else{e("li.gui-wifi-channel",h).show()}})}else{e(".wifi-unified",h).remove()}}).delegate("#WiFiPage","pagecreate",function(J){var z=e(this),D=e("#WiFiEnableCheck",z),I=e("#WiFiButtonEnable",z),t=e("#WiFiSSIDEnable",z),l=e(".gui-wifi-config, .gui-wifi-security",z),p=e("#WiFiAutoChannel",z),w=e("#WiFiAutoChannel5G",z),o=e("#WiFiChannelSelect",z),A=e("#WiFiChannelSelect5G",z),H=e("#WiFiSecurityModeSelect",z),G=e("#WiFiWEPKeyInput",z),v=e("#WiFiPassphraseInput",z),M=e(".gui-wifi-wps",z),P=e("#WiFiEnableWSPCheck",z),B=e("#WiFiWPSModeSelect",z),s=e("#WiFiWPSStartBtn",z),C=e("#WiFiWPSPINInput",z),y=e("#WiFiWPSPINCodeBtn",z),k=e("#ApplyButton",z),F=e("#WiFiMACFilteringList",z),O=e("#WiFiLowSecurityWarning",z),L=e("#WiFiFactoryReset",z),u=e("#WiFiExtensionCtrl",z),E=e("#WiFiExtensionChannelSelect",z),N=e.QueryString(z.data("url")),j;var h=a.client.newRequest();hostsList=[];originalHostsList=[];h.getValue("Device/Hosts/Hosts",function(R){e.each(R,function(S,T){if((T.InterfaceType=="Ethernet"||T.InterfaceType=="WiFi")&&(T.PhysAddress!==""&&T.IPAddress!=="")){originalHostsList.push(T);hostsList.push(T)}})});h.send({synchronous:true});var r=[36,40,44,48,52,56,60,64,100,104,108,112];if(N.radio==="5G"){j=r}else{j=[1,2,3,4,5,6,7,8,9,10,11,12,13]}e("#WiFiPassphraseInput",z).ezpz_hint();D.bind("selectbeforeloaded",function(R,S){I.item("current",S.value)}).change(function(){var R=e(this).val();I.item("value",(R==="true"));if(N.radio=="2G4"){e("#WiFiFonError").remove();if(""+R=="false"&&b){var S=e("<p>").attr({"class":"gui-status-warning text-danger",id:"WiFiFonError"}).html(a.i18n.msg("WIFI_ALERT_DISABLING"));S.insertAfter("#WiFiButtonEnable")}}if(R==="true"){l.enable();H.change()}else{l.disable()}}).bind("selectbeforesubmit",function(R,S){var T=e(this).val()});D.bind("selectbeforeloaded",function(R,S){t.item("current",S.value)}).change(function(){var R=e(this).val();t.item("value",(R==="true"))}).bind("selectbeforesubmit",function(R,S){var T=e(this).val()});p.bind("itemloaded",function(R,S){if(S.value){o.val("AUTO").change()}});w.bind("itemloaded",function(R,S){if(S.value){A.val("AUTO").change()}});e.each(j,function(R,S){o.append('<option value="'+S+'" >'+S+"</option>")});if(N.radio==="unified"){e.each(r,function(R,S){A.append('<option value="'+S+'" >'+S+"</option>")})}o.change(function(){var R=o.val();if(R==="AUTO"){p.item("value",true);o.select({readOnly:true});u.val("AUTO").change()}else{p.item("value",false);o.select({readOnly:false});if(o.val()<=9){u.val("ABOVECONTROLCHANNEL").change()}else{u.val("BELOWCONTROLCHANNEL").change()}}});A.change(function(){var R=A.val();if(R==="AUTO"){w.item("value",true);A.select({readOnly:true})}else{w.item("value",false);A.select({readOnly:false})}});e("#WiFi2G4OnlyModes",z).change(function(R){disableExtensionChannel(this.value,z)});E.change(function(){manageExtensionChannel(z)});H.change(function(){var R=H.val();switch(R){case"WEP_64":case"WEP_128":G.parent("li").show();v.parent("li").hide();P.val("false");if(!H.hasClass("ui-state-disabled")){M.disable()}break;case"WPA_PERSONAL":O.hide();G.parent("li").hide();v.parent("li").show();P.val("false");if(!H.hasClass("ui-state-disabled")){M.disable()}break;case"WPA2_PERSONAL":O.hide();G.parent("li").hide();v.parent("li").show();if(!H.hasClass("ui-state-disabled")){P.val("true");M.enable();P.change()}break;case"WPA_WPA2_PERSONAL":O.hide();G.parent("li").hide();v.parent("li").show();if(!H.hasClass("ui-state-disabled")){P.val("true");M.enable();P.change()}break;default:O.show();G.parent("li").hide();v.parent("li").hide();P.val("false");M.disable();e("<div>").simpledialog2({mode:"blank",width:"300px",themeDialog:"d",showModal:false,blankContent:"<br/><p align='center'>"+a.i18n.msg("WIFI_WPS_DISABLED")+"</p><br/><p align='right' data-role='footer'><center><a rel='close' data-role='button' href='#' data-inline='true' data-mini='true' data-theme='b' data-icon='check'>"+a.i18n.msg("HOME_OK")+"</a></center></p>"});break}});P.change(function(){if(P.val()=="false"){e("#WPS",z).addClass("gui-advanced-info");e(".wps-info",z).hide()}else{e("#WPS",z).removeClass("gui-advanced-info");e(".wps-info",z).show()}});var n=function(){var R=((N.radio==="5G")?"VID1":"PRIV0");e.mobile.loading("show",{text:a.i18n.msg("WIFI_GENERATE_PINCODE"),textVisible:true});var S=a.client.newRequest();S.setValue("Device/WiFi/AccessPoints/AccessPoint[Alias='"+R+"']/WPS/Enable",true,function(){P.val("true").refresh()});S.setValue("Device/WiFi/AccessPoints/AccessPoint[Alias='"+R+"']/WPS/ConfigMethodsEnabled","PIN",function(){var T=a.client.newRequest();T.remoteCall("Device/WiFi/AccessPoints/AccessPoint[Alias='"+R+"']","generatePinCode",{},undefined,function(U){if(U.PinCode=="DISABLED"){a.alert(a.i18n.msg("WIFI_ALERT_PIN"))}else{C.val(U.PinCode)}e.mobile.loading("hide")},function(){a.alert(a.i18n.msg("WIFI_ALERT_PIN"));e.mobile.loading("hide")});T.send()},function(){a.alert(a.i18n.msg("WIFI_ALERT_PIN"));e.mobile.loading("hide")});S.send()};B.change(function(){var R=B.val();if(!B.hasClass("ui-state-disabled")){switch(R){case"PushButton":s.enable();y.add(C).disable();break;default:s.disable();y.add(C).enable();break}}});s.click(function(){var R=a.client.newRequest();R.remoteCall("Device/WiFi/AccessPoints/AccessPoint[Alias='"+((N.radio==="5G")?"VID1":"PRIV0")+"']","startWPS",{},undefined,function(){},function(T){if(T.code!=a.XMO_TIMEOUT_WPS_ERR){a.alert(a.i18n.msg("WIFI_ALERT_WPS"))}});R.send();if(N.radio==="unified"){var S=a.client.newRequest();S.remoteCall("Device/WiFi/AccessPoints/AccessPoint[Alias='VID1']","startWPS",{},undefined,function(){},function(){});S.send()}});y.click(function(){n()});L.click(function(){e("<div>").simpledialog2({mode:"button",buttonPrompt:"<br/>"+a.i18n.msg("MAINTENANCE_SUR")+"<br/><br/><br/>",themeDialog:"d",buttons:{OK:{text:a.i18n.msg("HOME_OK"),click:function(){e.mobile.loading("show",{text:a.i18n.msg("HOME_SUBMIT_MODIF"),textVisible:false});var R=a.client.newRequest();if(N.radio==="unified"){R.setValue("Device/Managers/NetworkLan/ResetWlan","BOTH");R.send(function(){e.mobile.changePage(z.parent().children("#HomePage"))})}else{R.setValue("Device/Managers/NetworkLan/ResetWlan",((N.radio==="5G")?"WL_VIDEO_5G":"WL_PRIV"),function(){e.mobile.changePage(z.parent().children("#HomePage"))},function(){a.alert(a.i18n.msg("HOME_SUBMIT_ERROR"))});R.send()}},theme:"b"},Cancel:{text:a.i18n.msg("HOME_CANCEL"),click:function(){},icon:"delete",theme:"d"}}})});if(a.displayMode===a.GUI_SMARTPHONE_MODE){F.bind("arraybeforeinsert",function(S,T){var R=e("#MACFilterTmpl",z).tmpl({uid:T.value.uid,mac:T.value.MACAddress,page:"mac-filter.html?radio="+N.radio+"&uid="+T.value.uid});F.append(R).listview("refresh")})}else{var x=e('<table id="MACFilterTable" >'),K=1,Q,q;function m(U){var R=e("#"+U,x),T=R.item("value");var S=x.jqGrid("getRowData",U);if(T.hasOwnProperty("MACAddress")){hostsList=e.map(hostsList,function(V){if(V.PhysAddress.toLowerCase()!==S.MACAddress.toLowerCase()){return V}})}T=e.extend({},T,x.jqGrid("getRowData",U));R.item("value",T)}F.hide().after(x).bind("arraybeforeinsert",function(S,T){var U="mac"+K,R;x.jqGrid("addRowData",U,T.value);R=x.find("#"+U).object({connected:false,objset:null});T.item=R.data("xmo-item");T.item.current(T.value,T.capability,T.xpath);if(T.value.MACAddress!==""){hostsList=e.map(hostsList,function(V){if(V.PhysAddress.toLowerCase()!==T.value.MACAddress.toLowerCase()){return V}})}R.find(".gui-table-delete-row").click(function(X){var ab=x.jqGrid("getRowData",U);var Y=ab.MACAddress;if(e(Y).is("input")){var Z=false;var W=e("#"+e(Y).attr("id")).val();for(var ac=0;ac<hostsList.length;ac++){if(W.toLowerCase()===hostsList[ac].PhysAddress.toLowerCase()){Z=true;break}}if(!Z){Y=W}}for(var aa=0;aa<originalHostsList.length;aa++){var V=originalHostsList[aa];if(V.PhysAddress.toLowerCase()===Y.toLowerCase()){hostsList.push(V);break}}x.jqGrid("delRowData",U)}).end();q=U;K++}).bind("arraypostactions",function(R,S){if(Q){x.jqGrid("saveRow",Q);m(Q);Q=undefined}});x.jqGrid({datatype:"local",height:200,colNames:[a.i18n.msg("HOME_MAC_ADDR"),a.i18n.msg("WIFI_HOSTNAME"),a.i18n.msg("WIFI_DELETE")],colModel:[{name:"MACAddress",index:"MACAddress",width:130,sortable:false,resizable:false,editable:true,cellattr:function(T,V,S,R,U){return' data-label="'+a.i18n.msg("HOME_MAC_ADDR")+'"'}},{name:"Hostname",index:"Hostname",width:200,sortable:false,resizable:false,editable:true,edittype:"select",formatter:"select",editoptions:{value:function(){var S="Device:"+a.i18n.msg("DHCP_NEW_DEVICE");for(var R=0;R<hostsList.length;R++){if(hostsList[R].UserFriendlyName!=""){S+=";"+hostsList[R].PhysAddress.replace(/:/g,".")+":"+hostsList[R].UserFriendlyName}else{if(hostsList[R].HostName!=""){S+=";"+hostsList[R].PhysAddress.replace(/:/g,".")+":"+hostsList[R].HostName}else{if(hostsList[R].UserDeviceType==="TV_DECODER"){S+=";"+hostsList[R].PhysAddress.replace(/:/g,".")+":"+a.i18n.msg("HOME_TVDECODER")}else{S+=";"+hostsList[R].PhysAddress.replace(/:/g,".")+":"+a.i18n.msg("HOME_DEVICE")}}}}return S},dataEvents:[{type:"change",fn:function(S){var R=this.id.replace("Hostname","MACAddress");if(this.value!="Device"){e("#"+R).val(this.value.replace(/\./g,":").toUpperCase());e("#"+R).prop("disabled",true)}else{e("#"+R).val("");e("#"+R).prop("disabled",false)}}}]},formatter:function(R,S,U){for(var T=0;T<hostsList.length;T++){if(U.MACAddress.toUpperCase()==hostsList[T].PhysAddress.toUpperCase()){if(hostsList[T].UserFriendlyName!=""){return hostsList[T].UserFriendlyName}else{if(hostsList[T].HostName!=""){return hostsList[T].HostName}else{if(hostsList[T].UserDeviceType==="TV_DECODER"){return a.i18n.msg("HOME_TVDECODER")}else{return a.i18n.msg("HOME_DEVICE")}}}}}return a.i18n.msg("HOME_DEVICE")},unformat:function(S,T,R){},cellattr:function(T,V,S,R,U){return' data-label="'+a.i18n.msg("WIFI_HOSTNAME")+'"'}},{name:"Delete",index:"Delete",width:70,sortable:false,resizable:false,classes:"gui-table-delete-row",cellattr:function(T,V,S,R,U){return' data-label="'+a.i18n.msg("WIFI_DELETE")+'"'}}],scrollOffset:0,caption:F.children("li:first").text(),forceFit:true,editurl:"clientArray",onSelectRow:function(S){var R={keys:true,aftersavefunc:function(T){d(e(this),this.p.data.length,T);m(T);x.jqGrid("resetSelection");Q=undefined}};if(S&&S!==Q){x.jqGrid("saveRow",Q);m(Q);x.jqGrid("editRow",S,R);Q=S}}}).parents("div.ui-jqgrid").addClass("gui-table");e("#WiFiMACFilteringAdd",z).click(function(R){R.preventDefault();R.stopImmediatePropagation();var S={MACAddress:""};F.array("insert",-1,S,new a.api.Capability({name:"MACAddress"}));x.jqGrid("setSelection",q);e("#"+q,x).find("select").val("Device").change();if(x[0].p.data.length>1){d(x,x[0].p.data.length-1,x[0].p.data[x[0].p.data.length-2].id)}});k.on("wifipagetrigger",function(T,W,V){if(e("#WiFiSSIDInput").val()==e("#WiFiSSIDInput2").val()){if(N.radio=="5G"){if(e("#WiFiPassphraseInput").val()==""){e("#WiFiPassphraseInput").val(g)}if(f!=e("#WiFiPassphraseInput").val()){e("<div>").simpledialog2({mode:"button",buttonPrompt:"<br/>"+a.i18n.msg("WIFI_USED")+"<br/><br/><br/>",themeDialog:"d",buttons:{OK:{text:a.i18n.msg("HOME_OK"),click:function(){},theme:"b"}}});return true}}else{if(N.radio=="2G4"){if(e("#WiFiPassphraseInput").val()==""){e("#WiFiPassphraseInput").val(f)}if(g!=e("#WiFiPassphraseInput").val()){e("<div>").simpledialog2({mode:"button",buttonPrompt:"<br/>"+a.i18n.msg("WIFI_USED")+"<br/><br/><br/>",themeDialog:"d",buttons:{OK:{text:a.i18n.msg("HOME_OK"),click:function(){},theme:"b"}}});return true}}}}if(Q){x.jqGrid("saveRow",Q);m(Q);if(x[0].p.data.length>0){if(d(x,x[0].p.data.length,x[0].p.data[x[0].p.data.length-1].id)==true){return true}}}if(N.radio==="unified"){var R=[];e.each(x[0].p.data,function(Y,X){R.push(X)});var U=a.client.newRequest();mainMAC5GxPath="Device/WiFi/AccessPoints/AccessPoint[Alias='VID1']/MACFiltering/MACAddresses";U.getValue(mainMAC5GxPath,function(Y){var X=a.client.newRequest();e.each(Y,function(aa,Z){if(e.inArray(Z,R)==-1){X.deleteElement(mainMAC5GxPath+"/MACAddress[MACAddress='"+Z.MACAddress+"']")}});e.each(R,function(aa,Z){if(e.inArray(Z,Y)==-1){X.addChild(mainMAC5GxPath,{MACAddress:{MACAddress:Z.MACAddress,Hostname:Z.Hostname}})}});X.send()});U.setValue("Device/WiFi/AccessPoints/AccessPoint[Alias='VID1']/MACFiltering/Mode",e("#fieldsetWifi label.ui-btn-active + input[type=radio]",z).val());U.send()}if(N.radio==="unified"){var S=a.client.newRequest();if(D.item("modified")){S.setValue("Device/WiFi/AccessPoints/AccessPoint[Alias='VID1']/Enable",D.val()==="true");S.setValue("Device/WiFi/SSIDs/SSID[Alias='WL_VIDEO_5G']/Enable",D.val()==="true");S.setValue("Device/Services/BGCButton/GuiEnable_5G",D.val()==="true")}if(e("#WiFiSSIDInput",z).item("modified")){S.setValue("Device/WiFi/SSIDs/SSID[Alias='WL_VIDEO_5G']/SSID",e("#WiFiSSIDInput",z).val())}if(e("#WiFiSSIDAdvertInput",z).item("modified")){S.setValue("Device/WiFi/AccessPoints/AccessPoint[Alias='VID1']/SSIDAdvertisementEnabled",e("#WiFiSSIDAdvertInput",z).val()==="true")}if(e("#WiFiSecurityModeSelect",z).item("modified")){S.setValue("Device/WiFi/AccessPoints/AccessPoint[Alias='VID1']/Security/ModeEnabled",e("#WiFiSecurityModeSelect",z).val())}if(e("#WiFiPassphraseInput",z).item("modified")){S.setValue("Device/WiFi/AccessPoints/AccessPoint[Alias='VID1']/Security/KeyPassphrase",e("#WiFiPassphraseInput",z).val())}if(e("#WiFiEnableWSPCheck",z).item("modified")){S.setValue("Device/WiFi/AccessPoints/AccessPoint[Alias='VID1']/WPS/Enable",e("#WiFiEnableWSPCheck",z).val()==="true")}S.send()}return false})}}).delegate("#WiFiPage","pageinit",function(){e("#WiFiSSIDInput").keyup(function(){e("#WiFiSSIDError").remove();if(e("#WiFiSSIDInput").val()==e("#WiFiSSIDInput2").val()){if(e("#WiFiPassphraseInput").val()==e("#WiFiSSIDInput2").val()){var h=e("<p>").attr({"class":"gui-status-warning text-danger",id:"WiFiSSIDError"}).text(a.i18n.msg("WIFI_USED"));h.insertAfter("#WiFiSSIDInput")}}})});function d(m,l,n){var j=m.jqGrid("getRowData",n);hostsList=e.map(hostsList,function(o){if(o.PhysAddress.toLowerCase()!==j.MACAddress.toLowerCase()){return o}});if(l>1){for(var k=0;k<l;k++){var h=m.jqGrid("getRowData",m[0].p.data[k].id);if(n==m[0].p.data[k].id){if(k<=l-2){n=m[0].p.data[k+1].id;j=m.jqGrid("getRowData",n)}else{break}}if(h.MACAddress==j.MACAddress){a.alert(a.i18n.msg("WIFI_MAC_USE"));m.jqGrid("delRowData",n);return true}}}m.jqGrid("setCell",n,"MACAddress",j.MACAddress.toUpperCase());m.jqGrid("getLocalRow",n).MACAddress=j.MACAddress.toUpperCase();if(!j.MACAddress.match("^([0-9A-Fa-f]{2}[:]){5}([0-9A-Fa-f]{2})$")){a.alert(a.i18n.msg("WIFI_MAC_FORMAT"));m.jqGrid("delRowData",n);return true}return false}}).delegate("#WiFiPage","pageshow",function(){var b=$(this);var a=$.gui.client.newRequest();$("a.gui-advanced-btn.ui-link").click(function(){if(!$(this).hasClass("ui-icon-top")){if($("#WiFiEnableWSPCheck").val()==="false"){$("#WPS",b).hide()}else{$("#WPS",b).show()}}else{$("#WPS",b).show()}});if($.QueryString($(this).data("url")).radio!=="5G"){a.getValue("Device/WiFi/Radios/Radio[Alias='RADIO2G4']/OperatingChannelBandwidth",function(c){if(c=="40MHZ"){$(".gui-control-side").show()}else{$(".gui-control-side").hide()}});a.getValue("Device/WiFi/AccessPoints/AccessPoint[Alias='PRIV0']/Security/ModeEnabled",function(c){if(c=="NONE"){$("#WiFiLowSecurityWarning",b).show();$("#WiFiLowSecurityWarning",b).show();$("#WiFiWEPKeyInput",b).parent("li").hide();$("#WiFiPassphraseInput",b).parent("li").hide();$("#WiFiEnableWSPCheck",b).val("false");$(".gui-wifi-wps",b).disable()}else{$("#WiFiLowSecurityWarning",b).hide();$("#WiFiLowSecurityWarning",b).hide();$("#WiFiLowSecurityWarning",b).hide();$("#WiFiWEPKeyInput",b).parent("li").hide();$("#WiFiPassphraseInput",b).parent("li").show();$(".gui-wifi-wps",b).enable()}});a.getValue("Device/WiFi/Radios/Radio[Alias='RADIO2G4']/OperatingStandards",function(c){disableExtensionChannel(c,b)});a.getValue("Device/WiFi/AccessPoints/AccessPoint[Alias='PRIV0']/WPS/Enable",function(c){if(c===true){$("#WPS",b).show();$(".wps-info",b).show()}else{$("#WPS",b).hide();$(".wps-info",b).hide()}})}else{a.getValue("Device/WiFi/AccessPoints/AccessPoint[Alias='VID1']/Security/ModeEnabled",function(c){if(c=="NONE"){$("#WiFiLowSecurityWarning",b).show();$("#WiFiLowSecurityWarning",b).show();$("#WiFiWEPKeyInput",b).parent("li").hide();$("#WiFiPassphraseInput",b).parent("li").hide();$("#WiFiEnableWSPCheck",b).val("false");$(".gui-wifi-wps",b).disable()}else{$("#WiFiLowSecurityWarning",b).hide();$("#WiFiLowSecurityWarning",b).hide();$("#WiFiLowSecurityWarning",b).hide();$("#WiFiWEPKeyInput",b).parent("li").hide();$("#WiFiPassphraseInput",b).parent("li").show();$(".gui-wifi-wps",b).enable()}});a.getValue("Device/WiFi/AccessPoints/AccessPoint[Alias='VID1']/Security/ModeEnabled",function(c){if(c=="NONE"){$("#WiFiLowSecurityWarning").show()}else{$("#WiFiLowSecurityWarning").hide()}});a.getValue("Device/WiFi/AccessPoints/AccessPoint[Alias='VID1']/WPS/Enable",function(c){if(c===true){$("#WPS",b).show();$(".wps-info",b).show()}else{$("#WPS",b).hide();$(".wps-info",b).hide()}})}a.getValue("Device/Services/EnhancedWiFi/GUI/EditWiFiCredentials",function(c){if(c){$("#WiFiSSIDInput",b).enable();$("#WiFiPassphraseInput",b).enable();$("#WiFiSecurityModeSelect",b).removeClass("ui-disabled");$("#WiFiFactoryReset",b).enable()}else{$("#WiFiSSIDInput",b).disable();$("#WiFiPassphraseInput",b).disable();$("#WiFiSecurityModeSelect",b).addClass("ui-disabled");$("#WiFiFactoryReset",b).disable()}});a.send()});function manageExtensionChannel(a){if($("#WiFiExtensionChannelSelect",a).val()=="40MHZ"){$(".gui-control-side",a).show()}else{$(".gui-control-side",a).hide()}}function disableExtensionChannel(b,a){if(b==="g"){$("#WiFiExtensionChannelSelect",a)[0].selectedIndex=0;$("#WiFiExtensionChannelSelect",a).selectmenu("refresh");$("#WiFiExtensionChannelSelect",a).selectmenu("disable");$(".gui-control-side",a).hide()}else{$("#WiFiExtensionChannelSelect",a).selectmenu("enable")}}jQuery(function(c){var a=c.gui,b="/"+a.opt.GUI_VERSION_OPT+"/gui/tpl/src/",d="home/home.html";c(document).delegate("#EnhancedWiFiPage","pagebeforecreate",function(e){}).delegate("#EnhancedWiFiPage","pagecreate",function(g){var l=c(this),k=c("#eWiFiStatus",l),o=c("#eWiFiActivation",l),e=c("#eWiFiDeactivation",l),n=c("#eWiFiHelpLink",l),m=c("#eWiFiHelpButton",l),h=c("#eWiFiApplyButton",l),j=c("#eWiFIMacAddressPrefix",l),f=c("#WiFiSSID5GInput",l);o.hide();e.hide();k.bind("statusvalue",function(q,r){if(r.value==="ENABLED_CONDUCTOR_ON"||r.value==="ENABLED_CONDUCTOR_OFF"){h.data("toggle-enabled","false");o.hide();e.show()}else{h.data("toggle-enabled","true");o.show();e.hide()}});c("div.xpath-password",l).bind("statusvalue",function(q,r){c(this).parent().find("input").val(r.value)});n.bind("statusvalue",function(t,u){var r=u.value.split("/");var s={en:"betterwifi",fr:"meilleurwifi",nl:"beterewifi"};var q=r[0]+"//"+r[2]+"/"+a.language.lang+"/"+s[a.language.lang];m.attr({href:q,target:"_blank"})});j.bind("statusvalue",function(s,t){var q=t.value.split(":");if(q.length>0){var r="WiFi-5.0-"+q[4]+""+q[5];f.val(r)}});h.click(function(r){c.mobile.loading("show",{text:a.i18n.msg("HOME_SUBMIT_MODIF"),textVisible:true});c(".ui-content > div",l).remove();h.disable();var q=a.client.newRequest();q.setValue("Device/Services/EnhancedWiFi/Enable",h.data("toggle-enabled")==="true");q.send(function(s){p()},function(s){console.log(s)})});function p(){c.mobile.changePage(b+d,{reverse:true})}c(".checkboxShowPassword",l).change(function(q){if(c(this).is(":checked")){c("#"+c(this).data("target-id-input")+"Clear",l).removeClass("hide");c("#"+c(this).data("target-id-input"),l).addClass("hide")}else{c("#"+c(this).data("target-id-input")+"Clear",l).addClass("hide");c("#"+c(this).data("target-id-input"),l).removeClass("hide")}})}).delegate("#EnhancedWiFiPage","pageinit",function(){}).delegate("#EnhancedWiFiPage","pageshow",function(){})});jQuery(function(b){var a=b.gui;b(document).delegate("#WiFiMACFilterPage","pagebeforecreate",function(){var c=b(this),d=b.QueryString(c.data("url"));if(d.radio==="5G"){b(".gui-wifi-radio",c).text("5")}b(":jqmData(xpath)",c).each(function(){var f=b(this),e=f.attr("data-xpath");if(d.uid!==undefined){e=e.replace("'uid'","'"+d.uid+"'")}else{f.attr("data-connected","false")}if(d.radio==="5G"){e=e.replace("WL_PRIV","WL_VIDEO_5G").replace("RADIO2G4","RADIO5G").replace("PRIV0","VID1")}f.attr("data-xpath",e)})}).delegate("#WiFiMACFilterPage","pagecreate",function(){var f=b(this),e=b("#MACFilterAddrInput",f),c=b("#MACFilterHostSelect",f),d=false;f.bind("objsetload",function(g,h){d=true});c.bind("selectbeforeoption",function(g,j){var h=j.value;if(!h.PhysAddress){g.preventDefault();g.stopImmediatePropagation();return}j.value=h.PhysAddress;j.text=h.IPAddress}).change(function(){if(d){e.val(c.val())}});if(e.attr("data-connected")==="false"){e.bind("inputpostactions",function(h,j){var g=j.options.xpath.replace(new RegExp("MACAddresses.*$"),"MACAddresses"),k={MACAddress:{MACAddress:e.val()}};j.request.addChild(g,k,function(){},j.options)})}})});jQuery(function(b){var a=b.gui;b(document).delegate("#EthernetPage","pagebeforecreate",function(e){var d=b(this),f=[{port:"1"},{port:"2"},{port:"3"},{port:"4"}];var c=b("#EthernetPortTmpl",d).tmpl(f);c.find("a.gui-advanced-btn").attr({});d.children(":jqmData(role='content')").append(c)}).delegate("#EthernetPage","pagecreate",function(d){var c=b(this);b("#ApplyButton",c).data("disabled",true);b("#BGCTVMode",c).bind("itemvalue",function(f,g){if(g.value=="BRIDGED"){b("#ConnectionModeSection1",c).show();var e=b("#BridgedPortsRO",c).item("value");for(i=2;i<=4;i++){b("#ConnectionModeSection"+i,c).show();$connxModePort=b("#ConnectionModePort"+i,c);if(e.match("PHY"+i)){$connxModePort.val("BRIDGED")}else{$connxModePort.val("ROUTED")}$connxModePort.change();$connxModePort.change(function(h,j){b("#ApplyButton",c).removeData("disabled")})}b("#BridgedPortsWO",c).bind("itembeforesubmit",function(k,l){var h="",j="";for(i=2;i<=4;i++){if(b("#ConnectionModePort"+i,c).val()=="BRIDGED"){h+=j+"Device/Ethernet/Interfaces/Interface[PHY"+i+"]";j=","}}h+=j+"Device/Ethernet/Interfaces/Interface[PHY5],Device/WiFi/SSIDs/SSID[WL_VIDEO_5G]";l.value=h})}})})});jQuery(function(b){var a=b.gui;b(document).delegate("#EthernetDevicePage","pagebeforecreate",function(){var c=b(this),d=b.QueryString(c.data("url"));if(d.type!=undefined){if(d.type!=="TV_DECODER"){b("#DeviceConnectionModeLib",c).remove()}a.getSettingsDeviceHeaderInfos(d,c)}if(d.type==="TV_DECODER"){b("#DeviceHostName").parent().attr("data-default-value",a.i18n.HOME_TVDECODER)}else{b("#DeviceHostName").parent().attr("data-default-value",a.i18n.HOME_DEVICE)}});b(document).delegate("#EthernetDevicePage","pagebeforeshow",function(){var c=b(this);b("#connectionStatus select").change(function(){if(b("#connectionStatus select").val()==="true"){b("#deviceButtonDelete",c).hide()}else{b("#deviceButtonDelete",c).show()}})})});jQuery(function(b){var a=b.gui;b(document).delegate("#USBDevicePage","pagecreate",function(){var f=b(this),j=b.QueryString(f.data("url")),h;var e=a.client.newRequest(),d=a.client.newRequest(),c=a.client.newRequest();if(j.host!=undefined&&!isNaN(j.host)){e.getValue("Device/Hosts/Hosts/Host[@uid='"+j.host+"']",function(m){if(m.InterfaceType=="USB"){g(m.SysfsId);portNumber="";portSide=a.i18n.msg("HOME_NONE");if(m.SysfsId.split(".").shift().split("-").pop()==="1"){portSide=a.i18n.msg("HOME_BACK")}else{if(m.SysfsId.split(".").shift().split("-").pop()==="2"){portSide=a.i18n.msg("HOME_FRONT")}}if(m.SysfsId.indexOf(".")!==-1){var k=m.SysfsId.split(".");k.shift();for(var l=0;l<k.length;l++){portNumber+="-"+k[l]}}b("#UsbPort").html(portSide+portNumber);if(m.UserFriendlyName==""){b("#DeviceUserName",f).attr("placeholder",a.i18n.msg("DEVUSB_REMOVABLE_DISC"));b("#DeviceUserName",f).ezpz_hint();b("#usb_title",f).html(a.i18n.msg("DEVUSB_REMOVABLE_DISC"))}else{b("#usb_title",f).html(m.UserFriendlyName)}}else{b.mobile.changePage(f.parent().children("#HomePage"))}},function(k){b.mobile.changePage(f.parent().children("#HomePage"))});e.send()}else{b.mobile.changePage(f.parent().children("#HomePage"))}var g=function(k){b("#DeviceEjectBtn",f).click(function(m){var l=a.client.newRequest();l.remoteCall("Device/USB/USBHosts/Hosts/Host/Devices/Device[SysfsId='"+k+"']","eject",{force:b("#DeviceEjectForceCheck",f).is(":checked")},undefined,function(){a.alert(a.i18n.msg("DEVUSB_CAN_REMOVE_DEV"));b.mobile.changePage(f.parent().children("#HomePage"))},function(){a.alert(a.i18n.msg("DEVUSB_CANNOT_EJECT"));b.mobile.changePage(f.parent().children("#HomePage"))});l.send()});d.getValue("Device/USB/USBHosts/Hosts/Host/Devices/Device[SysfsId='"+k+"']/SerialNumber",function(m,l){c.getValue("Device/Services/StorageServices/StorageService[@uid='1']/PhysicalMediums",function(n){b.each(n,function(q,p){if(p.SerialNumber==m){var o=a.client.newRequest();o.getValue("Device/Services/StorageServices/StorageService[@uid='1']/LogicalVolumes",function(r){var t=false;for(var s=0;s<r.length;s++){if(r[s].PhysicalReference.indexOf("PhysicalMedium[@uid='"+p.uid+"']")!=-1){state=a.i18n.msg("DEVUSB_MOUNT_KO");currentFileSystem=a.i18n.msg("DEVUSB_UNKNOWN");size=0;exploreFile="";if(r[s].Status=="ONLINE"){state=a.i18n.msg("DEVUSB_MOUNT_OK");currentFileSystem=r[s].FileSystem;size=r[s].UsedSpace+" / "+r[s].Capacity;exploreFile="\\\\mymodem\\"+r[s].SambaShareName}t=true;b("#usbFSTable",f).append('<tr><td data-label="'+a.i18n.msg("DEVUSB_STATE")+'">'+state+'</td><td data-label="'+a.i18n.msg("DEVUSB_FILESYS")+'">'+currentFileSystem+'</td><td data-label="'+a.i18n.msg("DEVUSB_SIZE")+'">'+size+'</td><td class="last-column" data-label="'+a.i18n.msg("DEVUSB_EXPLORE")+'">'+exploreFile+"</td></tr>")}}if(t===false){state=a.i18n.msg("DEVUSB_MOUNT_KO");currentFileSystem=a.i18n.msg("DEVUSB_UNKNOWN");size=0;exploreFile="";b("#usbFSTable",f).append("<tr><td>"+state+"</td><td>"+currentFileSystem+"</td><td>"+size+"</td><td>"+exploreFile+"</td></tr>")}},function(r){if(r.code==a.XMO_UNKNOWN_PATH_ERR){state=a.i18n.msg("DEVUSB_MOUNT_KO");currentFileSystem=a.i18n.msg("DEVUSB_UNKNOWN");size=0;exploreFile="";b("#usbFSTable",f).append("<tr><td>"+state+"</td><td>"+currentFileSystem+"</td><td>"+size+"</td><td>"+exploreFile+"</td></tr>")}});o.send()}})});c.send()});d.send()}}).delegate("#USBDevicePage","pagebeforeshow",function(){var c=b(this);b("#ApplyButton",c).disable();b("#deviceConnectionStatus select").change(function(){if(b("#deviceConnectionStatus select").val()==="true"){b("#divButtonDelete",c).hide()}else{b("#divButtonDelete",c).show()}})}).delegate("#USBDevicePage","pageshow",function(){var c=b(this);b("#ApplyButton",c).disable();b("#ApplyButton",c).addClass("ui-disabled")})});jQuery(function(d){var b=d.gui,c="/"+b.opt.GUI_VERSION_OPT+"/gui/tpl/src/",g="home/home.html",e="",a=[];d(".gui-phonesettings-page").live("pagebeforecreate",function(){var k=d(this),n=d.QueryString(k.data("url")),j=n.phone||1,o="LINE"+j,m,l=b.client.newRequest();a=[];l.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/Lines/Line[Alias='"+o+"']",function(p){m=getAliasFromXPath(p.Provider)});l.getValue(" 	Device/Services/VoiceServices/VoiceService[@uid='1']/SIP/Clients",function(p){a=p});l.send({synchronous:true});k.attr("id","Phone"+j+"Page");d(":jqmData(xpath)",k).each(function(){var q=d(this),p=q.attr("data-xpath");p=p.replace("#LineAlias#",o);p=p.replace("#ClientAlias#",m);q.attr("data-xpath",p)})}).live("pagecreate",function(){var j=d(this);d("#TelephoneNumberInput",j).bind("inputloaded",function(l,m){var k=m.value.split("@")[0].replace("sip:","");d("#TelephoneNumberInput",j).item("current",k);d("#TelephoneNumberInput",j).item("value",k);d("#TelephoneNumberInput",j).val(k)})}).live("pagebeforeshow",function(){var k=d(this),m=d.QueryString(k.data("url")),j=m.phone||1,n="LINE"+j,l=b.client.newRequest();l.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/Lines/Line[Alias='"+n+"']",function(o){e=getAliasFromXPath(o.Provider)});l.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/SIP/Networks/Network[Alias='NETWORK1']/UserAgentDomain",function(o){d("#DomainInput",k).val(o)});l.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/SIP/Networks/Network[Alias='NETWORK1']/UserAgentTransport",function(o){d("#TransportInput",k).val(o)});l.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/SIP/Networks/Network[Alias='NETWORK1']/OutboundProxy",function(o){d("#ProxyServerInput",k).val(o)});l.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/SIP/Networks/Network[Alias='NETWORK1']/OutboundProxyPort",function(o){d("#ProxyPortInput",k).val(o)});l.send({synchronous:true});if(b.client.user.toLowerCase()==="user"){l.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/SIP/Clients/Client[Alias='"+e+"']",function(o){if(o.StaticOrigin==="ACS"){d("#OLOEnableCheck",k).select({readOnly:true});d("#OLOEnableCheck",k).disable();d("#OLOEnableCheck",k).slider("refresh");d("#TelephoneNumberInput",k).input({readOnly:true});d("#TelephoneNumberInput",k).disable();d("#UsernameInput",k).input({readOnly:true});d("#UsernameInput",k).disable();d("#PasswordInput",k).input({readOnly:true});d("#PasswordInput",k).disable();d("#DomainInput",k).input({readOnly:true});d("#DomainInput",k).disable();d("#TransportInput",k).select({readOnly:true});d("#TransportInput",k).prop("disabled","disabled");d("#TransportInput",k).selectmenu("disable");d("#ProxyServerInput",k).input({readOnly:true});d("#ProxyServerInput",k).disable();d("#ProxyPortInput",k).input({readOnly:true});d("#ProxyPortInput",k).disable()}else{d("#OLOEnableCheck",k).select({readOnly:false});d("#OLOEnableCheck",k).enable();d("#OLOEnableCheck",k).slider("refresh");d("#TelephoneNumberInput",k).input({readOnly:false});d("#TelephoneNumberInput",k).enable();d("#UsernameInput",k).input({readOnly:false});d("#UsernameInput",k).enable();d("#PasswordInput",k).input({readOnly:false});d("#PasswordInput",k).enable();d("#DomainInput",k).input({readOnly:false});d("#DomainInput",k).enable();d("#TransportInput",k).select({readOnly:false});d("#TransportInput",k).enable();d("#TransportInput",k).selectmenu("enable");d("#ProxyServerInput",k).input({readOnly:false});d("#ProxyServerInput",k).enable();d("#ProxyPortInput",k).input({readOnly:false});d("#ProxyPortInput",k).enable()}});l.send({synchronous:true})}}).live("pageshow",function(){var k=d(this),m=d.QueryString(k.data("url")),j=m.phone||1,n="LINE"+j,l=b.client.newRequest();d("#Menu",k).find("a:not(.navbar-toggle):not(.ui-btn-active)").unbind("click");d("#Menu",k).find("a:not(.navbar-toggle):not(.ui-btn-active)").click(function(q,r){if(k.objset("modified")||d("#ApplyButton",k).data("force-enabled")){q.preventDefault();q.stopImmediatePropagation();var s=this.pathname.substring(this.pathname.lastIndexOf("/")+1)+this.search;var p=d(this);d("<div>").simpledialog2({mode:"blank",width:"300px",themeDialog:"d",showModal:false,blankContent:"<br/><p align='center'>"+b.i18n.msg("HOME_CONFIRM_CHANGE_PAGE")+"</p><br/><p align='right' data-role='footer'><a rel='close' data-xmo-role='submit' id='ApplyLineSettings' data-role='button' href='#' data-inline='true' data-mini='true' data-theme='b' data-icon='check'>"+b.i18n.msg("HOME_YES")+"</a><a id='CancelButtonDialog' rel='close' data-role='button' href='#' data-inline='true' data-theme='d' data-mini='true' data-icon='delete'>"+b.i18n.msg("HOME_NO")+"</a></p>"});d("#CancelButtonDialog").unbind("click");d("#CancelButtonDialog").click(function(){d.mobile.changePage(p.attr("href"),{transition:"none",changeHash:false});d.mobile.loadPage(k.attr("data-url"),{reloadPage:true,synchronious:true}).done(function(v,u,w,t){if(t){t.remove()}}).fail(function(u,t){})});d("#ApplyLineSettings").unbind("click");d("#ApplyLineSettings").click(function(t){if(d("#UsernameInput",k).val()===""||d("#PasswordInput",k).val()===""||d("#DomainInput",k).val()===""||d("#ProxyServerInput",k).val()===""||d("#ProxyPortInput",k).val()===""){b.alert(b.i18n.msg("SETTINGS_REQUIRED_ERROR"))}else{d.mobile.loading("show",{text:b.i18n.msg("HOME_SUBMIT_MODIF"),textVisible:true});d("#ApplyButton",k).addClass("ui-disabled");d("#ApplyButton",k).data("force-enabled",false);f(o,k,n,e)}});function o(){d.mobile.loading("hide");setTimeout(function(){d.mobile.changePage(p.attr("href"),{transition:"none",changeHash:false})},100)}}});d("#PasswordInput",k).data("isEmpty","false");l.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/SIP/Clients/Client[Alias='"+e+"']",function(p,o){if(p.AuthPassword!=undefined){if(p.AuthPassword=="_XMO_WRITE_ONLY_"){d("#PasswordInput",k).data("isEmpty","false");d("#PasswordInput",k).attr("placeholder","********")}else{d("#PasswordInput",k).data("isEmpty","true")}}},{"session-options":{depth:2}});l.send();if(j==1){d("#Phone1",k).addClass("gui-tab-active");d("#Phone1 a",k).addClass("ui-btn-active");d("#Phone2",k).removeClass("gui-tab-active");d("#Phone2 a",k).removeClass("ui-btn-active");d("#LineIdSettings",k).text(b.i18n.msg("SETTINGS_LINE_ONE_SETTINGS"))}else{d("#Phone1",k).removeClass("gui-tab-active");d("#Phone1 a",k).removeClass("ui-btn-active");d("#Phone2",k).addClass("gui-tab-active");d("#Phone2 a",k).addClass("ui-btn-active");d("#LineIdSettings",k).text(b.i18n.msg("SETTINGS_LINE_TWO_SETTINGS"))}d("#ApplyButton",k).unbind("fxssettingspagetrigger");d("#ApplyButton",k).on("fxssettingspagetrigger",function(o){if(d("#PasswordInput",k).val()!==""&&d("#PasswordInput",k).data("isEmpty")==="true"){d("#PasswordInput",k).data("isEmpty","false")}if(d("#UsernameInput",k).val()===""||d("#PasswordInput",k).data("isEmpty")==="true"||(d("#PasswordInput",k).val()===""&&d("#PasswordInput",k).data("isEmpty")==="true")||d("#DomainInput",k).val()===""||d("#ProxyServerInput",k).val()===""||d("#ProxyPortInput",k).val()===""){b.alert(b.i18n.msg("SETTINGS_REQUIRED_ERROR"))}else{d.mobile.loading("show",{text:b.i18n.msg("HOME_SUBMIT_MODIF"),textVisible:true});d("#ApplyButton",k).addClass("ui-disabled");d("#ApplyButton",k).data("force-enabled",false);f(h,k,n,e)}return true})}).live("pageshow",function(){var j=d(this);d("#ApplyButton",j).addClass("ui-disabled");d("#ApplyButton",j).data("force-enabled",false)});function h(){d.mobile.loading("hide");d.mobile.changePage(c+g,{reverse:true})}function f(o,p,t,l){var k=[],q=false,s=false,r="";k.push({xpath:"Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/SIP/Networks/Network[Alias='NETWORK1']/Enable",value:"true"});k.push({xpath:"Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/SIP/Clients/Client[Alias='"+l+"']/Enable",value:"true"});if(d("#DomainInput",p).input("modified")){s=true;k.push({xpath:d("#DomainInput",p).data("xpath"),value:d("#DomainInput",p).val()})}if(d("#TelephoneNumberInput",p).input("modified")){q=true}if(s||q){for(var n=0;n<a.length;n++){var m=a[n];r="";if(m.Alias===l){r="sip:"+d("#TelephoneNumberInput",p).val()+"@"+d("#DomainInput",p).val();k.push({xpath:"Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/SIP/Clients/Client[Alias='"+m.Alias+"']/RegisterURI",value:r})}else{if(m.RegisterURI!==""&&s){var u=m.RegisterURI.split("@");u[1]=d("#DomainInput",p).val();r=u.join("@");k.push({xpath:"Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/SIP/Clients/Client[Alias='"+m.Alias+"']/RegisterURI",value:r})}}}}if(d("#UsernameInput",p).input("modified")){k.push({xpath:d("#UsernameInput",p).data("xpath"),value:d("#UsernameInput",p).val()})}if(d("#PasswordInput",p).input("modified")){k.push({xpath:d("#PasswordInput",p).data("xpath"),value:d("#PasswordInput",p).val()})}if(d("#PhoneEnableCheck",p).select("modified")){k.push({xpath:d("#PhoneEnableCheck",p).data("xpath"),value:d("#PhoneEnableCheck",p).val()})}if(d("#TransportInput",p).select("modified")){k.push({xpath:d("#TransportInput",p).data("xpath"),value:d("#TransportInput",p).val()})}if(d("#OLOEnableCheck",p).select("modified")){k.push({xpath:d("#OLOEnableCheck",p).data("xpath"),value:d("#OLOEnableCheck",p).val()})}if(d("#ProxyServerInput",p).input("modified")){k.push({xpath:d("#ProxyServerInput",p).data("xpath"),value:d("#ProxyServerInput",p).val()})}if(d("#ProxyPortInput",p).input("modified")){k.push({xpath:d("#ProxyPortInput",p).data("xpath"),value:d("#ProxyPortInput",p).val()})}k.push({xpath:"Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/SIP/Clients/Client[Alias='"+l+"']/StaticOrigin",value:"GUI"});function j(x){var w=d.gui.client.newRequest();for(var v=0;v<x.length;v++){w.setValue(x[v].xpath,x[v].value)}w.send(h)}j(k)}});jQuery(function(c){var a=c.gui;c(document).delegate("#PhoneHistoryPage","pagebeforecreate",function(){var f=c(this),h=c.QueryString(f.data("url")),j=h.line.split(","),d=h.lineid.split(","),e=h.index,g=a.client.newRequest();c("#PhoneName",f).text(a.i18n.msg("HOME_PHONE")+" "+e);c("#PhoneCallTestStatus1",f).attr("data-xpath",c("#PhoneCallTestStatus1",f).attr("data-xpath").replace("'#FXSALIAS#'","'FXS"+e+"'"));c("#PhoneCallTestStatus2",f).attr("data-xpath",c("#PhoneCallTestStatus2",f).attr("data-xpath").replace("'#FXSALIAS#'","'FXS"+e+"'"));if(j.length===1){if(d[0]==="1"){c("#CallStatusLine2",f).remove()}else{c("#CallStatusLine1",f).remove()}}}).delegate("#PhoneHistoryPage","pagecreate",function(){var j=c(this),h=c("#PhoneHistoryList",j),e=c.QueryString(j.data("url")),m=e.line.split(","),k=e.lineid.split(","),l=a.client.newRequest();c("#RegisterSipUriLine1",j).bind("itemvalue",function(p,q){var o=q.value.split("@")[0].replace("sip:","");c("#DirectoryNumberLine1",j).text(o)});c("#RegisterSipUriLine2",j).bind("itemvalue",function(p,q){var o=q.value.split("@")[0].replace("sip:","");c("#DirectoryNumberLine2",j).text(o)});var n=c('<table id="phoneHistoryListTable" >'),f=1,g,d;h.hide().after(n).bind("arraybeforeinsert",function(q,r){if(m.length===1){if(r.value.UsedLine!=="Device/Services/VoiceServices/VoiceService[@uid='1']/CallControl/Lines/Line[@uid='"+k[0]+"']"){return}}var s="history"+f,o,p=r.value.uid;if(r.value.Direction==="INCOMING"){r.value.Number=r.value.CallingPartyNumber;r.value.CallType="IncomingCall";if(r.value.CallTerminationCause==="Termination_called_is_busy"){r.value.CallType="MissedCall"}}else{r.value.Number=r.value.CalledPartyNumber;r.value.CallType="OutgoingCall"}n.jqGrid("addRowData",s,r.value);o=n.find("#"+s).object({connected:false,objset:null});c(o).data("call-log-id",p);r.item=o.data("xmo-item");r.item.current(r.value,r.capability,r.xpath);o.find(".gui-table-delete-row").click(function(t){n.jqGrid("delRowData",s)}).end();d=s;f++});n.jqGrid({datatype:"local",height:200,colNames:[a.i18n.msg("PHONE_TYPE"),a.i18n.msg("PHONE_NUMBER"),a.i18n.msg("PHONE_WHEN"),a.i18n.msg("PHONE_DURATION")],colModel:[{name:"CallType",index:"CallType",width:70,sortable:false,resizable:false,editable:false,align:"center",formatter:function(o,p,q){if(o==="IncomingCall"){return'<img src="../../../img/icon-incoming.png" />'}else{if(o==="OutgoingCall"){return'<img src="../../../img/icon-outgoing.png" />'}else{return'<img src="../../../img/icon-missed.png" />'}}},cellattr:function(q,s,p,o,r){return' data-label="'+a.i18n.msg("PHONE_TYPE")+'"'}},{name:"Number",index:"Number",width:130,sortable:false,resizable:false,editable:true,cellattr:function(q,s,p,o,r){return' data-label="'+a.i18n.msg("PHONE_NUMBER")+'"'}},{name:"Start",index:"Start",width:130,sortable:false,resizable:false,editable:true,formatter:function(p,q,r){var o=new Date(p);return(("0"+o.getDate()).slice(-2)+"/"+("0"+(o.getMonth()+1)).slice(-2)+"/"+o.getFullYear().toString()+" "+("0"+o.getHours()).slice(-2)+":"+("0"+o.getMinutes()).slice(-2)+":"+("0"+o.getSeconds()).slice(-2))},cellattr:function(q,s,p,o,r){return' data-label="'+a.i18n.msg("PHONE_WHEN")+'"'}},{name:"Duration",index:"Duration",width:130,sortable:false,resizable:false,editable:true,formatter:function(o,p,r){var q=b(o);return q},cellattr:function(q,s,p,o,r){return' data-label="'+a.i18n.msg("PHONE_DURATION")+'"'}}],scrollOffset:0,caption:h.children("li:first").text(),forceFit:true,editurl:"clientArray",onSelectRow:function(o){return false}}).parents("div.ui-jqgrid").addClass("gui-table")}).delegate("#PhoneHistoryPage","pageshow",function(){var g=c(this),h=c.QueryString(g.data("url")),e=h.index,f=a.client.newRequest(),d=a.client.newRequest();c("#StartRingTestButton1",g).closest(".ui-btn").on("click",function(j){c("#StartRingTestButton1",g).closest(".ui-btn").addClass("ui-disabled");f.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/POTS/FXSs/FXS[Alias='FXS"+e+"']/DiagTests/TestSelector","RING_TEST",function(){});f.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/POTS/FXSs/FXS[Alias='FXS"+e+"']/DiagTests/DiagnosticsState","REQUESTED",function(){});f.send(function(){d.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/POTS/FXSs/FXS[Alias='FXS"+e+"']/DiagTests/DiagnosticsState","NONE",function(){});d.send()})});c("#PhoneCallTestStatus1",g).change(function(){if(c("#PhoneCallTestStatus1",g).find("p").html()==="COMPLETE"){c("#StartRingTestButton1",g).closest(".ui-btn").removeClass("ui-disabled")}});c("#StartRingTestButton2",g).closest(".ui-btn").on("click",function(j){c("#StartRingTestButton2",g).closest(".ui-btn").addClass("ui-disabled");f.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/POTS/FXSs/FXS[Alias='FXS"+e+"']/DiagTests/TestSelector","RING_TEST",function(){});f.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/POTS/FXSs/FXS[Alias='FXS"+e+"']/DiagTests/DiagnosticsState","REQUESTED",function(){});f.send(function(){d.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/POTS/FXSs/FXS[Alias='FXS"+e+"']/DiagTests/DiagnosticsState","NONE",function(){});d.send()})});c("#PhoneCallTestStatus2",g).change(function(){if(c("#PhoneCallTestStatus2",g).find("p").html()==="COMPLETE"){c("#StartRingTestButton2",g).closest(".ui-btn").removeClass("ui-disabled")}})});function b(h){var g=parseInt(h,10);var d=Math.floor(g/3600);var e=Math.floor((g-(d*3600))/60);var h=g-(d*3600)-(e*60);if(d<10){d="0"+d}if(e<10){e="0"+e}if(h<10){h="0"+h}var f=d+":"+e+":"+h;return f}});jQuery(function(d){var a=d.gui,j=[],n=[],l=[],h=[],b=[],k=[],e=[],c={},f="/"+a.opt.GUI_VERSION_OPT+"/gui/tpl/src/",g="home/home.html";d(document).delegate("#DectSettingsPage","pagebeforecreate",function(){var t=d(this),q=d.QueryString(t.data("url")),v=a.client.newRequest();k=[];v.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/IncomingMaps",function(y){b=y});v.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/Lines ",function(y){n=y});v.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/SIP/Clients",function(y){l=y});v.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/Extensions",function(y){h=y});v.getValue("Device/Services/VoiceServices/VoiceService[@uid='1']/DECT/Portables",function(y){e=y});v.send({synchronous:true});for(var s=0;s<n.length;s++){var x=n[s];var p=searchFirstOccurence(l,getAliasFromXPath(x.Provider),"Alias");k[s]={id:"fxs_"+x.uid,uid:x.uid,description:"fxs_"+x.uid,directoryNumber:(x.Status!=="UP")?a.i18n.msg("HOME_NOT_REGISTERED"):p.RegisterURI.split("@")[0].replace("sip:",""),type:"fxs",enabled:true,devices:[]};for(var r=0;r<b.length;r++){var u=b[r];if(u.Line==="Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/Lines/Line[Alias='"+x.Alias+"']"){var w=searchFirstOccurence(h,getAliasFromXPath(u.Extension),"Alias");var o={};if(w.Provider.indexOf("DECT")!==-1){o=searchFirstOccurence(e,getAliasFromXPath(w.Provider),"Alias")}k[s].devices.push({id:((w.Provider.indexOf("FXSs")!==-1)?"FXS":"DECT")+"_"+w.uid,uid:w.uid,lineId:x.uid,lineAlias:x.Alias,description:w.Name,mapId:u.uid,enabled:((w.Provider.indexOf("FXSs")!==-1)?true:o.RegistrationStatus==="IN_REACH"),active:u.Enable})}}}}).delegate("#DectSettingsPage","pagecreate",function(){var s=d(this),q=d("#TelephonesMatrixList",s);d("#dectSettingsListTable").remove();d("#dectSettingsListTable",s).remove();var r=d('<table id="dectSettingsListTable" >'),t=1,v,p;function o(z){var w=d("#"+z,r),y=w.item("value");var x=r.jqGrid("getRowData",z);y=d.extend({},y,r.jqGrid("getRowData",z));w.item("value",y)}q.hide().after(r).bind("arraybeforeinsert",function(x,y){var z="phonematrix"+t,w;r.jqGrid("addRowData",z,y.value);w=r.find("#"+z).object({connected:false,objset:null});d(w).addClass("not-editable-row");y.item=w.data("xmo-item");y.item.current(y.value,y.capability,y.xpath);p=z;t++}).bind("arraypostactions",function(w,x){if(v){r.jqGrid("saveRow",v);o(v);v=undefined}});console.warn("deviceMatrix");console.warn(k);var u=[];u.push(a.i18n.msg("DECT_LINES"));for(var t=0;t<h.length;t++){u.push(h[t].Name)}r.jqGrid({datatype:"local",data:k,height:200,colNames:u,colModel:[{index:"directoryNumber",name:"directoryNumber",width:230,sortable:false,resizable:false,editable:true,formatter:function(x,w){return a.i18n.msg("DECT_LINE")+" "+w.rowId.replace("fxs_","")+" ("+x+")"},cellattr:function(y,A,x,w,z){return' data-label="'+a.i18n.msg("DECT_LINES")+'"'}},{name:"devices",index:"devices",width:90,sortable:false,resizable:false,editable:true,formatter:function(y,x){var w="";if(y[x.pos-1].active){w+=' checked="checked"'}if(!y[x.pos-1].enabled){w+=' disabled="disabled"'}return'<input data-line-alias="'+y[x.pos-1].lineAlias+'"  data-xmo-role="radio" type="checkbox" value="'+y[x.pos-1].mapId+'" name="radio_'+x.pos+'" '+w+" />"},cellattr:function(y,A,x,w,z){return' data-label="'+u[1]+'"'}},{name:"devices",index:"devices",width:90,sortable:false,resizable:false,editable:true,formatter:function(y,x){var w="";if(y[x.pos-1].active){w+=' checked="checked"'}if(!y[x.pos-1].enabled){w+=' disabled="disabled"'}return'<input data-line-alias="'+y[x.pos-1].lineAlias+'" data-xmo-role="radio" type="checkbox" value="'+y[x.pos-1].mapId+'" name="radio_'+x.pos+'" '+w+" />"},cellattr:function(y,A,x,w,z){return' data-label="'+u[2]+'"'}},{name:"devices",index:"devices",width:90,sortable:false,resizable:false,editable:true,formatter:function(y,x){var w="";if(y[x.pos-1].active){w+=' checked="checked"'}if(!y[x.pos-1].enabled){w+=' disabled="disabled"'}return'<input data-line-alias="'+y[x.pos-1].lineAlias+'" data-xmo-role="radio" type="checkbox" value="'+y[x.pos-1].mapId+'" name="radio_'+x.pos+'" '+w+" />"},cellattr:function(y,A,x,w,z){return' data-label="'+u[3]+'"'}},{name:"devices",index:"devices",width:90,sortable:false,resizable:false,editable:true,formatter:function(y,x){var w="";if(y[x.pos-1].active){w+=' checked="checked"'}if(!y[x.pos-1].enabled){w+=' disabled="disabled"'}return'<input data-line-alias="'+y[x.pos-1].lineAlias+'" data-xmo-role="radio" type="checkbox" value="'+y[x.pos-1].mapId+'" name="radio_'+x.pos+'" '+w+" />"},cellattr:function(y,A,x,w,z){return' data-label="'+u[4]+'"'}},{name:"devices",index:"devices",width:90,sortable:false,resizable:false,editable:true,formatter:function(y,x){var w="";if(y[x.pos-1].active){w+=' checked="checked"'}if(!y[x.pos-1].enabled){w+=' disabled="disabled"'}return'<input data-line-alias="'+y[x.pos-1].lineAlias+'" data-xmo-role="radio" type="checkbox" value="'+y[x.pos-1].mapId+'" name="radio_'+x.pos+'" '+w+" />"},cellattr:function(y,A,x,w,z){return' data-label="'+u[5]+'"'}},{name:"devices",index:"devices",width:90,sortable:false,resizable:false,editable:true,formatter:function(y,x){var w="";if(y[x.pos-1].active){w+=' checked="checked"'}if(!y[x.pos-1].enabled){w+=' disabled="disabled"'}return'<input data-line-alias="'+y[x.pos-1].lineAlias+'" data-xmo-role="radio" type="checkbox" value="'+y[x.pos-1].mapId+'" name="radio_'+x.pos+'" '+w+" />"},cellattr:function(y,A,x,w,z){return' data-label="'+u[6]+'"'}}],scrollOffset:0,caption:q.children("li:first").text(),forceFit:true,editurl:"clientArray",onSelectRow:function(w){return false}}).parents("div.ui-jqgrid").addClass("gui-table")}).delegate("#DectSettingsPage","pageshow",function(){var q=d(this),s=a.client.newRequest(),p=false,r={},o={};d("#ApplyButton",q).on("dectpagetrigger",function(t){if(!d.isEmptyObject(o)){d.mobile.loading("show",{text:a.i18n.msg("HOME_SUBMIT_MODIF"),textVisible:true});d("#ApplyButton",q).data("force-enabled",false);d("#ApplyButton",q).disable();console.log("matrixReferences");console.log(o);d.each(o,function(u,v){s.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/IncomingMaps/IncomingMap[@uid='"+v.LINE1.mapId+"']/Enable",v.LINE1.mapState);s.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/OutgoingMaps/OutgoingMap[@uid='"+v.LINE1.mapId+"']/Enable",v.LINE1.mapState);s.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/IncomingMaps/IncomingMap[@uid='"+v.LINE2.mapId+"']/Enable",v.LINE2.mapState);s.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/OutgoingMaps/OutgoingMap[@uid='"+v.LINE2.mapId+"']/Enable",(v.LINE1.mapState?false:v.LINE2.mapState))});s.send(m);o={}}return true});d("input[type=checkbox]").off("click").on("click",function(w){var v=d(this).attr("name");var u=d("input[name="+v+"]",q)["0"];var t=d("input[name="+v+"]",q)["1"];o[d(this).attr("name")]={LINE1:{mapId:d(u,q).val(),mapState:d(u,q).is(":checked")},LINE2:{mapId:d(t,q).val(),mapState:d(t,q).is(":checked")}};console.log("--- matrixReferences ---");console.log(o);if(d.isEmptyObject(o)){d("#ApplyButton",q).data("force-enabled",false);d("#ApplyButton",q).disable()}else{d("#ApplyButton",q).data("force-enabled",true);d("#ApplyButton",q).enable()}})});function m(){d.mobile.loading("hide");d.mobile.changePage(f+g,{reverse:true})}});jQuery(function(f){var b=f.gui,a,c,e="/"+b.opt.GUI_VERSION_OPT+"/gui/tpl/src/",g="home/home.html";f(document).delegate("#DectHandsetPage","pagebeforecreate",function(){var j=f(this),l=f.QueryString(j.data("url")),k=b.client.newRequest();a=l.handset;c=l.dect;f(":jqmData(xpath)",j).each(function(){var n=f(this),m=n.attr("data-xpath");m=m.replace("#ExtensionAlias#",a);m=m.replace("#DectAlias#",c);n.attr("data-xpath",m)})}).delegate("#DectHandsetPage","pagecreate",function(){var o=f(this),m=f("#PhoneHistoryList",o),k=f.QueryString(o.data("url")),p=k.line.split(","),r=f('<table id="phoneHistoryListTable" >'),l=1,n,j,q=b.client.newRequest();m.hide().after(r).bind("arraybeforeinsert",function(u,v){if(p.length===0){return}else{if(p.length===1){if(v.value.UsedLine!=="Device/Services/VoiceServices/VoiceService[@uid='1']/CallControl/Lines/Line[@uid='"+p[0]+"']"){return}}}var w="history"+l,s,t=v.value.uid;if(v.value.Direction==="INCOMING"){v.value.Number=v.value.CallingPartyNumber;v.value.CallType="IncomingCall";if(v.value.CallTerminationCause==="Termination_called_is_busy"){v.value.CallType="MissedCall"}}else{v.value.Number=v.value.CalledPartyNumber;v.value.CallType="OutgoingCall"}r.jqGrid("addRowData",w,v.value);s=r.find("#"+w).object({connected:false,objset:null});f(s).data("call-log-id",t);v.item=s.data("xmo-item");delete v.value.SignalingPerformances;delete v.value.Sessions;v.item.current(v.value,v.capability,v.xpath);s.find(".gui-table-delete-row").click(function(x){r.jqGrid("delRowData",w)}).end();j=w;l++});r.jqGrid({datatype:"local",height:200,colNames:[b.i18n.msg("PHONE_TYPE"),b.i18n.msg("PHONE_NUMBER"),b.i18n.msg("PHONE_WHEN"),b.i18n.msg("PHONE_DURATION")],colModel:[{name:"CallType",index:"CallType",width:70,sortable:false,resizable:false,editable:false,align:"center",formatter:function(s,t,u){if(s==="IncomingCall"){return'<img src="../../../img/icon-incoming.png" />'}else{if(s==="OutgoingCall"){return'<img src="../../../img/icon-outgoing.png" />'}else{return'<img src="../../../img/icon-missed.png" />'}}},cellattr:function(u,w,t,s,v){return' data-label="'+b.i18n.msg("PHONE_TYPE")+'"'}},{name:"Number",index:"Number",width:130,sortable:false,resizable:false,editable:true,cellattr:function(u,w,t,s,v){return' data-label="'+b.i18n.msg("PHONE_NUMBER")+'"'}},{name:"Start",index:"Start",width:130,sortable:false,resizable:false,editable:true,formatter:function(t,u,v){var s=new Date(t);return(("0"+s.getDate()).slice(-2)+"/"+("0"+(s.getMonth()+1)).slice(-2)+"/"+s.getFullYear().toString()+" "+("0"+s.getHours()).slice(-2)+":"+("0"+s.getMinutes()).slice(-2)+":"+("0"+s.getSeconds()).slice(-2))},cellattr:function(u,w,t,s,v){return' data-label="'+b.i18n.msg("PHONE_WHEN")+'"'}},{name:"Duration",index:"Duration",width:130,sortable:false,resizable:false,editable:true,formatter:function(s,t,v){var u=d(s);return u},cellattr:function(u,w,t,s,v){return' data-label="'+b.i18n.msg("PHONE_DURATION")+'"'}}],scrollOffset:0,caption:m.children("li:first").text(),forceFit:true,editurl:"clientArray",onSelectRow:function(s){return false}}).parents("div.ui-jqgrid").addClass("gui-table")}).delegate("#DectHandsetPage","pageshow",function(){var j=f(this),k=b.client.newRequest();f("#UnpairButton",j).closest(".ui-btn").on("click",function(l){f("#UnpairButton",j).closest(".ui-btn").addClass("ui-disabled");k.remoteCall("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/DECT/Portables/Portable[Alias='"+c+"']","unPair");k.send(function(){b.alert("Dect is UnPaired",{callbackClose:function(){h()}});f("#UnpairButton",j).closest(".ui-btn").removeClass("ui-disabled")})})});function h(){f.mobile.changePage(e+g,{reverse:true})}function d(n){var m=parseInt(n,10);var j=Math.floor(m/3600);var k=Math.floor((m-(j*3600))/60);var n=m-(j*3600)-(k*60);if(j<10){j="0"+j}if(k<10){k="0"+k}if(n<10){n="0"+n}var l=j+":"+k+":"+n;return l}});jQuery(function(c){var a=c.gui,b=[];c(document).delegate("#DectBaseSettingsPage","pagebeforecreate",function(){var d=c(this),e=a.client.newRequest();e.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/Extensions",function(f){b=f});e.send({synchronous:true})}).delegate("#DectBaseSettingsPage","pageshow",function(){var d=c(this),g=[],h=[],f=a.client.newRequest();function k(){var l=a.client.newRequest(),m;g=[];l.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/DECT/Portables/Portable[RegistrationStatus='IN_REACH']",function(o,n){m=searchFirstOccurence(b,"Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/DECT/Portables/Portable[Alias='"+o.Alias+"']","Provider");o.extension=m;g.push(o)});l.send({synchronous:true});return g}var h=k(),j=h.length;c("#HandsetSelect option[value!='ALL']",d).remove();c("#HandsetSelect",d).refresh(true);if(j){for(var e=0;e<j;e++){c("#HandsetSelect",d).append(c("<option></option>").attr("value",h[e].Alias).text(h[e].extension.Name))}}else{c("#StartPagingButton",d).closest(".ui-btn").addClass("ui-disabled")}c("#ConnectedDectsCount",d).text(j);c("#StartPairingButton",d).closest(".ui-btn").on("click",function(l){if(j<4){c("#StartPairingButton",d).closest(".ui-btn").addClass("ui-disabled");f.remoteCall("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/DECT/Bases/Base[Alias ='DECT_FP1']","startPairing");f.send();c('<div id="HandsetPairingProgress">').simpledialog2({mode:"blank",width:"300px",themeDialog:"d",showModal:false,blankContent:"<br><br><br>"+a.i18n.msg("DECTBASE_PAIRING_NOTICE")+"<br><br><br>"})}else{a.alert(a.i18n.msg("DECTBASE_MAX_REACHED"))}});c("#DectPairingTestStatus",d).change(function(){if(c("#DectPairingTestStatus",d).find("p").html()==="None"){var m=k(),o,l;if(typeof c.mobile.sdCurrentDialog!=="undefined"){c.mobile.sdCurrentDialog.close()}c(document).trigger("simpledialog",{method:"close"});if(m.length>j){c("#ConnectedDectsCount",d).text(m.length);c("#ConnectedDectsLi").closest("li").effect("highlight",{color:"#00bbed"},500);c("#StartPagingButton",d).closest(".ui-btn").removeClass("ui-disabled");var n=m[m.length-1];c("#HandsetSelect",d).append(c("<option></option>").attr("value",n.Alias).text(n.extension.Name));o=c("input[type=checkbox]:disabled","#dectSettingsListTable").first().parent().parent();l=o.index();o.closest("table#dectSettingsListTable").find("tr td:nth-child("+(l+1)+") div.ui-checkbox").removeClass("ui-disabled");o.closest("table#dectSettingsListTable").find("tr td:nth-child("+(l+1)+") input").prop("disabled",false);j++}c("#StartPairingButton",d).closest(".ui-btn").removeClass("ui-disabled")}});c("#StartPagingButton",d).closest(".ui-btn").off("click").on("click",function(o){var n=c("#HandsetSelect",d).val();var m=a.client.newRequest(),l=a.client.newRequest();if(n==="ALL"){m.remoteCall("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/DECT/Bases/Base[Alias ='DECT_FP1']","startPaging");m.send()}else{l.remoteCall("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/DECT/Portables/Portable[Alias ='"+n+"']","startPaging");l.send()}});c("#ResetBaseButton",d).closest(".ui-btn").off("click").on("click",function(n){c("#ResetBaseButton",d).closest(".ui-btn").addClass("ui-disabled");var m=a.client.newRequest(),l=a.client.newRequest();m.setValue("Device/Services/VoiceServices/VoiceService[@uid='1']/DECT/Bases/Base[@uid='1']/Reset",true,function(){c("#ResetBaseButton",d).closest(".ui-btn").removeClass("ui-disabled");c("<div>").simpledialog2({mode:"button",buttonPrompt:"<br/>"+a.i18n.msg("DECTBASE_RESET_SUCCESS")+"<br/><br/><br/>",themeDialog:"d",showModal:false,buttons:{OK:{text:a.i18n.msg("HOME_OK"),click:function(){},theme:"b"}}})});m.send()});c("#DectPinCodeInput",d).keydown(function(l){if(c.inArray(l.keyCode,[46,8,9,27,13])!==-1||(l.keyCode==65&&(l.ctrlKey===true||l.metaKey===true))||(l.keyCode>=35&&l.keyCode<=40)){return}if((l.keyCode<48||l.keyCode>57)&&(l.keyCode<96||l.keyCode>105)){l.preventDefault()}})})});jQuery(function(e){var a=e.gui,d="/"+a.opt.GUI_VERSION_OPT+"/gui/tpl/src/",f="home/home.html";e(document).delegate("#CallSettingsPage","pagebeforecreate",function(){var h=e(this),j=a.client.newRequest()}).delegate("#CallSettingsPage","pagecreate",function(){var n=e(this),o=e("#VoiceSettingsCallSettingsList",n),p=e.gui.client.newRequest(),q=e('<table id="callSettingsListTable" >'),l=1,m,j,k={};function h(t){var r=e("#"+t,q),s=r.item("value");s=e.extend({},s,q.jqGrid("getRowData",t));if(s.hasOwnProperty("Criteria")&&s.Criteria==="NUMBERBEGINSBY"){s.DigitMap=s.DigitMap+"x."}else{s.DigitMap=s.DigitMap}r.item("value",s)}o.hide().after(q).bind("arraybeforeinsert",function(u,v){if(v.value.Alias!=="OUTGOINGCALL"){if(v.value.Alias!==undefined){k[v.value.Type]=v.value}var x=v.value.DigitMap.replace(/[()]/g,"").split("|");for(var s=0;s<x.length;s++){var w="callsetting"+l,r;var t=v;if(x[s].indexOf("x.")!==-1){t.value.DigitMap=x[s].replace(/[()]/g,"").replace("x.","");t.value.Criteria="NUMBERBEGINSBY"}else{t.value.DigitMap=x[s].replace(/[()]/g,"");t.value.Criteria="NUMBERIS"}q.jqGrid("addRowData",w,t.value);r=q.find("#"+w).object({connected:false,objset:null});t.item=r.data("xmo-item");delete t.value.Criteria;t.item.current(t.value,t.capability,t.xpath);r.find(".gui-table-delete-row").click(function(z){var y=e(this);q.jqGrid("delRowData",y.parent("tr").attr("id"))}).end();j=w;l++}}}).bind("arraypostactions",function(r,s){if(m){q.jqGrid("saveRow",m);h(m);m=undefined}}).bind("arraybeforesubmit",function(t,u){var s=e("#callSettingsListTable",n).jqGrid("getRowData");var w="(";var v={};for(var r=0;r<s.length;r++){if(s[r].Type==="INCOMINGCALL_BLACKLIST"||s[r].Type==="OUTGOINGCALL_BLACKLIST"){if(v[s[r].Type]===undefined){v[s[r].Type]="";v[s[r].Type]+=s[r].DigitMap}else{v[s[r].Type]+="|"+s[r].DigitMap}if(s[r].Criteria==="NUMBERBEGINSBY"){v[s[r].Type]+="x."}}}e.each(v,function(y,z){if(k[y]!==undefined){p.setValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/NumberingPlans/NumberingPlan[Alias='NUMBERINGPLAN1']/DigitMaps/DigitMap[Type='"+y+"']/DigitMap","("+v[y].replace(/\+/g,"00")+")")}else{var x={Enable:true,Type:y,DigitMap:"("+v[y].replace(/\+/g,"00")+")"};p.addChild("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/NumberingPlans/NumberingPlan[Alias='NUMBERINGPLAN1']/DigitMaps",{DigitMap:x})}});e.each(k,function(x,y){if(!e.isEmptyObject(v)){e.each(v,function(z,A){if(!v.hasOwnProperty(x)&&k.hasOwnProperty(x)){p.deleteElement("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/NumberingPlans/NumberingPlan[Alias='NUMBERINGPLAN1']/DigitMaps/DigitMap[Type='"+x+"']")}})}else{p.deleteElement("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/NumberingPlans/NumberingPlan[Alias='NUMBERINGPLAN1']/DigitMaps/DigitMap[Type='"+x+"']")}});if(e("#DoNotDisturbeEnable1",n).select("modified")){p.send()}else{p.send(g)}return false});q.jqGrid({datatype:"local",height:200,colNames:[a.i18n.msg("VOICESETTINGS_CALL_TYPE"),a.i18n.msg("VOICESETTINGS_CRITERIA"),a.i18n.msg("VOICESETTINGS_NUMBER"),a.i18n.msg("VOICESETTINGS_DELETE")],colModel:[{name:"Type",index:"Type",width:210,sortable:false,resizable:false,editable:true,edittype:"select",editoptions:{value:"INCOMINGCALL_BLACKLIST:"+a.i18n.msg("VOICESETTINGS_INCOMING")+";OUTGOINGCALL_BLACKLIST:"+a.i18n.msg("VOICESETTINGS_OUTGOING"),dataEvents:[{type:"change",fn:function(s){var r=e(s.target).val()}}]},formatter:function(r,s,t){if(r==="INCOMINGCALL_BLACKLIST"){return a.i18n.msg("VOICESETTINGS_INCOMING")}else{if(r==="OUTGOINGCALL_BLACKLIST"){return a.i18n.msg("VOICESETTINGS_OUTGOING")}else{return r||" "}}},unformat:function(s,t,r){if(s===a.i18n.msg("VOICESETTINGS_INCOMING")){return"INCOMINGCALL_BLACKLIST"}else{if(s===a.i18n.msg("VOICESETTINGS_OUTGOING")){return"OUTGOINGCALL_BLACKLIST"}else{return s}}},cellattr:function(t,v,s,r,u){return' data-label="'+a.i18n.msg("VOICESETTINGS_CALL_TYPE")+'"'}},{name:"Criteria",index:"Criteria",width:210,sortable:false,resizable:false,editable:true,edittype:"select",editoptions:{value:"NUMBERIS:"+a.i18n.msg("VOICESETTINGS_NUMBER_IS")+";NUMBERBEGINSBY:"+a.i18n.msg("VOICESETTINGS_NUMBER_BEGINS_BY"),dataEvents:[{type:"change",fn:function(r){}}]},formatter:function(r,s,t){if(r==="NUMBERIS"){return a.i18n.msg("VOICESETTINGS_NUMBER_IS")}else{if(r==="NUMBERBEGINSBY"){return a.i18n.msg("VOICESETTINGS_NUMBER_BEGINS_BY")}else{return r||" "}}},unformat:function(s,t,r){if(s===a.i18n.msg("VOICESETTINGS_NUMBER_IS")){return"NUMBERIS"}else{if(s===a.i18n.msg("VOICESETTINGS_NUMBER_BEGINS_BY")){return"NUMBERBEGINSBY"}else{return s}}},cellattr:function(t,v,s,r,u){return' data-label="'+a.i18n.msg("VOICESETTINGS_CRITERIA")+'"'}},{name:"DigitMap",index:"DigitMap",width:210,sortable:false,resizable:false,editable:true,cellattr:function(t,v,s,r,u){return' data-label="'+a.i18n.msg("VOICESETTINGS_NUMBER")+'"'}},{name:"Delete",index:"Delete",width:90,sortable:false,resizable:false,classes:"gui-table-delete-row",cellattr:function(t,v,s,r,u){return' data-label="'+a.i18n.msg("VOICESETTINGS_DELETE")+'"'}}],scrollOffset:0,caption:o.children("li:first").text(),forceFit:true,editurl:"clientArray",onSelectRow:function(s){var r={keys:true,aftersavefunc:function(t){c(q,q.jqGrid("getRowData",t),t);h(t);q.jqGrid("resetSelection");m=undefined}};if(s&&s!==m){q.jqGrid("saveRow",m);h(m);q.jqGrid("editRow",s,r);q.data("editedrow",s);m=s}}}).parents("div.ui-jqgrid").addClass("gui-table");e("#VoiceSettingsCallBlockingAdd",n).click(function(r){m=q.data("editedrow");if(m){q.jqGrid("saveRow",m);h(m);if(!e.isEmptyObject(q.jqGrid("getRowData",m))){c(q,q.jqGrid("getRowData",m),m)}m=undefined}r.preventDefault();r.stopImmediatePropagation();var s={Type:"INCOMINGCALL_BLACKLIST",Criteria:"NUMBERIS",DigitMap:""};o.array("insert",-1,s,new a.api.Capability({name:"DigitMap"}));q.jqGrid("setSelection",j)});e("#ApplyButton",n).on("callsettingspagetrigger",function(r,t,s){if(m!=undefined){q.jqGrid("saveRow",m);h(m);if(q[0].p.data.length>0){if(e("#"+m).length){if(c(q,q.jqGrid("getRowData",m),m)==true){return true}}}}})}).delegate("#CallSettingsPage","pagebeforeshow",function(){var h=e(this);e("#DoNotDisturbeEnable1",h).change(function(){e("#DoNotDisturbeEnable2",h).item("current",e(this).val());e("#DoNotDisturbeEnable2",h).item("value",e(this).val());e("#DoNotDisturbeEnable2",h).val(e(this).val());e("#DoNotDisturbeEnable2",h).select("modified",e("#DoNotDisturbeEnable1",h).select("modified"))})});function g(){e.mobile.loading("hide");e.mobile.changePage(d+f,{reverse:true})}function c(l,j,m){var h="",k=/^\+?\d+$/;if(j.DigitMap===""||!k.test(j.DigitMap)){h=b(h,a.i18n.msg("VOICESETTINGS_NUMBER_ERROR"))}if(h.length>0){a.alert(h);l.jqGrid("delRowData",m);return true}return false}function b(h,j){if(h.indexOf(j)==-1){h+=j+"\n"}return h}});jQuery(function($){var gui=$.gui,options="",listContactsImport,phonebookContacts,childrenNumbers=[],prefix="/"+gui.opt.GUI_VERSION_OPT+"/gui/tpl/src/",home="home/home.html";$(document).delegate("#PhonebookPage","pagebeforecreate",function(){var $page=$(this),req=gui.client.newRequest(),lines=[];options="";req.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/Lines",function(value){lines=[];lines=value;for(var i=0;i<lines.length;i++){options+="<option value='"+lines[i].Alias+"'>"+gui.i18n.msg("PHONEBOOK_LINE")+" "+(i+1)+" : "+lines[i].DirectoryNumber+"</option>"}});req.send({synchronous:true})}).delegate("#PhonebookPage","pagecreate",function(){var $page=$(this),$phonebooklist=$("#PhonebookContactsList",$page),req=gui.client.newRequest(),$table=$('<table id="phonebookContactsListTable" >'),i=1,editedrow,newid,tableRows;function saveRowValue(id){var $row=$("#"+id,$table),val=$row.item("value");val=$.extend({},val,$table.jqGrid("getRowData",id));$row.item("value",val)}phonebookContacts=[];$phonebooklist.hide().after($table).bind("arraybeforeinsert",function(event,data){var id="contact"+i,$row;for(var j=0;j<data.value.Numbers.length;j++){var number=data.value.Numbers[j];if(number.Type==="Home"){data.value.HomePhoneNumber=number.Number||""}else{if(number.Type==="Mobile"){data.value.MobilePhoneNumber=number.Number||""}else{if(number.Type==="Work"){data.value.WorkPhoneNumber=number.Number||""}}}}$table.jqGrid("addRowData",id,data.value);$row=$table.find("#"+id).object({connected:false,objset:null});data.item=$row.data("xmo-item");delete data.value.Numbers;data.item.current(data.value,data.capability,data.xpath);$row.find(".gui-table-delete-row").click(function(event){$table.jqGrid("delRowData",id)}).end();phonebookContacts.push(data.value);$row.find(".gui-table-call-row").click(function(event){var row=$(this).parent(),callData={};if(row.attr("editable")==="0"||row.attr("editable")===undefined){callData=$table.getRowData(row.attr("id"));$("<div>").simpledialog2({mode:"blank",width:"300px",themeDialog:"d",showModal:false,blankContent:"<br><label>"+gui.i18n.msg("PHONEBOOK_FIRSTNAME")+" : </label> "+callData.FirstName+"<br><br><label>"+gui.i18n.msg("PHONEBOOK_LASTNAME")+" : </label> "+callData.LastName+"<br><br><select id='lineSelect'>"+options+"</select><br><select id='numberSelect'><option value='"+callData.HomePhoneNumber+"'>"+gui.i18n.msg("PHONEBOOK_HOMEPHONE")+" : "+callData.HomePhoneNumber+"</option><option value='"+callData.MobilePhoneNumber+"'>"+gui.i18n.msg("PHONEBOOK_MOBILEPHONE")+" : "+callData.MobilePhoneNumber+"</option><option value='"+callData.WorkPhoneNumber+"'>"+gui.i18n.msg("PHONEBOOK_WORKPHONE")+" : "+callData.WorkPhoneNumber+"</option></select><br><br><p align='right' data-role='footer'><a rel='close' id='CallSubmitButtonDialog' data-role='button' href='#' data-inline='true' data-mini='true' data-theme='b' data-icon='check'>"+gui.i18n.msg("PHONEBOOK_CALL")+"</a><a id='CallCancelButtonDialog' rel='close' data-role='button' href='#' data-inline='true' data-theme='d' data-mini='true' data-icon='delete'>"+gui.i18n.msg("HOME_CANCEL")+"</a></p>"});$("#CallSubmitButtonDialog").click(function(event){var lineAlias=$("#lineSelect").val();var callNumber=$("#numberSelect").val();req.remoteCall("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallControl/Lines/Line[Alias='"+lineAlias+"']","autoCall",{LastName:callData.LastName,FirstName:callData.FirstName,Number:callNumber});req.send()});$("#CallCancelButtonDialog").click(function(){$.mobile.sdCurrentDialog.close()})}return false}).end();newid=id;i++}).bind("arrayinsert",function(event,data){$("#phonebookContactsListTable tr:not(.jqgfirstrow) td:first-child").sortElements(function(a,b){if($.text([a]).toLowerCase()==$.text([b]).toLowerCase()){return 0}return $.text([a]).toLowerCase()>$.text([b]).toLowerCase()?false?-1:1:false?1:-1},function(){return this.parentNode})}).bind("arraypostactions",function(event,data){if(editedrow){$table.jqGrid("saveRow",editedrow);saveRowValue(editedrow);editedrow=undefined}}).bind("arraybeforesubmit",function(event,data){$("ApplyButton",$page).disable();var req=$.gui.client.newRequest();var addChildReq=$.gui.client.newRequest();objsetData=data;for(var i=0;i<objsetData.items.length;i++){var item=objsetData.items[i];if(item.modified()&&item._current.uid!==undefined){$.each(item._current,function(key,val){var editedRow=$("#phonebookContactsListTable",$page).jqGrid("getRowData",item.element.attr("id"));if((editedRow[key]!==undefined)&&(editedRow[key]!==item._current[key])&&(key!=="Delete"&&key!=="Call")){var xpath=item.xpath()+"/"+key;if(key==="HomePhoneNumber"){xpath=item.xpath()+"/Numbers/Number[Type='Home']/Number"}else{if(key==="MobilePhoneNumber"){xpath=item.xpath()+"/Numbers/Number[Type='Mobile']/Number"}else{if(key==="WorkPhoneNumber"){xpath=item.xpath()+"/Numbers/Number[Type='Work']/Number"}}}req.setValue(xpath,editedRow[key])}})}}for(var i=0;i<objsetData.deletedItems.length;i++){var deletedItem=objsetData.deletedItems[i];req.deleteElement(deletedItem.xpath)}for(var i=0;i<objsetData.addedItems.length;i++){var addedItem=objsetData.addedItems[i];var addedItemData=$("#phonebookContactsListTable",$page).jqGrid("getRowData",addedItem.element.attr("id"));addedItemData.Category=addedItem._current.Category;var Contact=addedItemData;var Numbers=[{Number:addedItemData.HomePhoneNumber,Type:"Home"},{Number:addedItemData.MobilePhoneNumber,Type:"Mobile"},{Number:addedItemData.WorkPhoneNumber,Type:"Work"}];(function(numbers){req.addChild("Device/Contacts/Contacts",{Contact:Contact},function(value){for(var j=0;j<numbers.length;j++){var Number=numbers[j];addChildReq.addChild(value.callbacks[0].xpath+"/Numbers",{Number:Number})}})})(Numbers)}req.send(function(){if(objsetData.addedItems.length>0){addChildReq.send(goHome)}else{goHome()}});return false});$table.jqGrid({datatype:"local",height:200,colNames:[gui.i18n.msg("PHONEBOOK_FIRSTNAME"),gui.i18n.msg("PHONEBOOK_LASTNAME"),gui.i18n.msg("PHONEBOOK_HOMEPHONE"),gui.i18n.msg("PHONEBOOK_MOBILEPHONE"),gui.i18n.msg("PHONEBOOK_WORKPHONE"),gui.i18n.msg("PHONEBOOK_EMAIL"),gui.i18n.msg("PHONEBOOK_ADDRESS"),gui.i18n.msg("PHONEBOOK_DELETE"),gui.i18n.msg("PHONEBOOK_CALL")],colModel:[{name:"FirstName",index:"FirstName",width:90,sortable:false,resizable:false,editable:true,cellattr:function(rowId,val,rawObject,cm,rdata){return' data-label="'+gui.i18n.msg("PHONEBOOK_FIRSTNAME")+'"'}},{name:"LastName",index:"LastName",width:90,sortable:false,resizable:false,editable:true,cellattr:function(rowId,val,rawObject,cm,rdata){return' data-label="'+gui.i18n.msg("PHONEBOOK_LASTNAME")+'"'}},{name:"HomePhoneNumber",index:"HomePhoneNumber",width:90,sortable:false,resizable:false,editable:true,formatter:function(cellvalue,options,rowObject){if(cellvalue!==undefined){return cellvalue.replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"")}return""},cellattr:function(rowId,val,rawObject,cm,rdata){return' data-label="'+gui.i18n.msg("PHONEBOOK_HOMEPHONE")+'"'}},{name:"MobilePhoneNumber",index:"MobilePhoneNumber",width:90,sortable:false,resizable:false,editable:true,formatter:function(cellvalue,options,rowObject){if(cellvalue!==undefined){return cellvalue.replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"")}return""},cellattr:function(rowId,val,rawObject,cm,rdata){return' data-label="'+gui.i18n.msg("PHONEBOOK_MOBILEPHONE")+'"'}},{name:"WorkPhoneNumber",index:"WorkPhoneNumber",width:90,sortable:false,resizable:false,editable:true,formatter:function(cellvalue,options,rowObject){if(cellvalue!==undefined){return cellvalue.replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"")}return""},cellattr:function(rowId,val,rawObject,cm,rdata){return' data-label="'+gui.i18n.msg("PHONEBOOK_WORKPHONE")+'"'}},{name:"Email",index:"Email",width:90,sortable:false,resizable:false,editable:true,cellattr:function(rowId,val,rawObject,cm,rdata){return' data-label="'+gui.i18n.msg("PHONEBOOK_EMAIL")+'"'}},{name:"Address",index:"Address",width:90,sortable:false,resizable:false,editable:true,cellattr:function(rowId,val,rawObject,cm,rdata){return' data-label="'+gui.i18n.msg("PHONEBOOK_ADDRESS")+'"'}},{name:"Delete",index:"Delete",width:40,sortable:false,resizable:false,classes:"gui-table-delete-row",cellattr:function(rowId,val,rawObject,cm,rdata){return' data-label="'+gui.i18n.msg("PHONEBOOK_DELETE")+'"'}},{name:"Call",index:"Call",width:40,sortable:false,resizable:false,classes:"gui-table-call-row",cellattr:function(rowId,val,rawObject,cm,rdata){return' data-label="'+gui.i18n.msg("PHONEBOOK_CALL")+'"'}}],scrollOffset:0,caption:$phonebooklist.children("li:first").text(),forceFit:true,editurl:"clientArray",onSelectRow:function(id){var editparams={keys:true,aftersavefunc:function(id){checkPhonebookEntries($table,$table.jqGrid("getRowData",id),id);saveRowValue(id);$table.jqGrid("resetSelection");editedrow=undefined}};if(id&&id!==editedrow){$table.jqGrid("saveRow",editedrow);saveRowValue(editedrow);$table.jqGrid("editRow",id,editparams);$table.data("editedrow",id);editedrow=id}}}).parents("div.ui-jqgrid").addClass("gui-table");$("#PhonebookContactAdd",$page).click(function(event){editedrow=$table.data("editedrow");if(editedrow){$table.jqGrid("saveRow",editedrow);saveRowValue(editedrow);if(!$.isEmptyObject($table.jqGrid("getRowData",editedrow))){checkPhonebookEntries($table,$table.jqGrid("getRowData",editedrow),editedrow)}editedrow=undefined}event.preventDefault();event.stopImmediatePropagation();var val={FirstName:"",LastName:"",HomePhoneNumber:"",MobilePhoneNumber:"",WorkPhoneNumber:"",Email:"",Numbers:[],Address:""};$phonebooklist.array("insert",-1,val,new gui.api.Capability({name:"Contact"}));$table.jqGrid("setSelection",newid)});$("#ApplyButton",$page).on("phonebookpagetrigger",function(event,param1,param2){if(editedrow!=undefined){$table.jqGrid("saveRow",editedrow);saveRowValue(editedrow);if($table[0].p.data.length>0){if($("#"+editedrow).length){if(checkPhonebookEntries($table,$table.jqGrid("getRowData",editedrow),editedrow)==true){return true}}}}})}).delegate("#PhonebookPage","pageshow",function(){var $page=$(this),$phonebooklist=$("#PhonebookContactsList",$page),$table=$('<table id="phonebookContactsListTable" >'),tableRows,table=$("#phonebookContactsListTable",$page);if(checkGoogleImport()){$("#ImportGoogleContacts").removeClass("ui-inactive")}$(".ui-jqgrid-htable th:not(#phonebookContactsListTable_Delete,#phonebookContactsListTable_Call)",$page).each(function(){var th=$(this),thIndex=th.index(),inverse=true;th.click(function(){if(table.data("editedrow")===undefined){table.find("tr:not(.jqgfirstrow) td").filter(function(){return $(this).index()===thIndex}).sortElements(function(a,b){if($.text([a]).toLowerCase()==$.text([b]).toLowerCase()){return 0}return $.text([a]).toLowerCase()>$.text([b]).toLowerCase()?inverse?-1:1:inverse?1:-1},function(){return this.parentNode});inverse=!inverse}})});$("#ExportPhonebookContacts",$page).off("click").on("click",function(event){var phonebookContactsList=$("#phonebookContactsListTable",$page).getGridParam("data");if(phonebookContactsList.length>0){exportAsString(phonebookContactsList)}else{gui.alert(gui.i18n.msg("PHONEBOOK_NO_CONTACTS"))}});$("#ClearPhonebookContacts",$page).off("click").on("click",function(event){var phonebookContactsList=$("#phonebookContactsListTable",$page).getGridParam("data");if(phonebookContactsList.length>0){$("<div>").simpledialog2({mode:"blank",width:"300px",themeDialog:"d",showModal:false,blankContent:"<br/><p align='center'>"+gui.i18n.msg("PHONEBOOK_CONFIRM_CLEAR_ALL")+"</p><br/><p align='right' data-role='footer'><a rel='close' data-xmo-role='submit' id='ApplyClearAll' data-role='button' href='#' data-inline='true' data-mini='true' data-theme='b' data-icon='check'>"+gui.i18n.msg("HOME_YES")+"</a><a id='CancelClearAll' rel='close' data-role='button' href='#' data-inline='true' data-theme='d' data-mini='true' data-icon='delete'>"+gui.i18n.msg("HOME_NO")+"</a></p>"})}else{gui.alert(gui.i18n.msg("PHONEBOOK_NO_CONTACTS"))}$("#ApplyClearAll").die("click").live("click",function(){table.jqGrid("clearGridData",true)})});$("#ImportPhonebookContacts",$page).off("click").on("click",function(event){$("#fileImport",$page).val("");$("#errorFile",$page).addClass("hidden");$("<div>").simpledialog2({mode:"blank",width:"300px",themeDialog:"d",showModal:false,blankContent:"<br><label for='fileImport' xmsg='PHONEBOOK_FILE_IMPORT_NOTICE'>Import File (.csv, .vcf)</label><br><span id='errorFile' class='text-danger hidden' xmsg='PHONEBOOK_FILE_IMPORT_ERROR'>File not supported</span><input type='file' id='fileImport' accept='.csv, .vcf'><br><p align='right' data-role='footer'><a data-xmo-role='submit' id='ConfirmPhonebookImport' data-role='button' href='#' data-inline='true' data-mini='true' data-theme='b' data-icon='check'>"+gui.i18n.msg("HOME_YES")+"</a><a id='CancelButtonDialog' rel='close' data-role='button' href='#' data-inline='true' data-theme='d' data-mini='true' data-icon='delete'>"+gui.i18n.msg("HOME_NO")+"</a></p>"})});$("#ImportGoogleContacts",$page).off("click").on("click",function(event){if(checkGoogleImport()){googleImport(phonebookContacts,$phonebooklist)}else{gui.alert(gui.i18n.msg("PHONEBOOK_HOSTNAME_NOT_PERMITTED"))}});$("#ConfirmPhonebookImport").die("click").live("click",function(event){var fileRecipe={};var readFile=function(callback){var _arrayBufferToBinary=function(buffer){var binary="";var bytes=new Uint8Array(buffer);var len=bytes.byteLength;for(var i=0;i<len;i++){binary+=String.fromCharCode(bytes[i])}return binary};reader=new FileReader();if(typeof reader.readAsBinaryString==="function"){reader.onloadend=function(evt){$("#errorFile",$page).addClass("hidden");fileRecipe=evt.target.result;if(callback!==undefined){callback()}};reader.readAsBinaryString(file)}else{reader.onloadend=function(evt){$("#errorFile",$page).addClass("hidden");fileRecipe=evt.target.result;fileRecipe=_arrayBufferToBinary(fileRecipe);if(callback!==undefined){callback()}};reader.readAsArrayBuffer(file)}};var reader=new FileReader();var file=$("#fileImport").prop("files")[0];if($("#fileImport").prop("files")&&$("#fileImport").prop("files").length&&$("#fileImport").prop("files")[0].name.toLowerCase().indexOf(".vcf")>-1){readFile(function(){parseFile(fileRecipe,file.name,$phonebooklist);$("#fileImport").val("")})}else{if($("#fileImport").prop("files")&&$("#fileImport").prop("files").length&&$("#fileImport").prop("files")[0].name.toLowerCase().indexOf(".csv")>-1){readFile(function(){parseFile(fileRecipe,file.name,$phonebooklist);$("#fileImport").val("")})}else{$("#errorFile").removeClass("hidden")}}return false});$("#PhonebookSearch",$page).keyup(function(event){tableRows=$("tr:not(.jqgfirstrow)","#phonebookContactsListTable");var searchValue=$.trim($(this).val()).replace(/ +/g," ").toLowerCase();tableRows.show().filter(function(){var text=$(this).text().replace(/\s+/g," ").toLowerCase();return !~text.indexOf(searchValue)}).hide()});function tog(v){return v?"addClass":"removeClass"}$(document).on("input",".clearable",function(){$(this)[tog(this.value)]("x")}).on("mousemove",".x",function(e){$(this)[tog(this.offsetWidth-18<e.clientX-this.getBoundingClientRect().left)]("onX")}).on("touchstart click",".onX",function(ev){ev.preventDefault();$(this).removeClass("x onX").val("").keyup()})});function goHome(){$.mobile.loading("hide");$.mobile.changePage(prefix+home,{reverse:true})}function checkPhonebookEntries(table,editedRow,rowId){var string="",emailRegex=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,phoneRegex=/^\+?\d+$/;if(editedRow.FirstName===""){string=addErrorMsg(string,gui.i18n.msg("PHONEBOOK_FIRSTNAME_ERROR"))}if(editedRow.LastName===""){string=addErrorMsg(string,gui.i18n.msg("PHONEBOOK_LASTNAME_ERROR"))}if(table[0].p.data.length>1){for(var i=0;i<table[0].p.data.length-1;i++){if(rowId!==table[0].p.data[i].id){if((table[0].p.data[i].FirstName.toLowerCase()===editedRow.FirstName.toLowerCase()&&table[0].p.data[i].LastName.toLowerCase()===editedRow.LastName.toLowerCase())){string="";string=addErrorMsg(string,gui.i18n.msg("PHONEBOOK_DUPLICATE_ERROR"));break}}}}if(string.length>0){gui.alert(string);table.jqGrid("delRowData",rowId);return true}return false}function addToDubplicatedContacts(contactTab,currentContact){if(!(currentContact in contactTab)){contactTab[currentContact]=""}return contactTab}function addErrorMsg(fullString,msg){if(fullString.indexOf(msg)==-1){fullString+=msg+"\n"}return fullString}var exportAsString=function(phonebookList,returnAsString){var stringExport="";for(var x in phonebookList){if(true){stringExport+="BEGIN:VCARD\n";stringExport+="N:"+phonebookList[x].LastName+";"+phonebookList[x].FirstName+";;;\n";stringExport+="ADR;DOM;PARCEL;HOME:;;";if(phonebookList[x].Address&&phonebookList[x].Address.length){stringExport+=phonebookList[x].Address}stringExport+=";";if(phonebookList[x].City&&phonebookList[x].City.length){stringExport+=phonebookList[x].City}stringExport+=";;";if(phonebookList[x].ZIP&&phonebookList[x].ZIP.length){stringExport+=phonebookList[x].ZIP}stringExport+=";";if(phonebookList[x].Country&&phonebookList[x].Country.length){stringExport+=phonebookList[x].Country}stringExport+="\n";stringExport+="EMAIL;INTERNET:"+phonebookList[x].Email+"\n";if(phonebookList[x].WorkPhoneNumber&&phonebookList[x].WorkPhoneNumber.length){stringExport+="TEL;WORK:"+phonebookList[x].WorkPhoneNumber+"\n"}if(phonebookList[x].MobilePhoneNumber&&phonebookList[x].MobilePhoneNumber.length){stringExport+="TEL;CELL:"+phonebookList[x].MobilePhoneNumber+"\n"}if(phonebookList[x].HomePhoneNumber&&phonebookList[x].HomePhoneNumber.length){stringExport+="TEL;HOME:"+phonebookList[x].HomePhoneNumber+"\n"}stringExport+="END:VCARD\n"}}if(returnAsString){return stringExport}else{var blob=new Blob(["\ufeff",stringExport],{type:"text/plain;charset=utf-8"});saveAs(blob,"Contacts.vcf")}};var convertBytes=function(value,pot){var result=0,arrayLegend={"0":"","10":" kB","20":" MB","30":" GB","40":" TB"};if(pot!==undefined){return(value/Math.pow(2,pot)).toFixed(2).replace(".",",")+arrayLegend[pot]}for(var x=0;x<5;x++){if(value<Math.pow(2,x*10)){break}result=(value/Math.pow(2,x*10)).toFixed(2).replace(".",",")+arrayLegend[x*10]}return result};var byteArrayToStr=function(bytes){var newarray=[];for(var x=0;x<bytes.length;x++){if(bytes[x]!==0){newarray.push(bytes[x])}}return String.fromCharCode.apply(null,newarray)};var strToByteArray=function(str){var bytes=[];for(var i=0,n=str.length;i<n;i++){var character=str.charCodeAt(i);bytes.push(character>>>8,character&255)}return bytes};var isUTF8=function(bytes){return(bytes.slice(0,3)==="\xEF\xBB\xBF")};var byteUTF8ToStr=function(bytes){var ix=0;if(bytes.slice(0,3)==="\xEF\xBB\xBF"){ix=3}var string="";for(;ix<bytes.length;ix++){var byte1=bytes[ix].charCodeAt(0),byte2,byte3,byte4;if(byte1<128){string+=String.fromCharCode(byte1)}else{if(byte1>=194&&byte1<224){byte2=bytes[++ix].charCodeAt(0);string+=String.fromCharCode(((byte1&31)<<6)+(byte2&63))}else{if(byte1>=224&&byte1<240){byte2=bytes[++ix].charCodeAt(0);byte3=bytes[++ix].charCodeAt(0);string+=String.fromCharCode(((byte1&255)<<12)+((byte2&63)<<6)+(byte3&63))}else{if(byte1>=240&&byte1<245){byte2=bytes[++ix].charCodeAt(0);byte3=bytes[++ix].charCodeAt(0);byte4=bytes[++ix].charCodeAt(0);var codepoint=((byte1&7)<<18)+((byte2&63)<<12)+((byte3&63)<<6)+(byte4&63);codepoint-=65536;string+=String.fromCharCode((codepoint>>10)+55296,(codepoint&1023)+56320)}}}}}return string};var parseFile=function(file,name,phonebooklist){listContactsImport=[];if(name.toLowerCase().indexOf(".csv")>-1||name.toLowerCase().indexOf(".vcf")>-1){if(isUTF8(file)){file=byteUTF8ToStr(file)}else{file=byteArrayToStr(strToByteArray(file))}if(name.toLowerCase().indexOf(".csv")>-1){var splitedFile=formatCSV(file);var header=splitedFile.shift();if(header[0]&&header[0].substr(2)==="Name"){header[0]=header[0].substr(2)}splitedFile.pop();for(var x in splitedFile){formatContactsCSV(splitedFile[x],header)}}else{VCF.parse(file,function(vc){parse(vc)})}if(listContactsImport.length){$.mobile.sdCurrentDialog.close();for(var i=0;i<listContactsImport.length;i++){phonebooklist.array("insert",-1,listContactsImport[i],new gui.api.Capability({name:"Contact"}))}}else{$.mobile.sdCurrentDialog.close()}}};var parse=function(fields){var contact={};var table=$("#phonebookContactsListTable");var isUnique=true;contact.FirstName=_getVCardProp(fields,'fields["n"]["given-name"][0]');contact.LastName=_getVCardProp(fields,'fields["n"]["family-name"][0]');contact.Email=_getVCardProp(fields,"fields.email[0].value").toLowerCase();var tmpAddress=_getVCardType(fields,"adr","HOME")||_getVCardType(fields,"adr","WORK")||_getVCardType(fields,"adr","POSTAL");tmpAddress=tmpAddress.split(";");contact.Country=tmpAddress[6]||"";contact.ZIP=tmpAddress[5]||"";contact.City=tmpAddress[3]||"";contact.Address=tmpAddress[2]||"";var prefNumber=_getVCardType(fields,"tel","PREF")||_getVCardType(fields,"tel","voice");contact.HomePhoneNumber=_getVCardType(fields,"tel","HOME");contact.MobilePhoneNumber=_getVCardType(fields,"tel","CELL");contact.WorkPhoneNumber=_getVCardType(fields,"tel","WORK");contact.Numbers=[{Number:contact.HomePhoneNumber.replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"")||"",Type:"Home"},{Number:contact.MobilePhoneNumber.replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"")||"",Type:"Mobile"},{Number:contact.WorkPhoneNumber.replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"")||"",Type:"Work"}];for(var i=0;i<table[0].p.data.length;i++){if((table[0].p.data[i].FirstName!==""&&table[0].p.data[i].FirstName.toLowerCase()===contact.FirstName.toLowerCase()&&contact.LastName!=""&&table[0].p.data[i].LastName.toLowerCase()===contact.LastName.toLowerCase())){isUnique=false;break}}if(isUnique){listContactsImport.push(contact)}};var _getVCardProp=function(fields,prop){var rs="";try{rs=eval(prop)}catch(e){}return rs};var _getVCardType=function(fields,info,type){var rs="";$(fields[info]).each(function(i,obj){if($.inArray(type,obj.type)>-1){rs=obj.value;return false}if(type===obj.type||(obj.type.length===1&&obj.type[0]===type.toUpperCase())){rs=obj.value;return false}});rs=$.trim(rs);if(rs==="-"){rs=""}return rs};var formatCSV=function(s){var open=false,f="",arraycsv=[],arrayline=[];for(var x=0;x<s.length;x++){if(s.substr(x,1)==='"'){open=!open}if(s.substr(x,1)==='"'&&s.substr(x+1,1)!=='"'){continue}if(open){if(s.substr(x,1)!=="\n"&&s.substr(x,1)!=="\r"){f+=s.substr(x,1)}else{f+=" "}}else{if(s.substr(x,1)===","){arrayline.push(f);f=""}else{if(s.substr(x,1)==="\n"){arraycsv.push(arrayline);arrayline=[];f=""}else{f+=s.substr(x,1)}}}}arrayline.push(f);arraycsv.push(arrayline);return arraycsv};var formatContactsCSV=function(contacts,header){var fields=phonebookImportFields;var contact={};var table=$("#phonebookContactsListTable");var isUnique=true;for(var x in fields.name){if($.inArray(fields.name[x],header)>-1){contact.HomePhoneNumber="";contact.MobilePhoneNumber="";contact.WorkPhoneNumber="";contact.Email="";if(contacts[$.inArray(fields.name[x],header)]){contact.FirstName=contacts[$.inArray(fields.name[x],header)].replace(/\n/g,"")}if(contacts[$.inArray(fields.lastName[x],header)]){contact.LastName=contacts[$.inArray(fields.lastName[x],header)].replace(/\n/g,"");contact.FirstName=$.trim(contact.FirstName).replace(new RegExp(" "+contact.LastName+"$"),"")}if(contacts[$.inArray(fields.homeNumber[x],header)]){contact.HomePhoneNumber=contacts[$.inArray(fields.homeNumber[x],header)].replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"");contact.HomePhoneNumber=contact.HomePhoneNumber.substr(0,20)}if(contacts[$.inArray(fields.mobileNumber[x],header)]){contact.MobilePhoneNumber=contacts[$.inArray(fields.mobileNumber[x],header)].replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"");contact.MobilePhoneNumber=contact.MobilePhoneNumber.substr(0,20)}if(contacts[$.inArray(fields.workNumber[x],header)]){contact.WorkPhoneNumber=contacts[$.inArray(fields.workNumber[x],header)].replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"");contact.WorkPhoneNumber=contact.WorkPhoneNumber.substr(0,20)}contact.Numbers=[{Number:contact.HomePhoneNumber.replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"")||"",Type:"Home"},{Number:contact.MobilePhoneNumber.replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"")||"",Type:"Mobile"},{Number:contact.WorkPhoneNumber.replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"")||"",Type:"Work"}];if(contacts[$.inArray(fields.email[x],header)]){contact.Email=contacts[$.inArray(fields.email[x],header)].replace(/\n/g,"")}if(!validateEmail(contact.Email)){contact.Email=""}if(contacts[$.inArray(fields.country[x],header)]){contact.Country=contacts[$.inArray(fields.country[x],header)].replace(/\n/g,"")}if(contacts[$.inArray(fields.city[x],header)]){contact.City=contacts[$.inArray(fields.city[x],header)].replace(/\n/g,"")}if(contacts[$.inArray(fields.address[x],header)]){contact.Address=contacts[$.inArray(fields.address[x],header)].replace(/\n/g,"")}if(contacts[$.inArray(fields.comment[x],header)]&&fields.comment[x]){contact.Comment=contacts[$.inArray(fields.comment[x],header)].replace(/\n/g,"")}}}if(contact.FirstName!==""){for(var i=0;i<table[0].p.data.length;i++){if((table[0].p.data[i].FirstName!==""&&table[0].p.data[i].FirstName.toLowerCase()===contact.FirstName.toLowerCase()&&contact.LastName!=""&&table[0].p.data[i].LastName.toLowerCase()===contact.LastName.toLowerCase())){isUnique=false;break}}if(isUnique){listContactsImport.push(contact)}}};var validateEmail=function(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email)};var GoogleContactsApplicationConfig={googleContactsBatch:1000,googleContactsClientId:"492708212151-8fui4rnlfrumna8rnqd258jvnoqvv3sv.apps.googleusercontent.com",googleContactsApiKey:"AIzaSyCbMx9kon10J7CLxwMxHRxaJRW0ryotIn0"};var GoogleContacts=function(phonebookContacts,phonebooklist){var clientId=GoogleContactsApplicationConfig.googleContactsClientId;var apiKey=GoogleContactsApplicationConfig.googleContactsApiKey;var scopes="https://www.googleapis.com/auth/contacts";var contactList=[];var addedList=0;var maxResults=GoogleContactsApplicationConfig.googleContactsBatch;var phonebookContacts=phonebookContacts;var phonebooklist=phonebooklist;var end,mid;var GoogleContacts={start:function(returnable,midCb,endCb){mid=midCb;end=endCb;var retur=returnable||returnable===undefined;gapi.client.setApiKey(apiKey);var self=this;gapi.auth.authorize({client_id:clientId,scope:scopes,immediate:retur},self.handleAuthResult)},handleAuthResult:function(authResult){var generateRequestUrl=function(resp){var path="m8/feeds/contacts/default/full?alt=json&max-results="+maxResults;if(!resp){return path}var totalAmmount=parseInt(resp.feed.openSearch$totalResults.$t,10);var first=parseInt(resp.feed.openSearch$startIndex.$t,10);if(addedList<totalAmmount){var next=first+maxResults;path+="&start-index="+next;return path}for(var i=0;i<contactList.length;i++){phonebooklist.array("insert",-1,contactList[i],new gui.api.Capability({name:"Contact"}))}console.log(contactList);contactList=[];return""};var parseResponse=function(resp){$(resp.feed.entry).each(function(i,obj){addedList++;var leRegex=/\/base\/([a-z0-9]*)/;var contactId=leRegex.exec(obj.id.$t);if(!contactId){return true}contactId=contactId[1];if(search(phonebookContacts,contactId,"Category")){return true}var contact={};var fullName=[];contact.Email="";contact.HomePhoneNumber="";contact.MobilePhoneNumber="";contact.WorkPhoneNumber="";contact.Category=contactId;if(obj.title){fullName=obj.title.$t.split(" ");contact.FirstName=fullName[0].substring(0,64);contact.LastName=(fullName[1])?fullName[1].substring(0,64):""}if(obj.gd$phoneNumber){if(obj.gd$phoneNumber.length>1){$.each(obj.gd$phoneNumber,function(index,phoneNumber){if(phoneNumber.rel){if(phoneNumber.rel.indexOf("#home")>-1){contact.HomePhoneNumber=phoneNumber.$t}if(phoneNumber.rel.indexOf("#work")>-1){contact.WorkPhoneNumber=phoneNumber.$t}if(phoneNumber.rel.indexOf("#mobile")>-1){contact.MobilePhoneNumber=phoneNumber.$t}}})}else{contact.HomePhoneNumber=obj.gd$phoneNumber[0].$t}}contact.Numbers=[{Number:contact.HomePhoneNumber.replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"")||"",Type:"Home"},{Number:contact.MobilePhoneNumber.replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"")||"",Type:"Mobile"},{Number:contact.WorkPhoneNumber.replace(/^\++/g,"00").replace(/[^+0-9]/g,"").replace(/\+/g,"")||"",Type:"Work"}];if(obj.gd$email){contact.Email=obj.gd$email[0].address.substring(0,64)}if(obj.gd$postalAddress){contact.Address=obj.gd$postalAddress[0].$t.substring(0,128)}contactList.push(contact)})};var handleRequest=function(init){var url=generateRequestUrl(init);var httpRequest=gapi.client.request({path:url});httpRequest.execute(function(resp){parseResponse(resp);var nextUrl=generateRequestUrl(resp);if(nextUrl){handleRequest(resp)}})};if(authResult&&!authResult.error){mid();setTimeout(handleRequest,500)}}};return GoogleContacts};var checkGoogleImport=function(){try{if($.inArray(window.location.hostname,["mymodem","192.168.1.1"])!==-1){return true}return false}catch(err){return true}};var googleImport=function(phonebookContacts,$phonebooklist){if(typeof gapi==="undefined"){return}var GoogleContactsObject=new GoogleContacts(phonebookContacts,$phonebooklist);GoogleContactsObject.start(false,function(){},function(total,imported){console.log("total");console.log(total);console.log("imported");console.log(imported)})};var search=function(array,exp,field){var rs=null;$.each(array,function(i,obj){if(obj[field]===exp){rs=obj;return false}});return rs};var phonebookImportFields={name:{EN_GOOGLE:"Name",EN_GOOGLE_OUTLOOK_FORMAT:"First Name",BR:"Primeiro nome"},number:{EN_GOOGLE:"Phone 1 - Value",EN_GOOGLE_OUTLOOK_FORMAT:"Primary Phone",BR:"Telefone principal"},lastName:{EN_GOOGLE:"Family Name",EN_GOOGLE_OUTLOOK_FORMAT:"Last Name",BR:"Sobrenome"},homeNumber:{EN_GOOGLE:"Phone 2 - Value",EN_GOOGLE_OUTLOOK_FORMAT:"Home Phone",BR:"Telefone residencial"},mobileNumber:{EN_GOOGLE:"",EN_GOOGLE_OUTLOOK_FORMAT:"Mobile Phone",BR:"Telefone celular"},workNumber:{EN_GOOGLE:"",EN_GOOGLE_OUTLOOK_FORMAT:"Business Phone",BR:"Telefone comercial"},email:{EN_GOOGLE:"E-mail 1 - Value",EN_GOOGLE_OUTLOOK_FORMAT:"E-mail Address",BR:"E-mail Address"},city:{EN_GOOGLE:"Address 1 - City",EN_GOOGLE_OUTLOOK_FORMAT:"Home City",BR:"Cidade do endereço residencial"},country:{EN_GOOGLE:"Address 1 - Country",EN_GOOGLE_OUTLOOK_FORMAT:"Home Country",BR:"País/Região de Residência"},address:{EN_GOOGLE:"Address 1 - Street",EN_GOOGLE_OUTLOOK_FORMAT:"Home Address",BR:"Endereço residencial"},comment:{EN_GOOGLE:"",EN_GOOGLE_OUTLOOK_FORMAT:"",BR:""}}});jQuery(function(f){var b=f.gui,e={},a=[],d={};f(document).delegate("#CallLogPage","pagebeforecreate",function(){var g=f(this),h=b.client.newRequest();h.getValue("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/SIP/Clients",function(j){a=j});h.getValue("Device/Services/VoiceServices/VoiceService[@uid='1']/CallControl/Lines",function(k){for(var j=0;j<k.length;j++){e["Device/Services/VoiceServices/VoiceService[@uid='1']/CallControl/Lines/Line[@uid='"+k[j].uid+"']"]=k[j]}});h.getValue("Device/Contacts/Contacts",function(k){for(var j=0;j<k.length;j++){d[k[j].Number]={FirstName:k[j].FirstName,LastName:k[j].LastName}}});h.send({synchronous:true})}).delegate("#CallLogPage","pagecreate",function(){var j=f(this),n=f("#CallLogList",j),l=b.client.newRequest();var h=f('<table id="callLogListTable" >'),k=1,m,g;n.hide().after(h).bind("arraybeforeinsert",function(r,s){var t="history"+k,o,q=s.value.uid,p={};if(s.value.Direction==="INCOMING"){s.value.Number=s.value.CallingPartyNumber;if(d[s.value.Number]!==undefined){s.value.Number=d[s.value.Number].FirstName+" "+d[s.value.Number].LastName}s.value.CallType="IncomingCall";if(s.value.CallTerminationCause==="Termination_called_is_busy"){s.value.CallType="MissedCall"}}else{s.value.Number=s.value.CalledPartyNumber;if(d[s.value.Number]!==undefined){s.value.Number=d[s.value.Number].FirstName+" "+d[s.value.Number].LastName}s.value.CallType="OutgoingCall"}p=searchFirstOccurence(a,getAliasFromXPath(e[s.value.UsedLine].Provider),"Alias");s.value.Line=e[s.value.UsedLine].Name+" ("+p.RegisterURI.split("@")[0].replace("sip:","")+")";h.jqGrid("addRowData",t,s.value);o=h.find("#"+t).object({connected:false,objset:null});f(o).data("call-log-id",q);s.item=o.data("xmo-item");delete s.value.SignalingPerformances;delete s.value.Sessions;s.item.current(s.value,s.capability,s.xpath);o.find(".gui-table-delete-row").click(function(u){h.jqGrid("delRowData",t)}).end();o.find(".gui-table-call-row").click(function(u){var w=f(this).parent(),v=w.data("call-log-id");callLogData=h.getRowData(w.attr("id"));f("<div>").simpledialog2({mode:"blank",width:"300px",themeDialog:"d",showModal:false,blankContent:"<br><table style='width: 100%; border: 1px solid black;'><tbody><tr style='background: none repeat scroll 0% 0% rgb(222, 222, 210); border: 1px solid black;'><th style='border: 1px solid black;'>Contact</th><th style=''>"+b.i18n.msg("CALLLOG_LINE")+"</th></tr><tr style=''><td style='border: 1px solid black;'>"+callLogData.Number+"</td><td>"+callLogData.Line+"</td></tr></tbody></table><br><br><p align='right' data-role='footer'><a rel='close' id='ReCallSubmitButtonDialog' data-role='button' href='#' data-inline='true' data-mini='true' data-theme='b' data-icon='check'>"+b.i18n.msg("CALLLOG_RECALL")+"</a><a id='ReCallCancelButtonDialog' rel='close' data-role='button' href='#' data-inline='true' data-theme='d' data-mini='true' data-icon='delete'>"+b.i18n.msg("HOME_CANCEL")+"</a></p>"});f("#ReCallSubmitButtonDialog").click(function(x){var y=f("#numberSelect").val();l.remoteCall("Device/Services/VoiceServices/VoiceService[Alias='VOICESERVICE1']/CallLogs/CallLog[@uid='"+v+"']","reCall");l.send();f.mobile.sdCurrentDialog.close()});f("#ReCallCancelButtonDialog").click(function(){f.mobile.sdCurrentDialog.close()});return false}).end();g=t;k++});h.jqGrid({datatype:"local",height:200,colNames:[b.i18n.msg("CALLLOG_TYPE"),b.i18n.msg("CALLLOG_NUMBER"),b.i18n.msg("CALLLOG_WHEN"),b.i18n.msg("CALLLOG_DURATION"),b.i18n.msg("CALLLOG_LINE"),b.i18n.msg("CALLLOG_RECALL"),b.i18n.msg("NAT_DELETE")],colModel:[{name:"CallType",index:"CallType",width:70,sortable:false,resizable:false,editable:false,align:"center",formatter:function(o,p,q){if(o==="IncomingCall"){return'<img src="../../../img/icon-incoming.png" />'}else{if(o==="OutgoingCall"){return'<img src="../../../img/icon-outgoing.png" />'}else{return'<img src="../../../img/icon-missed.png" />'}}},cellattr:function(q,s,p,o,r){return' data-label="'+b.i18n.msg("CALLLOG_TYPE")+'"'}},{name:"Number",index:"Number",width:130,sortable:false,resizable:false,editable:true,cellattr:function(q,s,p,o,r){return' data-label="'+b.i18n.msg("CALLLOG_NUMBER")+'"'}},{name:"Start",index:"Start",width:130,sortable:false,resizable:false,editable:false,formatter:function(p,q,r){var o=new Date(p);return(("0"+o.getDate()).slice(-2)+"/"+("0"+(o.getMonth()+1)).slice(-2)+"/"+o.getFullYear().toString()+" "+("0"+o.getHours()).slice(-2)+":"+("0"+o.getMinutes()).slice(-2)+":"+("0"+o.getSeconds()).slice(-2))},cellattr:function(q,s,p,o,r){return' data-label="'+b.i18n.msg("CALLLOG_WHEN")+'"'}},{name:"Duration",index:"Duration",width:130,sortable:false,resizable:false,editable:false,formatter:function(o,p,r){var q=c(o);return q},cellattr:function(q,s,p,o,r){return' data-label="'+b.i18n.msg("CALLLOG_DURATION")+'"'}},{name:"Line",index:"Line",width:130,sortable:false,resizable:false,editable:false,cellattr:function(q,s,p,o,r){return' data-label="'+b.i18n.msg("CALLLOG_LINE")+'"'}},{name:"Recall",index:"Recall",width:130,sortable:false,resizable:false,classes:"gui-table-call-row",cellattr:function(q,s,p,o,r){return' data-label="'+b.i18n.msg("CALLLOG_RECALL")+'"'}},{name:"Delete",index:"Delete",width:70,sortable:false,resizable:false,classes:"gui-table-delete-row",cellattr:function(q,s,p,o,r){return' data-label="'+b.i18n.msg("NAT_DELETE")+'"'}}],scrollOffset:0,caption:n.children("li:first").text(),forceFit:true,editurl:"clientArray",onSelectRow:function(o){return false}}).parents("div.ui-jqgrid").addClass("gui-table")});function c(l){var k=parseInt(l,10);var g=Math.floor(k/3600);var h=Math.floor((k-(g*3600))/60);var l=k-(g*3600)-(h*60);if(g<10){g="0"+g}if(h<10){h="0"+h}if(l<10){l="0"+l}var j=g+":"+h+":"+l;return j}});jQuery(function(b){var a=b.gui,c=b(document);c.delegate(":jqmData(role='page')","pagebeforecreate",function(){var d=b(this);if(a.displayMode===a.GUI_SMARTPHONE_MODE){d.children(":jqmData(role='header'), :jqmData(role='footer')").attr("data-position","fixed")}b(":jqmData(xmo-role='status'), :jqmData(xmo-role='statistic')",d).find("select").attr("data-role","none");if(a.displayMode===a.GUI_DESKTOP_MODE){b("select, input",d).each(function(f){var e=b(this);if(e.attr("data-mini")===undefined){e.attr("data-mini","true")}if(e.attr("data-inline")===undefined){e.attr("data-inline","true")}})}})});function IPnumber(a){while(a.indexOf(",")!=-1){a=a.replace(",",".")}var b=a.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/);if(b){if(+b[1]>127){b[1]=(+b[1])-128}result=(+b[1]<<24)+(+b[2]<<16)+(+b[3]<<8)+(+b[4]);return result}return null}function convertMaskToDec(a){if(a==255){return(8)}i=0;bitpat=65280;while(i<8){if(a==(bitpat&255)){return(i)}bitpat=bitpat>>1;i++}}function getFirstUsableAddr(a,c,b){firstUsableAddr=new Array("0","0","0","0");for(i=0;i<a.length;i++){firstUsableAddr[i]=a[i]&c[i];if(b==32){firstUsableAddr[i]=a[i]}else{if(i==3){firstUsableAddr[i]=(a[i]&c[i])+1}}}return firstUsableAddr}function getLastUsableAddr(a,d,c,b){lastUsableAddr=new Array("0","0","0","0");for(i=0;i<a.length;i++){lastUsableAddr[i]=a[i]|(~d[i]&255);if(c==32){lastUsableAddr[i]=a[i]}else{if(i==3){lastUsableAddr[i]=(a[i]|(~d[i]&255))-1}}}return lastUsableAddr}function getUsableIp(f,d){var c=[];var e=cidr2octets(d).split(".");var b=d;var a=Math.pow(2,(32-b))-1;c[0]=getFirstUsableAddr(f.split("."),e,(32-b));c[1]=getLastUsableAddr(f.split("."),e,(32-b),a);return c}function getDeviceName(b){var a=$.gui.client.newRequest();a.getValue("Device/Hosts/Hosts/Host[@uid='"+b+"']/UserFriendlyName",function(d){if(d.trim()!=""){$("#EthernetDevNameFirewall").html(d);$("#EthernetDevNameNat").html(d)}else{var c=$.gui.client.newRequest();c.getValue("Device/Hosts/Hosts/Host[@uid='"+b+"']/HostName",function(e){if(e!=""){$("#EthernetDevNameFirewall").html(e);$("#EthernetDevNameNat").html(e)}});c.send()}});a.send()}function bits2d(b){var a=0;if(b>0){a=a+128}if(b>1){a=a+64}if(b>2){a=a+32}if(b>3){a=a+16}if(b>4){a=a+8}if(b>5){a=a+4}if(b>6){a=a+2}if(b>7){a=a+1}return(a)}function cidr2octets(a){if(a<0){a=0}if(a>32){a=32}return bits2d(a)+"."+bits2d(a-8)+"."+bits2d(a-16)+"."+bits2d(a-24)}function searchFirstOccurence(d,c,b){var a=null;$.each(d,function(e,f){if(f[b]===c){a=f;return false}});return a}function searchRecursive(d,c,b){var a=[];$.each(d,function(e,f){if(f[b]===c){a.push(f)}});return a}function getAliasFromXPath(b,f){var d=10,e=0,a=0;if(f===undefined){e=parseInt(b.toString().lastIndexOf("[")+1,d);a=parseInt(b.toString().lastIndexOf("]"),d)}else{e=parseInt(b.toString().indexOf("[")+1,d);a=parseInt(b.toString().indexOf("]"),d)}var c=b.substring(e,a).match(/'(.*?)'/)[1];return c};